/*! For license information please see bugspotter.min.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.BugSpotter=e():t.BugSpotter=e()}(this,()=>(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{BugReportModal:()=>hi,BugSpotter:()=>so,CircularBuffer:()=>eo,ConsoleCapture:()=>Rr,DEFAULT_PATTERNS:()=>$r,DOMCollector:()=>ro,FloatingButton:()=>Wr,MetadataCapture:()=>Tr,NetworkCapture:()=>Mr,PATTERN_CATEGORIES:()=>Xr,PATTERN_PRESETS:()=>ei,PatternBuilder:()=>ti,Sanitizer:()=>li,ScreenshotCapture:()=>xr,compressData:()=>vr,compressImage:()=>_r,configureLogger:()=>W,createLogger:()=>G,createPatternConfig:()=>ni,createSanitizer:()=>ci,decompressData:()=>Cr,estimateSize:()=>kr,getAuthHeaders:()=>Lr,getCompressionRatio:()=>Sr,getLogger:()=>P,getPattern:()=>Jr,getPatternsByCategory:()=>Qr,sanitize:()=>oo,submitWithAuth:()=>Dr,validatePattern:()=>ri});const n=(()=>{let t=0;return()=>(t+=1,`u${`0000${(Math.random()*36**4|0).toString(36)}`.slice(-4)}${t}`)})();function r(t){const e=[];for(let n=0,r=t.length;n<r;n++)e.push(t[n]);return e}let i=null;function s(t={}){return i||(t.includeStyleProperties?(i=t.includeStyleProperties,i):(i=r(window.getComputedStyle(document.documentElement)),i))}function o(t,e){const n=(t.ownerDocument.defaultView||window).getComputedStyle(t).getPropertyValue(e);return n?parseFloat(n.replace("px","")):0}function a(t,e={}){return{width:e.width||function(t){const e=o(t,"border-left-width"),n=o(t,"border-right-width");return t.clientWidth+e+n}(t),height:e.height||function(t){const e=o(t,"border-top-width"),n=o(t,"border-bottom-width");return t.clientHeight+e+n}(t)}}const l=16384;function c(t){return new Promise((e,n)=>{const r=new Image;r.onload=()=>{r.decode().then(()=>{requestAnimationFrame(()=>e(r))})},r.onerror=n,r.crossOrigin="anonymous",r.decoding="async",r.src=t})}const d=(t,e)=>{if(t instanceof e)return!0;const n=Object.getPrototypeOf(t);return null!==n&&(n.constructor.name===e.name||d(n,e))};function h(t,e,r,i){const o=window.getComputedStyle(t,r),a=o.getPropertyValue("content");if(""===a||"none"===a)return;const l=n();try{e.className=`${e.className} ${l}`}catch(t){return}const c=document.createElement("style");c.appendChild(function(t,e,n,r){const i=`.${t}:${e}`,o=n.cssText?function(t){const e=t.getPropertyValue("content");return`${t.cssText} content: '${e.replace(/'|"/g,"")}';`}(n):function(t,e){return s(e).map(e=>`${e}: ${t.getPropertyValue(e)}${t.getPropertyPriority(e)?" !important":""};`).join(" ")}(n,r);return document.createTextNode(`${i}{${o}}`)}(l,r,o,i)),e.appendChild(c)}const u="application/font-woff",p="image/jpeg",g={woff:u,woff2:u,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:p,jpeg:p,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function m(t){const e=function(t){const e=/\.([^./]*?)$/g.exec(t);return e?e[1]:""}(t).toLowerCase();return g[e]||""}function f(t){return-1!==t.search(/^(data:)/)}function y(t,e){return`data:${e};base64,${t}`}async function b(t,e,n){const r=await fetch(t,e);if(404===r.status)throw new Error(`Resource "${r.url}" not found`);const i=await r.blob();return new Promise((t,e)=>{const s=new FileReader;s.onerror=e,s.onloadend=()=>{try{t(n({res:r,result:s.result}))}catch(t){e(t)}},s.readAsDataURL(i)})}const w={};async function v(t,e,n){const r=function(t,e,n){let r=t.replace(/\?.*/,"");return n&&(r=t),/ttf|otf|eot|woff2?/i.test(r)&&(r=r.replace(/.*\//,"")),e?`[${e}]${r}`:r}(t,e,n.includeQueryParams);if(null!=w[r])return w[r];let i;n.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime());try{const r=await b(t,n.fetchRequestInit,({res:t,result:n})=>(e||(e=t.headers.get("Content-Type")||""),function(t){return t.split(/,/)[1]}(n)));i=y(r,e)}catch(e){i=n.imagePlaceholder||"";let r=`Failed to fetch resource: ${t}`;e&&(r="string"==typeof e?e:e.message),r&&console.warn(r)}return w[r]=i,i}const C=t=>null!=t.tagName&&"SLOT"===t.tagName.toUpperCase(),I=t=>null!=t.tagName&&"SVG"===t.tagName.toUpperCase();async function _(t,e,n){return n||!e.filter||e.filter(t)?Promise.resolve(t).then(t=>async function(t,e){return d(t,HTMLCanvasElement)?async function(t){const e=t.toDataURL();return"data:,"===e?t.cloneNode(!1):c(e)}(t):d(t,HTMLVideoElement)?async function(t,e){if(t.currentSrc){const e=document.createElement("canvas"),n=e.getContext("2d");return e.width=t.clientWidth,e.height=t.clientHeight,null==n||n.drawImage(t,0,0,e.width,e.height),c(e.toDataURL())}const n=t.poster,r=m(n);return c(await v(n,r,e))}(t,e):d(t,HTMLIFrameElement)?async function(t,e){var n;try{if(null===(n=null==t?void 0:t.contentDocument)||void 0===n?void 0:n.body)return await _(t.contentDocument.body,e,!0)}catch(t){}return t.cloneNode(!1)}(t,e):t.cloneNode(I(t))}(t,e)).then(n=>async function(t,e,n){var i,s;if(I(e))return e;let o=[];return o=C(t)&&t.assignedNodes?r(t.assignedNodes()):d(t,HTMLIFrameElement)&&(null===(i=t.contentDocument)||void 0===i?void 0:i.body)?r(t.contentDocument.body.childNodes):r((null!==(s=t.shadowRoot)&&void 0!==s?s:t).childNodes),0===o.length||d(t,HTMLVideoElement)||await o.reduce((t,r)=>t.then(()=>_(r,n)).then(t=>{t&&e.appendChild(t)}),Promise.resolve()),e}(t,n,e)).then(n=>function(t,e,n){return d(e,Element)&&(function(t,e,n){const r=e.style;if(!r)return;const i=window.getComputedStyle(t);i.cssText?(r.cssText=i.cssText,r.transformOrigin=i.transformOrigin):s(n).forEach(n=>{let s=i.getPropertyValue(n);if("font-size"===n&&s.endsWith("px")){const t=Math.floor(parseFloat(s.substring(0,s.length-2)))-.1;s=`${t}px`}d(t,HTMLIFrameElement)&&"display"===n&&"inline"===s&&(s="block"),"d"===n&&e.getAttribute("d")&&(s=`path(${e.getAttribute("d")})`),r.setProperty(n,s,i.getPropertyPriority(n))})}(t,e,n),function(t,e,n){h(t,e,":before",n),h(t,e,":after",n)}(t,e,n),function(t,e){d(t,HTMLTextAreaElement)&&(e.innerHTML=t.value),d(t,HTMLInputElement)&&e.setAttribute("value",t.value)}(t,e),function(t,e){if(d(t,HTMLSelectElement)){const n=e,r=Array.from(n.children).find(e=>t.value===e.getAttribute("value"));r&&r.setAttribute("selected","")}}(t,e)),e}(t,n,e)).then(t=>async function(t,e){const n=t.querySelectorAll?t.querySelectorAll("use"):[];if(0===n.length)return t;const r={};for(let i=0;i<n.length;i++){const s=n[i].getAttribute("xlink:href");if(s){const n=t.querySelector(s),i=document.querySelector(s);n||!i||r[s]||(r[s]=await _(i,e,!0))}}const i=Object.values(r);if(i.length){const e="http://www.w3.org/1999/xhtml",n=document.createElementNS(e,"svg");n.setAttribute("xmlns",e),n.style.position="absolute",n.style.width="0",n.style.height="0",n.style.overflow="hidden",n.style.display="none";const r=document.createElementNS(e,"defs");n.appendChild(r);for(let t=0;t<i.length;t++)r.appendChild(i[t]);t.appendChild(n)}return t}(t,e)):null}const S=/url\((['"]?)([^'"]+?)\1\)/g,k=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,x=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function A(t){return-1!==t.search(S)}async function E(t,e,n){if(!A(t))return t;const r=function(t,{preferredFontFormat:e}){return e?t.replace(x,t=>{for(;;){const[n,,r]=k.exec(t)||[];if(!r)return"";if(r===e)return`src: ${n};`}}):t}(t,n),i=function(t){const e=[];return t.replace(S,(t,n,r)=>(e.push(r),t)),e.filter(t=>!f(t))}(r);return i.reduce((t,r)=>t.then(t=>async function(t,e,n,r,i){try{const s=n?function(t,e){if(t.match(/^[a-z]+:\/\//i))return t;if(t.match(/^\/\//))return window.location.protocol+t;if(t.match(/^[a-z]+:/i))return t;const n=document.implementation.createHTMLDocument(),r=n.createElement("base"),i=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(i),e&&(r.href=e),i.href=t,i.href}(e,n):e,o=m(e);let a;return a=i?y(await i(s),o):await v(s,o,r),t.replace(function(t){const e=t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}(e),`$1${a}$3`)}catch(t){}return t}(t,r,e,n)),Promise.resolve(r))}async function R(t,e,n){var r;const i=null===(r=e.style)||void 0===r?void 0:r.getPropertyValue(t);if(i){const r=await E(i,null,n);return e.style.setProperty(t,r,e.style.getPropertyPriority(t)),!0}return!1}async function M(t,e){d(t,Element)&&(await async function(t,e){await R("background",t,e)||await R("background-image",t,e),await R("mask",t,e)||await R("-webkit-mask",t,e)||await R("mask-image",t,e)||await R("-webkit-mask-image",t,e)}(t,e),await async function(t,e){const n=d(t,HTMLImageElement);if((!n||f(t.src))&&(!d(t,SVGImageElement)||f(t.href.baseVal)))return;const r=n?t.src:t.href.baseVal,i=await v(r,m(r),e);await new Promise((r,s)=>{t.onload=r,t.onerror=e.onImageErrorHandler?(...t)=>{try{r(e.onImageErrorHandler(...t))}catch(t){s(t)}}:s;const o=t;o.decode&&(o.decode=r),"lazy"===o.loading&&(o.loading="eager"),n?(t.srcset="",t.src=i):t.href.baseVal=i})}(t,e),await async function(t,e){const n=r(t.childNodes).map(t=>M(t,e));await Promise.all(n).then(()=>t)}(t,e))}const T={};async function z(t){let e=T[t];if(null!=e)return e;const n=await fetch(t);return e={url:t,cssText:await n.text()},T[t]=e,e}async function L(t,e){let n=t.cssText;const r=/url\(["']?([^"')]+)["']?\)/g,i=(n.match(/url\([^)]+\)/g)||[]).map(async i=>{let s=i.replace(r,"$1");return s.startsWith("https://")||(s=new URL(s,t.url).href),b(s,e.fetchRequestInit,({result:t})=>(n=n.replace(i,`url(${t})`),[i,t]))});return Promise.all(i).then(()=>n)}function D(t){if(null==t)return[];const e=[];let n=t.replace(/(\/\*[\s\S]*?\*\/)/gi,"");const r=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const t=r.exec(n);if(null===t)break;e.push(t[0])}n=n.replace(r,"");const i=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,s=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let t=i.exec(n);if(null===t){if(t=s.exec(n),null===t)break;i.lastIndex=s.lastIndex}else s.lastIndex=i.lastIndex;e.push(t[0])}return e}function N(t){return t.trim().replace(/["']/g,"")}async function O(t,e){const n=await async function(t,e){if(null==t.ownerDocument)throw new Error("Provided element is not within a Document");const n=r(t.ownerDocument.styleSheets),i=await async function(t,e){const n=[],i=[];return t.forEach(n=>{if("cssRules"in n)try{r(n.cssRules||[]).forEach((t,r)=>{if(t.type===CSSRule.IMPORT_RULE){let s=r+1;const o=z(t.href).then(t=>L(t,e)).then(t=>D(t).forEach(t=>{try{n.insertRule(t,t.startsWith("@import")?s+=1:n.cssRules.length)}catch(e){console.error("Error inserting rule from remote css",{rule:t,error:e})}})).catch(t=>{console.error("Error loading remote css",t.toString())});i.push(o)}})}catch(r){const s=t.find(t=>null==t.href)||document.styleSheets[0];null!=n.href&&i.push(z(n.href).then(t=>L(t,e)).then(t=>D(t).forEach(t=>{s.insertRule(t,s.cssRules.length)})).catch(t=>{console.error("Error loading remote stylesheet",t)})),console.error("Error inlining remote css file",r)}}),Promise.all(i).then(()=>(t.forEach(t=>{if("cssRules"in t)try{r(t.cssRules||[]).forEach(t=>{n.push(t)})}catch(e){console.error(`Error while reading CSS rules from ${t.href}`,e)}}),n))}(n,e);return function(t){return t.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>A(t.style.getPropertyValue("src")))}(i)}(t,e),i=function(t){const e=new Set;return function t(n){(n.style.fontFamily||getComputedStyle(n).fontFamily).split(",").forEach(t=>{e.add(N(t))}),Array.from(n.children).forEach(e=>{e instanceof HTMLElement&&t(e)})}(t),e}(t);return(await Promise.all(n.filter(t=>i.has(N(t.style.fontFamily))).map(t=>{const n=t.parentStyleSheet?t.parentStyleSheet.href:null;return E(t.cssText,n,e)}))).join("\n")}async function F(t,e={}){const{width:n,height:r}=a(t,e),i=await _(t,e,!0);return await async function(t,e){const n=null!=e.fontEmbedCSS?e.fontEmbedCSS:e.skipFonts?null:await O(t,e);if(n){const e=document.createElement("style"),r=document.createTextNode(n);e.appendChild(r),t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}}(i,e),await M(i,e),function(t,e){const{style:n}=t;e.backgroundColor&&(n.backgroundColor=e.backgroundColor),e.width&&(n.width=`${e.width}px`),e.height&&(n.height=`${e.height}px`);const r=e.style;null!=r&&Object.keys(r).forEach(t=>{n[t]=r[t]})}(i,e),await async function(t,e,n){const r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),s=document.createElementNS(r,"foreignObject");return i.setAttribute("width",`${e}`),i.setAttribute("height",`${n}`),i.setAttribute("viewBox",`0 0 ${e} ${n}`),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("x","0"),s.setAttribute("y","0"),s.setAttribute("externalResourcesRequired","true"),i.appendChild(s),s.appendChild(t),async function(t){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(t)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)}(i)}(i,n,r)}const B={debug:0,log:1,warn:2,error:3,none:4};class U{constructor(t={}){this.enabled=t.enabled??!0,this.level=t.level??"log",this.prefix=t.prefix??"[BugSpotter]"}shouldLog(t){return!!this.enabled&&B[t]>=B[this.level]}formatMessage(t){return this.prefix?`${this.prefix} ${t}`:t}debug(t,...e){this.shouldLog("debug")&&console.debug(this.formatMessage(t),...e)}log(t,...e){this.shouldLog("log")&&console.log(this.formatMessage(t),...e)}warn(t,...e){this.shouldLog("warn")&&console.warn(this.formatMessage(t),...e)}error(t,...e){this.shouldLog("error")&&console.error(this.formatMessage(t),...e)}configure(t){void 0!==t.enabled&&(this.enabled=t.enabled),void 0!==t.level&&(this.level=t.level),void 0!==t.prefix&&(this.prefix=t.prefix)}}let Z=new U;function P(){return Z}function W(t){Z.configure(t)}function G(t){return new U(t)}const V=P();class H{constructor(t){this.options=t,this.sanitizer=t.sanitizer}handleError(t,e){const n=e instanceof Error?e:new Error(String(e));V.error(`${this.constructor.name} ${t}:`,n)}}function K(t){let e=t.length;for(;--e>=0;)t[e]=0}const j=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Y=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),q=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),$=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),X=new Array(576);K(X);const J=new Array(60);K(J);const Q=new Array(512);K(Q);const tt=new Array(256);K(tt);const et=new Array(29);K(et);const nt=new Array(30);function rt(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}let it,st,ot;function at(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}K(nt);const lt=t=>t<256?Q[t]:Q[256+(t>>>7)],ct=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},dt=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,ct(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},ht=(t,e,n)=>{dt(t,n[2*e],n[2*e+1])},ut=(t,e)=>{let n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1},pt=(t,e,n)=>{const r=new Array(16);let i,s,o=0;for(i=1;i<=15;i++)o=o+n[i-1]<<1,r[i]=o;for(s=0;s<=e;s++){let e=t[2*s+1];0!==e&&(t[2*s]=ut(r[e]++,e))}},gt=t=>{let e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},mt=t=>{t.bi_valid>8?ct(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},ft=(t,e,n,r)=>{const i=2*e,s=2*n;return t[i]<t[s]||t[i]===t[s]&&r[e]<=r[n]},yt=(t,e,n)=>{const r=t.heap[n];let i=n<<1;for(;i<=t.heap_len&&(i<t.heap_len&&ft(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!ft(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r},bt=(t,e,n)=>{let r,i,s,o,a=0;if(0!==t.sym_next)do{r=255&t.pending_buf[t.sym_buf+a++],r+=(255&t.pending_buf[t.sym_buf+a++])<<8,i=t.pending_buf[t.sym_buf+a++],0===r?ht(t,i,e):(s=tt[i],ht(t,s+256+1,e),o=j[s],0!==o&&(i-=et[s],dt(t,i,o)),r--,s=lt(r),ht(t,s,n),o=Y[s],0!==o&&(r-=nt[s],dt(t,r,o)))}while(a<t.sym_next);ht(t,256,e)},wt=(t,e)=>{const n=e.dyn_tree,r=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems;let o,a,l,c=-1;for(t.heap_len=0,t.heap_max=573,o=0;o<s;o++)0!==n[2*o]?(t.heap[++t.heap_len]=c=o,t.depth[o]=0):n[2*o+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,n[2*l]=1,t.depth[l]=0,t.opt_len--,i&&(t.static_len-=r[2*l+1]);for(e.max_code=c,o=t.heap_len>>1;o>=1;o--)yt(t,n,o);l=s;do{o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],yt(t,n,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,n[2*l]=n[2*o]+n[2*a],t.depth[l]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,n[2*o+1]=n[2*a+1]=l,t.heap[1]=l++,yt(t,n,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const n=e.dyn_tree,r=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,l=e.stat_desc.max_length;let c,d,h,u,p,g,m=0;for(u=0;u<=15;u++)t.bl_count[u]=0;for(n[2*t.heap[t.heap_max]+1]=0,c=t.heap_max+1;c<573;c++)d=t.heap[c],u=n[2*n[2*d+1]+1]+1,u>l&&(u=l,m++),n[2*d+1]=u,d>r||(t.bl_count[u]++,p=0,d>=a&&(p=o[d-a]),g=n[2*d],t.opt_len+=g*(u+p),s&&(t.static_len+=g*(i[2*d+1]+p)));if(0!==m){do{for(u=l-1;0===t.bl_count[u];)u--;t.bl_count[u]--,t.bl_count[u+1]+=2,t.bl_count[l]--,m-=2}while(m>0);for(u=l;0!==u;u--)for(d=t.bl_count[u];0!==d;)h=t.heap[--c],h>r||(n[2*h+1]!==u&&(t.opt_len+=(u-n[2*h+1])*n[2*h],n[2*h+1]=u),d--)}})(t,e),pt(n,c,t.bl_count)},vt=(t,e,n)=>{let r,i,s=-1,o=e[1],a=0,l=7,c=4;for(0===o&&(l=138,c=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=e[2*(r+1)+1],++a<l&&i===o||(a<c?t.bl_tree[2*i]+=a:0!==i?(i!==s&&t.bl_tree[2*i]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,s=i,0===o?(l=138,c=3):i===o?(l=6,c=3):(l=7,c=4))},Ct=(t,e,n)=>{let r,i,s=-1,o=e[1],a=0,l=7,c=4;for(0===o&&(l=138,c=3),r=0;r<=n;r++)if(i=o,o=e[2*(r+1)+1],!(++a<l&&i===o)){if(a<c)do{ht(t,i,t.bl_tree)}while(0!==--a);else 0!==i?(i!==s&&(ht(t,i,t.bl_tree),a--),ht(t,16,t.bl_tree),dt(t,a-3,2)):a<=10?(ht(t,17,t.bl_tree),dt(t,a-3,3)):(ht(t,18,t.bl_tree),dt(t,a-11,7));a=0,s=i,0===o?(l=138,c=3):i===o?(l=6,c=3):(l=7,c=4)}};let It=!1;const _t=(t,e,n,r)=>{dt(t,0+(r?1:0),3),mt(t),ct(t,n),ct(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var St={_tr_init:t=>{It||((()=>{let t,e,n,r,i;const s=new Array(16);for(n=0,r=0;r<28;r++)for(et[r]=n,t=0;t<1<<j[r];t++)tt[n++]=r;for(tt[n-1]=r,i=0,r=0;r<16;r++)for(nt[r]=i,t=0;t<1<<Y[r];t++)Q[i++]=r;for(i>>=7;r<30;r++)for(nt[r]=i<<7,t=0;t<1<<Y[r]-7;t++)Q[256+i++]=r;for(e=0;e<=15;e++)s[e]=0;for(t=0;t<=143;)X[2*t+1]=8,t++,s[8]++;for(;t<=255;)X[2*t+1]=9,t++,s[9]++;for(;t<=279;)X[2*t+1]=7,t++,s[7]++;for(;t<=287;)X[2*t+1]=8,t++,s[8]++;for(pt(X,287,s),t=0;t<30;t++)J[2*t+1]=5,J[2*t]=ut(t,5);it=new rt(X,j,257,286,15),st=new rt(J,Y,0,30,15),ot=new rt(new Array(0),q,0,19,7)})(),It=!0),t.l_desc=new at(t.dyn_ltree,it),t.d_desc=new at(t.dyn_dtree,st),t.bl_desc=new at(t.bl_tree,ot),t.bi_buf=0,t.bi_valid=0,gt(t)},_tr_stored_block:_t,_tr_flush_block:(t,e,n,r)=>{let i,s,o=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),wt(t,t.l_desc),wt(t,t.d_desc),o=(t=>{let e;for(vt(t,t.dyn_ltree,t.l_desc.max_code),vt(t,t.dyn_dtree,t.d_desc.max_code),wt(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*$[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&-1!==e?_t(t,e,n,r):4===t.strategy||s===i?(dt(t,2+(r?1:0),3),bt(t,X,J)):(dt(t,4+(r?1:0),3),((t,e,n,r)=>{let i;for(dt(t,e-257,5),dt(t,n-1,5),dt(t,r-4,4),i=0;i<r;i++)dt(t,t.bl_tree[2*$[i]+1],3);Ct(t,t.dyn_ltree,e-1),Ct(t,t.dyn_dtree,n-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),bt(t,t.dyn_ltree,t.dyn_dtree)),gt(t),r&&mt(t)},_tr_tally:(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(tt[n]+256+1)]++,t.dyn_dtree[2*lt(e)]++),t.sym_next===t.sym_end),_tr_align:t=>{dt(t,2,3),ht(t,256,X),(t=>{16===t.bi_valid?(ct(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}},kt=(t,e,n,r)=>{let i=65535&t,s=t>>>16&65535,o=0;for(;0!==n;){o=n>2e3?2e3:n,n-=o;do{i=i+e[r++]|0,s=s+i|0}while(--o);i%=65521,s%=65521}return i|s<<16};const xt=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var At=(t,e,n,r)=>{const i=xt,s=r+n;t^=-1;for(let n=r;n<s;n++)t=t>>>8^i[255&(t^e[n])];return-1^t},Et={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Rt={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Mt,_tr_stored_block:Tt,_tr_flush_block:zt,_tr_tally:Lt,_tr_align:Dt}=St,{Z_NO_FLUSH:Nt,Z_PARTIAL_FLUSH:Ot,Z_FULL_FLUSH:Ft,Z_FINISH:Bt,Z_BLOCK:Ut,Z_OK:Zt,Z_STREAM_END:Pt,Z_STREAM_ERROR:Wt,Z_DATA_ERROR:Gt,Z_BUF_ERROR:Vt,Z_DEFAULT_COMPRESSION:Ht,Z_FILTERED:Kt,Z_HUFFMAN_ONLY:jt,Z_RLE:Yt,Z_FIXED:qt,Z_DEFAULT_STRATEGY:$t,Z_UNKNOWN:Xt,Z_DEFLATED:Jt}=Rt,Qt=258,te=262,ee=42,ne=113,re=666,ie=(t,e)=>(t.msg=Et[e],e),se=t=>2*t-(t>4?9:0),oe=t=>{let e=t.length;for(;--e>=0;)t[e]=0},ae=t=>{let e,n,r,i=t.w_size;e=t.hash_size,r=e;do{n=t.head[--r],t.head[r]=n>=i?n-i:0}while(--e);e=i,r=e;do{n=t.prev[--r],t.prev[r]=n>=i?n-i:0}while(--e)};let le=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const ce=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))},de=(t,e)=>{zt(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,ce(t.strm)},he=(t,e)=>{t.pending_buf[t.pending++]=e},ue=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},pe=(t,e,n,r)=>{let i=t.avail_in;return i>r&&(i=r),0===i?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),n),1===t.state.wrap?t.adler=kt(t.adler,e,i,n):2===t.state.wrap&&(t.adler=At(t.adler,e,i,n)),t.next_in+=i,t.total_in+=i,i)},ge=(t,e)=>{let n,r,i=t.max_chain_length,s=t.strstart,o=t.prev_length,a=t.nice_match;const l=t.strstart>t.w_size-te?t.strstart-(t.w_size-te):0,c=t.window,d=t.w_mask,h=t.prev,u=t.strstart+Qt;let p=c[s+o-1],g=c[s+o];t.prev_length>=t.good_match&&(i>>=2),a>t.lookahead&&(a=t.lookahead);do{if(n=e,c[n+o]===g&&c[n+o-1]===p&&c[n]===c[s]&&c[++n]===c[s+1]){s+=2,n++;do{}while(c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&s<u);if(r=Qt-(u-s),s=u-Qt,r>o){if(t.match_start=e,o=r,r>=a)break;p=c[s+o-1],g=c[s+o]}}}while((e=h[e&d])>l&&0!==--i);return o<=t.lookahead?o:t.lookahead},me=t=>{const e=t.w_size;let n,r,i;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-te)&&(t.window.set(t.window.subarray(e,e+e-r),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),ae(t),r+=e),0===t.strm.avail_in)break;if(n=pe(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=n,t.lookahead+t.insert>=3)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=le(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=le(t,t.ins_h,t.window[i+3-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<te&&0!==t.strm.avail_in)},fe=(t,e)=>{let n,r,i,s=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,o=0,a=t.strm.avail_in;do{if(n=65535,i=t.bi_valid+42>>3,t.strm.avail_out<i)break;if(i=t.strm.avail_out-i,r=t.strstart-t.block_start,n>r+t.strm.avail_in&&(n=r+t.strm.avail_in),n>i&&(n=i),n<s&&(0===n&&e!==Bt||e===Nt||n!==r+t.strm.avail_in))break;o=e===Bt&&n===r+t.strm.avail_in?1:0,Tt(t,0,0,o),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,ce(t.strm),r&&(r>n&&(r=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+r),t.strm.next_out),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r,t.block_start+=r,n-=r),n&&(pe(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(0===o);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?4:e!==Nt&&e!==Bt&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(i=t.window_size-t.strstart,t.strm.avail_in>i&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,i+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),i>t.strm.avail_in&&(i=t.strm.avail_in),i&&(pe(t.strm,t.window,t.strstart,i),t.strstart+=i,t.insert+=i>t.w_size-t.insert?t.w_size-t.insert:i),t.high_water<t.strstart&&(t.high_water=t.strstart),i=t.bi_valid+42>>3,i=t.pending_buf_size-i>65535?65535:t.pending_buf_size-i,s=i>t.w_size?t.w_size:i,r=t.strstart-t.block_start,(r>=s||(r||e===Bt)&&e!==Nt&&0===t.strm.avail_in&&r<=i)&&(n=r>i?i:r,o=e===Bt&&0===t.strm.avail_in&&n===r?1:0,Tt(t,t.block_start,n,o),t.block_start+=n,ce(t.strm)),o?3:1)},ye=(t,e)=>{let n,r;for(;;){if(t.lookahead<te){if(me(t),t.lookahead<te&&e===Nt)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=le(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-te&&(t.match_length=ge(t,n)),t.match_length>=3)if(r=Lt(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=le(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=le(t,t.ins_h,t.window[t.strstart+1]);else r=Lt(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(de(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===Bt?(de(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(de(t,!1),0===t.strm.avail_out)?1:2},be=(t,e)=>{let n,r,i;for(;;){if(t.lookahead<te){if(me(t),t.lookahead<te&&e===Nt)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=le(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-te&&(t.match_length=ge(t,n),t.match_length<=5&&(t.strategy===Kt||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,r=Lt(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=le(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!==--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,r&&(de(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(r=Lt(t,0,t.window[t.strstart-1]),r&&de(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Lt(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===Bt?(de(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(de(t,!1),0===t.strm.avail_out)?1:2};function we(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}const ve=[new we(0,0,0,0,fe),new we(4,4,8,4,ye),new we(4,5,16,8,ye),new we(4,6,32,32,ye),new we(4,4,16,16,be),new we(8,16,32,32,be),new we(8,16,128,128,be),new we(8,32,128,256,be),new we(32,128,258,1024,be),new we(32,258,258,4096,be)];function Ce(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Jt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),oe(this.dyn_ltree),oe(this.dyn_dtree),oe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),oe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),oe(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ie=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==ee&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&e.status!==ne&&e.status!==re?1:0},_e=t=>{if(Ie(t))return ie(t,Wt);t.total_in=t.total_out=0,t.data_type=Xt;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?ee:ne,t.adler=2===e.wrap?0:1,e.last_flush=-2,Mt(e),Zt},Se=t=>{const e=_e(t);var n;return e===Zt&&((n=t.state).window_size=2*n.w_size,oe(n.head),n.max_lazy_match=ve[n.level].max_lazy,n.good_match=ve[n.level].good_length,n.nice_match=ve[n.level].nice_length,n.max_chain_length=ve[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),e},ke=(t,e,n,r,i,s)=>{if(!t)return Wt;let o=1;if(e===Ht&&(e=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>9||n!==Jt||r<8||r>15||e<0||e>9||s<0||s>qt||8===r&&1!==o)return ie(t,Wt);8===r&&(r=9);const a=new Ce;return t.state=a,a.strm=t,a.status=ee,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=e,a.strategy=s,a.method=n,Se(t)};var xe=ke,Ae=(t,e)=>Ie(t)||2!==t.state.wrap?Wt:(t.state.gzhead=e,Zt),Ee=(t,e)=>{if(Ie(t)||e>Ut||e<0)return t?ie(t,Wt):Wt;const n=t.state;if(!t.output||0!==t.avail_in&&!t.input||n.status===re&&e!==Bt)return ie(t,0===t.avail_out?Vt:Wt);const r=n.last_flush;if(n.last_flush=e,0!==n.pending){if(ce(t),0===t.avail_out)return n.last_flush=-1,Zt}else if(0===t.avail_in&&se(e)<=se(r)&&e!==Bt)return ie(t,Vt);if(n.status===re&&0!==t.avail_in)return ie(t,Vt);if(n.status===ee&&0===n.wrap&&(n.status=ne),n.status===ee){let e=Jt+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=jt||n.level<2?0:n.level<6?1:6===n.level?2:3,e|=r<<6,0!==n.strstart&&(e|=32),e+=31-e%31,ue(n,e),0!==n.strstart&&(ue(n,t.adler>>>16),ue(n,65535&t.adler)),t.adler=1,n.status=ne,ce(t),0!==n.pending)return n.last_flush=-1,Zt}if(57===n.status)if(t.adler=0,he(n,31),he(n,139),he(n,8),n.gzhead)he(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),he(n,255&n.gzhead.time),he(n,n.gzhead.time>>8&255),he(n,n.gzhead.time>>16&255),he(n,n.gzhead.time>>24&255),he(n,9===n.level?2:n.strategy>=jt||n.level<2?4:0),he(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(he(n,255&n.gzhead.extra.length),he(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=At(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(he(n,0),he(n,0),he(n,0),he(n,0),he(n,0),he(n,9===n.level?2:n.strategy>=jt||n.level<2?4:0),he(n,3),n.status=ne,ce(t),0!==n.pending)return n.last_flush=-1,Zt;if(69===n.status){if(n.gzhead.extra){let e=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>e&&(t.adler=At(t.adler,n.pending_buf,n.pending-e,e)),n.gzindex+=i,ce(t),0!==n.pending)return n.last_flush=-1,Zt;e=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>e&&(t.adler=At(t.adler,n.pending_buf,n.pending-e,e)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let e,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(t.adler=At(t.adler,n.pending_buf,n.pending-r,r)),ce(t),0!==n.pending)return n.last_flush=-1,Zt;r=0}e=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,he(n,e)}while(0!==e);n.gzhead.hcrc&&n.pending>r&&(t.adler=At(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let e,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(t.adler=At(t.adler,n.pending_buf,n.pending-r,r)),ce(t),0!==n.pending)return n.last_flush=-1,Zt;r=0}e=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,he(n,e)}while(0!==e);n.gzhead.hcrc&&n.pending>r&&(t.adler=At(t.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ce(t),0!==n.pending))return n.last_flush=-1,Zt;he(n,255&t.adler),he(n,t.adler>>8&255),t.adler=0}if(n.status=ne,ce(t),0!==n.pending)return n.last_flush=-1,Zt}if(0!==t.avail_in||0!==n.lookahead||e!==Nt&&n.status!==re){let r=0===n.level?fe(n,e):n.strategy===jt?((t,e)=>{let n;for(;;){if(0===t.lookahead&&(me(t),0===t.lookahead)){if(e===Nt)return 1;break}if(t.match_length=0,n=Lt(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(de(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Bt?(de(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(de(t,!1),0===t.strm.avail_out)?1:2})(n,e):n.strategy===Yt?((t,e)=>{let n,r,i,s;const o=t.window;for(;;){if(t.lookahead<=Qt){if(me(t),t.lookahead<=Qt&&e===Nt)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(i=t.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){s=t.strstart+Qt;do{}while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<s);t.match_length=Qt-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(n=Lt(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=Lt(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(de(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Bt?(de(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(de(t,!1),0===t.strm.avail_out)?1:2})(n,e):ve[n.level].func(n,e);if(3!==r&&4!==r||(n.status=re),1===r||3===r)return 0===t.avail_out&&(n.last_flush=-1),Zt;if(2===r&&(e===Ot?Dt(n):e!==Ut&&(Tt(n,0,0,!1),e===Ft&&(oe(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),ce(t),0===t.avail_out))return n.last_flush=-1,Zt}return e!==Bt?Zt:n.wrap<=0?Pt:(2===n.wrap?(he(n,255&t.adler),he(n,t.adler>>8&255),he(n,t.adler>>16&255),he(n,t.adler>>24&255),he(n,255&t.total_in),he(n,t.total_in>>8&255),he(n,t.total_in>>16&255),he(n,t.total_in>>24&255)):(ue(n,t.adler>>>16),ue(n,65535&t.adler)),ce(t),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?Zt:Pt)},Re=t=>{if(Ie(t))return Wt;const e=t.state.status;return t.state=null,e===ne?ie(t,Gt):Zt},Me=(t,e)=>{let n=e.length;if(Ie(t))return Wt;const r=t.state,i=r.wrap;if(2===i||1===i&&r.status!==ee||r.lookahead)return Wt;if(1===i&&(t.adler=kt(t.adler,e,n,0)),r.wrap=0,n>=r.w_size){0===i&&(oe(r.head),r.strstart=0,r.block_start=0,r.insert=0);let t=new Uint8Array(r.w_size);t.set(e.subarray(n-r.w_size,n),0),e=t,n=r.w_size}const s=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,me(r);r.lookahead>=3;){let t=r.strstart,e=r.lookahead-2;do{r.ins_h=le(r,r.ins_h,r.window[t+3-1]),r.prev[t&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=t,t++}while(--e);r.strstart=t,r.lookahead=2,me(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,t.next_in=o,t.input=a,t.avail_in=s,r.wrap=i,Zt};const Te=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var ze=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const e in n)Te(n,e)&&(t[e]=n[e])}}return t},Le=t=>{let e=0;for(let n=0,r=t.length;n<r;n++)e+=t[n].length;const n=new Uint8Array(e);for(let e=0,r=0,i=t.length;e<i;e++){let i=t[e];n.set(i,r),r+=i.length}return n};let De=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){De=!1}const Ne=new Uint8Array(256);for(let t=0;t<256;t++)Ne[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Ne[254]=Ne[254]=1;var Oe=t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,n,r,i,s,o=t.length,a=0;for(i=0;i<o;i++)n=t.charCodeAt(i),55296==(64512&n)&&i+1<o&&(r=t.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)n=t.charCodeAt(i),55296==(64512&n)&&i+1<o&&(r=t.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|63&n):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|63&n):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|63&n);return e},Fe=(t,e)=>{const n=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let r,i;const s=new Array(2*n);for(i=0,r=0;r<n;){let e=t[r++];if(e<128){s[i++]=e;continue}let o=Ne[e];if(o>4)s[i++]=65533,r+=o-1;else{for(e&=2===o?31:3===o?15:7;o>1&&r<n;)e=e<<6|63&t[r++],o--;o>1?s[i++]=65533:e<65536?s[i++]=e:(e-=65536,s[i++]=55296|e>>10&1023,s[i++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&De)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n})(s,i)},Be=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+Ne[t[n]]>e?n:e},Ue=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Ze=Object.prototype.toString,{Z_NO_FLUSH:Pe,Z_SYNC_FLUSH:We,Z_FULL_FLUSH:Ge,Z_FINISH:Ve,Z_OK:He,Z_STREAM_END:Ke,Z_DEFAULT_COMPRESSION:je,Z_DEFAULT_STRATEGY:Ye,Z_DEFLATED:qe}=Rt;function $e(t){this.options=ze({level:je,method:qe,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ye},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ue,this.strm.avail_out=0;let n=xe(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==He)throw new Error(Et[n]);if(e.header&&Ae(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?Oe(e.dictionary):"[object ArrayBuffer]"===Ze.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,n=Me(this.strm,t),n!==He)throw new Error(Et[n]);this._dict_set=!0}}function Xe(t,e){const n=new $e(e);if(n.push(t,!0),n.err)throw n.msg||Et[n.err];return n.result}$e.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=e===~~e?e:!0===e?Ve:Pe,"string"==typeof t?n.input=Oe(t):"[object ArrayBuffer]"===Ze.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===We||s===Ge)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=Ee(n,s),i===Ke)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=Re(this.strm),this.onEnd(i),this.ended=!0,i===He;if(0!==n.avail_out){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},$e.prototype.onData=function(t){this.chunks.push(t)},$e.prototype.onEnd=function(t){t===He&&(this.result=Le(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Je={Deflate:$e,deflate:Xe,deflateRaw:function(t,e){return(e=e||{}).raw=!0,Xe(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,Xe(t,e)},constants:Rt};const Qe=16209;var tn=function(t,e){let n,r,i,s,o,a,l,c,d,h,u,p,g,m,f,y,b,w,v,C,I,_,S,k;const x=t.state;n=t.next_in,S=t.input,r=n+(t.avail_in-5),i=t.next_out,k=t.output,s=i-(e-t.avail_out),o=i+(t.avail_out-257),a=x.dmax,l=x.wsize,c=x.whave,d=x.wnext,h=x.window,u=x.hold,p=x.bits,g=x.lencode,m=x.distcode,f=(1<<x.lenbits)-1,y=(1<<x.distbits)-1;t:do{p<15&&(u+=S[n++]<<p,p+=8,u+=S[n++]<<p,p+=8),b=g[u&f];e:for(;;){if(w=b>>>24,u>>>=w,p-=w,w=b>>>16&255,0===w)k[i++]=65535&b;else{if(!(16&w)){if(64&w){if(32&w){x.mode=16191;break t}t.msg="invalid literal/length code",x.mode=Qe;break t}b=g[(65535&b)+(u&(1<<w)-1)];continue e}for(v=65535&b,w&=15,w&&(p<w&&(u+=S[n++]<<p,p+=8),v+=u&(1<<w)-1,u>>>=w,p-=w),p<15&&(u+=S[n++]<<p,p+=8,u+=S[n++]<<p,p+=8),b=m[u&y];;){if(w=b>>>24,u>>>=w,p-=w,w=b>>>16&255,16&w){if(C=65535&b,w&=15,p<w&&(u+=S[n++]<<p,p+=8,p<w&&(u+=S[n++]<<p,p+=8)),C+=u&(1<<w)-1,C>a){t.msg="invalid distance too far back",x.mode=Qe;break t}if(u>>>=w,p-=w,w=i-s,C>w){if(w=C-w,w>c&&x.sane){t.msg="invalid distance too far back",x.mode=Qe;break t}if(I=0,_=h,0===d){if(I+=l-w,w<v){v-=w;do{k[i++]=h[I++]}while(--w);I=i-C,_=k}}else if(d<w){if(I+=l+d-w,w-=d,w<v){v-=w;do{k[i++]=h[I++]}while(--w);if(I=0,d<v){w=d,v-=w;do{k[i++]=h[I++]}while(--w);I=i-C,_=k}}}else if(I+=d-w,w<v){v-=w;do{k[i++]=h[I++]}while(--w);I=i-C,_=k}for(;v>2;)k[i++]=_[I++],k[i++]=_[I++],k[i++]=_[I++],v-=3;v&&(k[i++]=_[I++],v>1&&(k[i++]=_[I++]))}else{I=i-C;do{k[i++]=k[I++],k[i++]=k[I++],k[i++]=k[I++],v-=3}while(v>2);v&&(k[i++]=k[I++],v>1&&(k[i++]=k[I++]))}break}if(64&w){t.msg="invalid distance code",x.mode=Qe;break t}b=m[(65535&b)+(u&(1<<w)-1)]}}break}}while(n<r&&i<o);v=p>>3,n-=v,p-=v<<3,u&=(1<<p)-1,t.next_in=n,t.next_out=i,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=i<o?o-i+257:257-(i-o),x.hold=u,x.bits=p};const en=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),nn=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),rn=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),sn=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var on=(t,e,n,r,i,s,o,a)=>{const l=a.bits;let c,d,h,u,p,g,m=0,f=0,y=0,b=0,w=0,v=0,C=0,I=0,_=0,S=0,k=null;const x=new Uint16Array(16),A=new Uint16Array(16);let E,R,M,T=null;for(m=0;m<=15;m++)x[m]=0;for(f=0;f<r;f++)x[e[n+f]]++;for(w=l,b=15;b>=1&&0===x[b];b--);if(w>b&&(w=b),0===b)return i[s++]=20971520,i[s++]=20971520,a.bits=1,0;for(y=1;y<b&&0===x[y];y++);for(w<y&&(w=y),I=1,m=1;m<=15;m++)if(I<<=1,I-=x[m],I<0)return-1;if(I>0&&(0===t||1!==b))return-1;for(A[1]=0,m=1;m<15;m++)A[m+1]=A[m]+x[m];for(f=0;f<r;f++)0!==e[n+f]&&(o[A[e[n+f]]++]=f);if(0===t?(k=T=o,g=20):1===t?(k=en,T=nn,g=257):(k=rn,T=sn,g=0),S=0,f=0,m=y,p=s,v=w,C=0,h=-1,_=1<<w,u=_-1,1===t&&_>852||2===t&&_>592)return 1;for(;;){E=m-C,o[f]+1<g?(R=0,M=o[f]):o[f]>=g?(R=T[o[f]-g],M=k[o[f]-g]):(R=96,M=0),c=1<<m-C,d=1<<v,y=d;do{d-=c,i[p+(S>>C)+d]=E<<24|R<<16|M}while(0!==d);for(c=1<<m-1;S&c;)c>>=1;if(0!==c?(S&=c-1,S+=c):S=0,f++,0===--x[m]){if(m===b)break;m=e[n+o[f]]}if(m>w&&(S&u)!==h){for(0===C&&(C=w),p+=y,v=m-C,I=1<<v;v+C<b&&(I-=x[v+C],!(I<=0));)v++,I<<=1;if(_+=1<<v,1===t&&_>852||2===t&&_>592)return 1;h=S&u,i[h]=w<<24|v<<16|p-s}}return 0!==S&&(i[p+S]=m-C<<24|64<<16),a.bits=w,0};const{Z_FINISH:an,Z_BLOCK:ln,Z_TREES:cn,Z_OK:dn,Z_STREAM_END:hn,Z_NEED_DICT:un,Z_STREAM_ERROR:pn,Z_DATA_ERROR:gn,Z_MEM_ERROR:mn,Z_BUF_ERROR:fn,Z_DEFLATED:yn}=Rt,bn=16180,wn=16190,vn=16191,Cn=16192,In=16194,_n=16199,Sn=16200,kn=16206,xn=16209,An=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function En(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Rn=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<bn||e.mode>16211?1:0},Mn=t=>{if(Rn(t))return pn;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=bn,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,dn},Tn=t=>{if(Rn(t))return pn;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Mn(t)},zn=(t,e)=>{let n;if(Rn(t))return pn;const r=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?pn:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,Tn(t))},Ln=(t,e)=>{if(!t)return pn;const n=new En;t.state=n,n.strm=t,n.window=null,n.mode=bn;const r=zn(t,e);return r!==dn&&(t.state=null),r};let Dn,Nn,On=!0;const Fn=t=>{if(On){Dn=new Int32Array(512),Nn=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(on(1,t.lens,0,288,Dn,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;on(2,t.lens,0,32,Nn,0,t.work,{bits:5}),On=!1}t.lencode=Dn,t.lenbits=9,t.distcode=Nn,t.distbits=5},Bn=(t,e,n,r)=>{let i;const s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(e.subarray(n-r,n-r+i),s.wnext),(r-=i)?(s.window.set(e.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var Un=Tn,Zn=Ln,Pn=(t,e)=>{let n,r,i,s,o,a,l,c,d,h,u,p,g,m,f,y,b,w,v,C,I,_,S=0;const k=new Uint8Array(4);let x,A;const E=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Rn(t)||!t.output||!t.input&&0!==t.avail_in)return pn;n=t.state,n.mode===vn&&(n.mode=Cn),o=t.next_out,i=t.output,l=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,c=n.hold,d=n.bits,h=a,u=l,_=dn;t:for(;;)switch(n.mode){case bn:if(0===n.wrap){n.mode=Cn;break}for(;d<16;){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}if(2&n.wrap&&35615===c){0===n.wbits&&(n.wbits=15),n.check=0,k[0]=255&c,k[1]=c>>>8&255,n.check=At(n.check,k,2,0),c=0,d=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){t.msg="incorrect header check",n.mode=xn;break}if((15&c)!==yn){t.msg="unknown compression method",n.mode=xn;break}if(c>>>=4,d-=4,I=8+(15&c),0===n.wbits&&(n.wbits=I),I>15||I>n.wbits){t.msg="invalid window size",n.mode=xn;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&c?16189:vn,c=0,d=0;break;case 16181:for(;d<16;){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}if(n.flags=c,(255&n.flags)!==yn){t.msg="unknown compression method",n.mode=xn;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=xn;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&4&n.wrap&&(k[0]=255&c,k[1]=c>>>8&255,n.check=At(n.check,k,2,0)),c=0,d=0,n.mode=16182;case 16182:for(;d<32;){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}n.head&&(n.head.time=c),512&n.flags&&4&n.wrap&&(k[0]=255&c,k[1]=c>>>8&255,k[2]=c>>>16&255,k[3]=c>>>24&255,n.check=At(n.check,k,4,0)),c=0,d=0,n.mode=16183;case 16183:for(;d<16;){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&4&n.wrap&&(k[0]=255&c,k[1]=c>>>8&255,n.check=At(n.check,k,2,0)),c=0,d=0,n.mode=16184;case 16184:if(1024&n.flags){for(;d<16;){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&4&n.wrap&&(k[0]=255&c,k[1]=c>>>8&255,n.check=At(n.check,k,2,0)),c=0,d=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(p=n.length,p>a&&(p=a),p&&(n.head&&(I=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+p),I)),512&n.flags&&4&n.wrap&&(n.check=At(n.check,r,p,s)),a-=p,s+=p,n.length-=p),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===a)break t;p=0;do{I=r[s+p++],n.head&&I&&n.length<65536&&(n.head.name+=String.fromCharCode(I))}while(I&&p<a);if(512&n.flags&&4&n.wrap&&(n.check=At(n.check,r,p,s)),a-=p,s+=p,I)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===a)break t;p=0;do{I=r[s+p++],n.head&&I&&n.length<65536&&(n.head.comment+=String.fromCharCode(I))}while(I&&p<a);if(512&n.flags&&4&n.wrap&&(n.check=At(n.check,r,p,s)),a-=p,s+=p,I)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;d<16;){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}if(4&n.wrap&&c!==(65535&n.check)){t.msg="header crc mismatch",n.mode=xn;break}c=0,d=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=vn;break;case 16189:for(;d<32;){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}t.adler=n.check=An(c),c=0,d=0,n.mode=wn;case wn:if(0===n.havedict)return t.next_out=o,t.avail_out=l,t.next_in=s,t.avail_in=a,n.hold=c,n.bits=d,un;t.adler=n.check=1,n.mode=vn;case vn:if(e===ln||e===cn)break t;case Cn:if(n.last){c>>>=7&d,d-=7&d,n.mode=kn;break}for(;d<3;){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}switch(n.last=1&c,c>>>=1,d-=1,3&c){case 0:n.mode=16193;break;case 1:if(Fn(n),n.mode=_n,e===cn){c>>>=2,d-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=xn}c>>>=2,d-=2;break;case 16193:for(c>>>=7&d,d-=7&d;d<32;){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){t.msg="invalid stored block lengths",n.mode=xn;break}if(n.length=65535&c,c=0,d=0,n.mode=In,e===cn)break t;case In:n.mode=16195;case 16195:if(p=n.length,p){if(p>a&&(p=a),p>l&&(p=l),0===p)break t;i.set(r.subarray(s,s+p),o),a-=p,s+=p,l-=p,o+=p,n.length-=p;break}n.mode=vn;break;case 16196:for(;d<14;){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}if(n.nlen=257+(31&c),c>>>=5,d-=5,n.ndist=1+(31&c),c>>>=5,d-=5,n.ncode=4+(15&c),c>>>=4,d-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=xn;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;d<3;){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}n.lens[E[n.have++]]=7&c,c>>>=3,d-=3}for(;n.have<19;)n.lens[E[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,x={bits:n.lenbits},_=on(0,n.lens,0,19,n.lencode,0,n.work,x),n.lenbits=x.bits,_){t.msg="invalid code lengths set",n.mode=xn;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;S=n.lencode[c&(1<<n.lenbits)-1],f=S>>>24,y=S>>>16&255,b=65535&S,!(f<=d);){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}if(b<16)c>>>=f,d-=f,n.lens[n.have++]=b;else{if(16===b){for(A=f+2;d<A;){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}if(c>>>=f,d-=f,0===n.have){t.msg="invalid bit length repeat",n.mode=xn;break}I=n.lens[n.have-1],p=3+(3&c),c>>>=2,d-=2}else if(17===b){for(A=f+3;d<A;){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}c>>>=f,d-=f,I=0,p=3+(7&c),c>>>=3,d-=3}else{for(A=f+7;d<A;){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}c>>>=f,d-=f,I=0,p=11+(127&c),c>>>=7,d-=7}if(n.have+p>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=xn;break}for(;p--;)n.lens[n.have++]=I}}if(n.mode===xn)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=xn;break}if(n.lenbits=9,x={bits:n.lenbits},_=on(1,n.lens,0,n.nlen,n.lencode,0,n.work,x),n.lenbits=x.bits,_){t.msg="invalid literal/lengths set",n.mode=xn;break}if(n.distbits=6,n.distcode=n.distdyn,x={bits:n.distbits},_=on(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,x),n.distbits=x.bits,_){t.msg="invalid distances set",n.mode=xn;break}if(n.mode=_n,e===cn)break t;case _n:n.mode=Sn;case Sn:if(a>=6&&l>=258){t.next_out=o,t.avail_out=l,t.next_in=s,t.avail_in=a,n.hold=c,n.bits=d,tn(t,u),o=t.next_out,i=t.output,l=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,c=n.hold,d=n.bits,n.mode===vn&&(n.back=-1);break}for(n.back=0;S=n.lencode[c&(1<<n.lenbits)-1],f=S>>>24,y=S>>>16&255,b=65535&S,!(f<=d);){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}if(y&&!(240&y)){for(w=f,v=y,C=b;S=n.lencode[C+((c&(1<<w+v)-1)>>w)],f=S>>>24,y=S>>>16&255,b=65535&S,!(w+f<=d);){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}c>>>=w,d-=w,n.back+=w}if(c>>>=f,d-=f,n.back+=f,n.length=b,0===y){n.mode=16205;break}if(32&y){n.back=-1,n.mode=vn;break}if(64&y){t.msg="invalid literal/length code",n.mode=xn;break}n.extra=15&y,n.mode=16201;case 16201:if(n.extra){for(A=n.extra;d<A;){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;S=n.distcode[c&(1<<n.distbits)-1],f=S>>>24,y=S>>>16&255,b=65535&S,!(f<=d);){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}if(!(240&y)){for(w=f,v=y,C=b;S=n.distcode[C+((c&(1<<w+v)-1)>>w)],f=S>>>24,y=S>>>16&255,b=65535&S,!(w+f<=d);){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}c>>>=w,d-=w,n.back+=w}if(c>>>=f,d-=f,n.back+=f,64&y){t.msg="invalid distance code",n.mode=xn;break}n.offset=b,n.extra=15&y,n.mode=16203;case 16203:if(n.extra){for(A=n.extra;d<A;){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=xn;break}n.mode=16204;case 16204:if(0===l)break t;if(p=u-l,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=xn;break}p>n.wnext?(p-=n.wnext,g=n.wsize-p):g=n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=i,g=o-n.offset,p=n.length;p>l&&(p=l),l-=p,n.length-=p;do{i[o++]=m[g++]}while(--p);0===n.length&&(n.mode=Sn);break;case 16205:if(0===l)break t;i[o++]=n.length,l--,n.mode=Sn;break;case kn:if(n.wrap){for(;d<32;){if(0===a)break t;a--,c|=r[s++]<<d,d+=8}if(u-=l,t.total_out+=u,n.total+=u,4&n.wrap&&u&&(t.adler=n.check=n.flags?At(n.check,i,u,o-u):kt(n.check,i,u,o-u)),u=l,4&n.wrap&&(n.flags?c:An(c))!==n.check){t.msg="incorrect data check",n.mode=xn;break}c=0,d=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;d<32;){if(0===a)break t;a--,c+=r[s++]<<d,d+=8}if(4&n.wrap&&c!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=xn;break}c=0,d=0}n.mode=16208;case 16208:_=hn;break t;case xn:_=gn;break t;case 16210:return mn;default:return pn}return t.next_out=o,t.avail_out=l,t.next_in=s,t.avail_in=a,n.hold=c,n.bits=d,(n.wsize||u!==t.avail_out&&n.mode<xn&&(n.mode<kn||e!==an))&&Bn(t,t.output,t.next_out,u-t.avail_out),h-=t.avail_in,u-=t.avail_out,t.total_in+=h,t.total_out+=u,n.total+=u,4&n.wrap&&u&&(t.adler=n.check=n.flags?At(n.check,i,u,t.next_out-u):kt(n.check,i,u,t.next_out-u)),t.data_type=n.bits+(n.last?64:0)+(n.mode===vn?128:0)+(n.mode===_n||n.mode===In?256:0),(0===h&&0===u||e===an)&&_===dn&&(_=fn),_},Wn=t=>{if(Rn(t))return pn;let e=t.state;return e.window&&(e.window=null),t.state=null,dn},Gn=(t,e)=>{if(Rn(t))return pn;const n=t.state;return 2&n.wrap?(n.head=e,e.done=!1,dn):pn},Vn=(t,e)=>{const n=e.length;let r,i,s;return Rn(t)?pn:(r=t.state,0!==r.wrap&&r.mode!==wn?pn:r.mode===wn&&(i=1,i=kt(i,e,n,0),i!==r.check)?gn:(s=Bn(t,e,n,n),s?(r.mode=16210,mn):(r.havedict=1,dn)))},Hn=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Kn=Object.prototype.toString,{Z_NO_FLUSH:jn,Z_FINISH:Yn,Z_OK:qn,Z_STREAM_END:$n,Z_NEED_DICT:Xn,Z_STREAM_ERROR:Jn,Z_DATA_ERROR:Qn,Z_MEM_ERROR:tr}=Rt;function er(t){this.options=ze({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ue,this.strm.avail_out=0;let n=Zn(this.strm,e.windowBits);if(n!==qn)throw new Error(Et[n]);if(this.header=new Hn,Gn(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Oe(e.dictionary):"[object ArrayBuffer]"===Kn.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Vn(this.strm,e.dictionary),n!==qn)))throw new Error(Et[n])}function nr(t,e){const n=new er(e);if(n.push(t),n.err)throw n.msg||Et[n.err];return n.result}er.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(o=e===~~e?e:!0===e?Yn:jn,"[object ArrayBuffer]"===Kn.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=Pn(n,o),s===Xn&&i&&(s=Vn(n,i),s===qn?s=Pn(n,o):s===Qn&&(s=Xn));n.avail_in>0&&s===$n&&n.state.wrap>0&&0!==t[n.next_in];)Un(n),s=Pn(n,o);switch(s){case Jn:case Qn:case Xn:case tr:return this.onEnd(s),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||s===$n))if("string"===this.options.to){let t=Be(n.output,n.next_out),e=n.next_out-t,i=Fe(n.output,t);n.next_out=e,n.avail_out=r-e,e&&n.output.set(n.output.subarray(t,t+e),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==qn||0!==a){if(s===$n)return s=Wn(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},er.prototype.onData=function(t){this.chunks.push(t)},er.prototype.onEnd=function(t){t===qn&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Le(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var rr={Inflate:er,inflate:nr,inflateRaw:function(t,e){return(e=e||{}).raw=!0,nr(t,e)},ungzip:nr,constants:Rt};const{Deflate:ir,deflate:sr,deflateRaw:or,gzip:ar}=Je,{Inflate:lr,inflate:cr,inflateRaw:dr,ungzip:hr}=rr;var ur={Deflate:ir,deflate:sr,deflateRaw:or,gzip:ar,Inflate:lr,inflate:cr,inflateRaw:dr,ungzip:hr,constants:Rt};const pr=P(),gr={GZIP_LEVEL:6,IMAGE_MAX_WIDTH:1920,IMAGE_MAX_HEIGHT:1080,IMAGE_WEBP_QUALITY:.8,IMAGE_JPEG_QUALITY:.85,IMAGE_LOAD_TIMEOUT:3e3};let mr=null,fr=null,yr=null;function br(){return mr||(mr=new TextEncoder),mr}function wr(t){return"string"==typeof t?t:JSON.stringify(t)}async function vr(t,e){try{const n=wr(t),r=br().encode(n),i=e?.gzipLevel??gr.GZIP_LEVEL;return ur.gzip(r,{level:i})}catch(t){throw pr.error("Compression failed:",t),t}}function Cr(t,e){try{const e=ur.ungzip(t);return function(t){try{return JSON.parse(t)}catch{return t}}((fr||(fr=new TextDecoder),fr).decode(e))}catch(t){throw!1!==e?.verbose&&P().error("Decompression failed:",t),new Error(`Failed to decompress data: ${t instanceof Error?t.message:"Unknown error"}`)}}function Ir(){return"undefined"!=typeof document&&"undefined"!=typeof Image&&"undefined"!=typeof HTMLCanvasElement}async function _r(t,e){try{if(!Ir())return t;const n=e?.imageMaxWidth??gr.IMAGE_MAX_WIDTH,r=e?.imageMaxHeight??gr.IMAGE_MAX_HEIGHT,i=e?.webpQuality??gr.IMAGE_WEBP_QUALITY,s=e?.jpegQuality??gr.IMAGE_JPEG_QUALITY,o=gr.IMAGE_LOAD_TIMEOUT,a=await function(t,e){return new Promise((n,r)=>{const i=new Image,s=setTimeout(()=>{r(new Error(`Image load timeout after ${e}ms`))},e);i.onload=()=>{clearTimeout(s),n(i)},i.onerror=()=>{clearTimeout(s),r(new Error("Failed to load image"))},i.src=t})}(t,o),l=document.createElement("canvas"),c=l.getContext("2d");if(!c)throw new Error("Failed to get 2D canvas context");const{width:d,height:h}=function(t,e,n,r){let i=t,s=e;return i>n&&(s=s*n/i,i=n),s>r&&(i=i*r/s,s=r),{width:i,height:s}}(a.width,a.height,n,r);return l.width=d,l.height=h,c.drawImage(a,0,0,d,h),function(){if(null!==yr)return yr;if(!Ir())return yr=!1,!1;try{const t=document.createElement("canvas");yr=0===t.toDataURL("image/webp").indexOf("data:image/webp")}catch{yr=!1}return yr}()?l.toDataURL("image/webp",i):l.toDataURL("image/jpeg",s)}catch(n){return!1!==e?.verbose&&P().error("Image compression failed:",n),t}}function Sr(t,e){return t<=0?0:Math.round(100*(1-e/t))}function kr(t){const e=wr(t);return br().encode(e).length}class xr extends H{constructor(t={}){super(t)}getErrorPlaceholder(){return this.options.errorPlaceholder??"SCREENSHOT_FAILED"}shouldIncludeNode(t){if(!("hasAttribute"in t))return!0;const e=t,n=this.options.excludeAttribute||"data-bugspotter-exclude";return!e.hasAttribute(n)}buildCaptureOptions(){return{quality:this.options.quality??.8,cacheBust:this.options.cacheBust??true,pixelRatio:this.options.pixelRatio??window.devicePixelRatio,backgroundColor:this.options.backgroundColor??"#ffffff",...this.options.width&&{width:this.options.width},...this.options.height&&{height:this.options.height},filter:t=>this.shouldIncludeNode(t)}}async capture(t){try{const e=t||this.options.targetElement||document.body,n=this.buildCaptureOptions(),r=await async function(t,e={}){return(await async function(t,e={}){const{width:n,height:r}=a(t,e),i=await F(t,e),s=await c(i),o=document.createElement("canvas"),d=o.getContext("2d"),h=e.pixelRatio||function(){let t,e;try{e=process}catch(t){}const n=e&&e.env?e.env.devicePixelRatio:null;return n&&(t=parseInt(n,10),Number.isNaN(t)&&(t=1)),t||window.devicePixelRatio||1}(),u=e.canvasWidth||n,p=e.canvasHeight||r;return o.width=u*h,o.height=p*h,e.skipAutoScale||function(t){(t.width>l||t.height>l)&&(t.width>l&&t.height>l?t.width>t.height?(t.height*=l/t.width,t.width=l):(t.width*=l/t.height,t.height=l):t.width>l?(t.height*=l/t.width,t.width=l):(t.width*=l/t.height,t.height=l))}(o),o.style.width=`${u}`,o.style.height=`${p}`,e.backgroundColor&&(d.fillStyle=e.backgroundColor,d.fillRect(0,0,o.width,o.height)),d.drawImage(s,0,0,o.width,o.height),o}(t,e)).toDataURL()}(e,n);return await _r(r)}catch(t){return this.handleError("capturing screenshot",t),this.getErrorPlaceholder()}}}class Ar{constructor(t){if(this.maxSize=t,this.items=[],this.index=0,this.count=0,t<=0)throw new Error("CircularBuffer maxSize must be greater than 0")}add(t){this.count<this.maxSize?(this.items.push(t),this.count++):this.items[this.index]=t,this.index=(this.index+1)%this.maxSize}getAll(){return this.count<this.maxSize?[...this.items]:[...this.items.slice(this.index),...this.items.slice(0,this.index)]}clear(){this.items=[],this.index=0,this.count=0}get size(){return this.count}get capacity(){return this.maxSize}get isEmpty(){return 0===this.count}get isFull(){return this.count>=this.maxSize}}const Er=["log","warn","error","info","debug"];class Rr extends H{constructor(t={}){super(t),this.originalMethods=new Map;const e=t.maxLogs??100;this.buffer=new Ar(e),this.captureStackTrace=t.captureStackTrace??!0,this.interceptConsole(t.levels??Er)}capture(){return this.getLogs()}formatMessage(t){return t&&0!==t.length?(this.sanitizer?this.sanitizer.sanitizeConsoleArgs(t):t).map(t=>{if(null===t)return"null";if(void 0===t)return"undefined";if("object"==typeof t)try{return JSON.stringify(t)}catch(e){return`[${t.constructor?.name||"Object"}]`}return String(t)}).join(" "):""}createLogEntry(t,e){const n={level:t,message:this.formatMessage(e),timestamp:Date.now()};if(this.captureStackTrace&&"error"===t){const t=this.captureStack();n.stack=this.sanitizer&&t?this.sanitizer.sanitize(t):t}return n}captureStack(){const t=(new Error).stack;return t?.split("\n").slice(3).join("\n")}addLog(t){this.buffer.add(t)}interceptConsole(t=Er){t.forEach(t=>{try{const e=console[t];this.originalMethods.set(t,e),console[t]=(...n)=>{try{const e=this.createLogEntry(t,n);this.addLog(e)}catch(t){this.handleError("creating log entry",t)}e.apply(console,n)}}catch(e){this.handleError(`intercepting console.${t}`,e)}})}getLogs(){return this.buffer.getAll()}clear(){this.buffer.clear()}destroy(){try{this.originalMethods.forEach((t,e)=>{console[e]=t}),this.originalMethods.clear()}catch(t){this.handleError("destroying console capture",t)}}}class Mr extends H{constructor(t={}){super(t),this.isIntercepting=!1;const e=t.maxRequests??50;this.buffer=new Ar(e),this.filterUrls=t.filterUrls,this.originalFetch=window.fetch,this.originalXHR={open:XMLHttpRequest.prototype.open,send:XMLHttpRequest.prototype.send},this.interceptFetch(),this.interceptXHR(),this.isIntercepting=!0}capture(){return this.getRequests()}parseFetchArgs(t){const[e,n]=t;let r,i="GET";return"string"==typeof e?r=e:e instanceof Request?(r=e.url,i=e.method.toUpperCase()||"GET"):r=e.toString(),n?.method&&(i=n.method.toUpperCase()),{url:r,method:i}}createNetworkRequest(t,e,n,r,i){const s={url:t,method:e,status:n,duration:Date.now()-r,timestamp:r,...i&&{error:i}};if(this.sanitizer){const t=this.sanitizer.sanitizeNetworkData({url:s.url,method:s.method,status:s.status,...s.error&&{error:s.error}});return{...s,url:t.url||s.url,error:t.error}}return s}addRequest(t){this.filterUrls&&!this.filterUrls(t.url)||this.buffer.add(t)}interceptFetch(){const t=this.originalFetch;window.fetch=async(...e)=>{const n=Date.now();let r="",i="GET";try{({url:r,method:i}=this.parseFetchArgs(e))}catch(t){this.handleError("parsing fetch arguments",t)}try{const s=await t(...e),o=this.createNetworkRequest(r,i,s.status,n);return this.addRequest(o),s}catch(t){const e=this.createNetworkRequest(r,i,0,n,t.message);throw this.addRequest(e),t}}}interceptXHR(){const t=this.originalXHR.open,e=this.originalXHR.send,n=this;XMLHttpRequest.prototype.open=function(e,n,...r){return this._method=e.toUpperCase(),this._url=n.toString(),this._startTime=Date.now(),t.apply(this,[e,n,...r])},XMLHttpRequest.prototype.send=function(...t){return this.addEventListener("load",()=>{const t=n.createNetworkRequest(this._url||"",this._method||"GET",this.status,this._startTime||Date.now());n.addRequest(t)}),this.addEventListener("error",()=>{const t=n.createNetworkRequest(this._url||"",this._method||"GET",0,this._startTime||Date.now(),"XMLHttpRequest failed");n.addRequest(t)}),e.apply(this,t)}}getRequests(){return this.buffer.getAll()}clear(){this.buffer.clear()}destroy(){if(this.isIntercepting)try{window.fetch=this.originalFetch,XMLHttpRequest.prototype.open=this.originalXHR.open,XMLHttpRequest.prototype.send=this.originalXHR.send,this.isIntercepting=!1}catch(t){this.handleError("destroying network capture",t)}}}class Tr extends H{constructor(t={}){super(t),this.browserPatterns=[{pattern:"Edg",name:"Edge"},{pattern:"Chrome",exclude:"Edge",name:"Chrome"},{pattern:"Firefox",name:"Firefox"},{pattern:"Safari",exclude:"Chrome",name:"Safari"}],this.osPatterns=[{patterns:["iPhone","iPad"],name:"iOS"},{patterns:["Android"],name:"Android"},{patterns:["Win"],name:"Windows"},{patterns:["Mac"],name:"macOS"},{patterns:["Linux"],name:"Linux"}]}capture(){try{const t={userAgent:navigator.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight},browser:this.detectBrowser(),os:this.detectOS(),url:window.location.href,timestamp:Date.now()};return this.sanitizer&&(t.url=this.sanitizer.sanitize(t.url),t.userAgent=this.sanitizer.sanitize(t.userAgent)),t}catch(t){return this.handleError("capturing metadata",t),{userAgent:"Unknown",viewport:{width:0,height:0},browser:"Unknown",os:"Unknown",url:"Unknown",timestamp:Date.now()}}}detectBrowser(){const t=navigator.userAgent;for(const{pattern:e,exclude:n,name:r}of this.browserPatterns)if(t.includes(e)&&(!n||!t.includes(n)))return r;return"Unknown"}detectOS(){const t=navigator.userAgent;for(const{patterns:e,name:n}of this.osPatterns)if(e.some(e=>t.includes(e)))return n;return"Unknown"}}const zr={"api-key":t=>{const e=t.apiKey;return e?{"X-API-Key":e}:{}},jwt:t=>{const e=t.token;return e?{Authorization:`Bearer ${e}`}:{}},bearer:t=>{const e=t.token;return e?{Authorization:`Bearer ${e}`}:{}},custom:t=>{const e=t.customHeader;if(!e)return{};const{name:n,value:r}=e;return n&&r?{[n]:r}:{}},none:()=>({})};function Lr(t){if("string"==typeof t)return{Authorization:`Bearer ${t}`};if(!t)return{};const e=zr[t.type];return e?e(t):{}}async function Dr(t,e,n,r){let i,s=P(),o=!0;if(r&&"object"==typeof r&&"auth"in r){const t=r;i=t.auth,s=t.logger||P(),o=t.enableRetry??!0}else i=r;const a=await Nr(t,e,n,i);return 401===a.status&&o&&function(t){return"object"==typeof t&&("jwt"===t.type||"bearer"===t.type)&&"function"==typeof t.onTokenExpired}(i)?await async function(t,e,n,r,i){try{i.warn("Token expired, attempting refresh...");const s=await r.onTokenExpired(),o={...r,token:s},a=await Nr(t,e,n,o);return i.log("Request retried with refreshed token"),a}catch(t){return i.error("Token refresh failed:",t),new Response(null,{status:401,statusText:"Unauthorized"})}}(t,e,n,i,s):a}async function Nr(t,e,n,r){const i={...n,...Lr(r)};return fetch(t,{method:"POST",headers:i,body:e})}const Or={position:"bottom-right",icon:"",backgroundColor:"#ef4444",size:60,offset:{x:20,y:20},zIndex:999999},Fr="0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06)",Br="0 10px 15px rgba(0, 0, 0, 0.2), 0 4px 6px rgba(0, 0, 0, 0.1)",Ur="scale(1)",Zr="scale(1.1)",Pr="scale(0.95)";class Wr{constructor(t={}){this.eventHandlers=new Map,this.handleMouseEnter=()=>{this.button.style.transform=Zr,this.button.style.boxShadow=Br},this.handleMouseLeave=()=>{this.button.style.transform=Ur,this.button.style.boxShadow=Fr},this.handleMouseDown=()=>{this.button.style.transform=Pr},this.handleMouseUp=()=>{this.button.style.transform=Zr},this.options={position:t.position??Or.position,icon:t.icon??Or.icon,backgroundColor:t.backgroundColor??Or.backgroundColor,size:t.size??Or.size,offset:t.offset??Or.offset,zIndex:t.zIndex??Or.zIndex},this.button=this.createButton(),document.body?document.body.appendChild(this.button):document.addEventListener("DOMContentLoaded",()=>{document.body.appendChild(this.button)})}createButton(){const t=document.createElement("button");return t.textContent=this.options.icon,t.setAttribute("aria-label","Report Bug"),t.setAttribute("data-bugspotter-exclude","true"),t.style.cssText=this.getButtonStyles(),this.addHoverEffects(t),t}getButtonStyles(){const{position:t,size:e,offset:n,backgroundColor:r,zIndex:i}=this.options;return`\n      position: fixed;\n      ${this.getPositionStyles(t,n)}\n      width: ${e}px;\n      height: ${e}px;\n      border-radius: 50%;\n      background: ${r};\n      color: white;\n      border: none;\n      cursor: pointer;\n      font-size: ${.5*e}px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      box-shadow: ${Fr};\n      transition: transform 0.2s ease, box-shadow 0.2s ease;\n      z-index: ${i};\n    `}getPositionStyles(t,e){switch(t){case"bottom-right":default:return`bottom: ${e.y}px; right: ${e.x}px;`;case"bottom-left":return`bottom: ${e.y}px; left: ${e.x}px;`;case"top-right":return`top: ${e.y}px; right: ${e.x}px;`;case"top-left":return`top: ${e.y}px; left: ${e.x}px;`}}addHoverEffects(t){const e={mouseenter:this.handleMouseEnter,mouseleave:this.handleMouseLeave,mousedown:this.handleMouseDown,mouseup:this.handleMouseUp};Object.entries(e).forEach(([e,n])=>{t.addEventListener(e,n),this.eventHandlers.set(e,n)})}onClick(t){this.button.addEventListener("click",t)}show(){this.button.style.display="flex"}hide(){this.button.style.display="none"}setIcon(t){this.button.textContent=t}setBackgroundColor(t){this.button.style.backgroundColor=t}destroy(){this.eventHandlers.forEach((t,e)=>{this.button.removeEventListener(e,t)}),this.eventHandlers.clear(),this.button.remove()}}class Gr{constructor(t={}){this.config={primaryColor:t.primaryColor||"#007bff",dangerColor:t.dangerColor||"#dc3545",borderRadius:t.borderRadius||"4px",fontFamily:t.fontFamily||'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',zIndex:t.zIndex||999999}}generateStyles(){return`\n      .overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.5);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: ${this.config.zIndex};\n        font-family: ${this.config.fontFamily};\n      }\n      \n      .modal {\n        background: white;\n        border-radius: 8px;\n        width: 90%;\n        max-width: 600px;\n        max-height: 90vh;\n        overflow-y: auto;\n        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n      }\n      \n      .header {\n        padding: 20px;\n        border-bottom: 1px solid #e0e0e0;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n      \n      .header h2 {\n        margin: 0;\n        font-size: 20px;\n        font-weight: 600;\n      }\n      \n      .close {\n        background: none;\n        border: none;\n        font-size: 24px;\n        cursor: pointer;\n        color: #666;\n        padding: 0;\n        width: 30px;\n        height: 30px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        border-radius: ${this.config.borderRadius};\n      }\n      \n      .close:hover {\n        background: #f0f0f0;\n      }\n      \n      .body {\n        padding: 20px;\n      }\n      \n      .form-group {\n        margin-bottom: 20px;\n      }\n      \n      .label {\n        display: block;\n        margin-bottom: 8px;\n        font-weight: 500;\n        font-size: 14px;\n      }\n      \n      .input,\n      .textarea {\n        width: 100%;\n        padding: 10px;\n        border: 1px solid #ddd;\n        border-radius: ${this.config.borderRadius};\n        font-size: 14px;\n        font-family: ${this.config.fontFamily};\n        box-sizing: border-box;\n      }\n      \n      .input:focus,\n      .textarea:focus {\n        outline: none;\n        border-color: ${this.config.primaryColor};\n      }\n      \n      .textarea {\n        min-height: 100px;\n        resize: vertical;\n      }\n      \n      .screenshot-container {\n        margin-top: 10px;\n        position: relative;\n      }\n      \n      .screenshot {\n        max-width: 100%;\n        border: 1px solid #ddd;\n        border-radius: ${this.config.borderRadius};\n      }\n      \n      .redaction-canvas {\n        position: absolute;\n        top: 0;\n        left: 0;\n        cursor: crosshair;\n        border: 2px solid ${this.config.primaryColor};\n        border-radius: ${this.config.borderRadius};\n      }\n      \n      .redaction-controls {\n        margin-top: 10px;\n        display: flex;\n        gap: 10px;\n      }\n      \n      .btn-redact,\n      .btn-clear {\n        padding: 8px 16px;\n        border: 1px solid #ddd;\n        border-radius: ${this.config.borderRadius};\n        background: white;\n        cursor: pointer;\n        font-size: 14px;\n      }\n      \n      .btn-redact:hover,\n      .btn-clear:hover {\n        background: #f5f5f5;\n      }\n      \n      .btn-redact.active {\n        background: ${this.config.primaryColor};\n        color: white;\n        border-color: ${this.config.primaryColor};\n      }\n      \n      .pii-section {\n        margin-top: 20px;\n        padding: 15px;\n        background: #fff3cd;\n        border: 1px solid #ffc107;\n        border-radius: ${this.config.borderRadius};\n      }\n      \n      .pii-title {\n        margin: 0 0 10px 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: #856404;\n      }\n      \n      .pii-list {\n        margin: 0;\n        padding-left: 20px;\n        font-size: 13px;\n        color: #856404;\n      }\n      \n      .pii-badge {\n        display: inline-block;\n        padding: 2px 8px;\n        margin: 2px;\n        background: #ffc107;\n        color: #856404;\n        border-radius: 12px;\n        font-size: 12px;\n        font-weight: 500;\n      }\n      \n      .checkbox-group {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        margin-top: 15px;\n      }\n      \n      .checkbox {\n        width: 18px;\n        height: 18px;\n        cursor: pointer;\n      }\n      \n      .checkbox-label {\n        margin: 0;\n        font-size: 14px;\n        cursor: pointer;\n        user-select: none;\n      }\n      \n      .footer {\n        padding: 20px;\n        border-top: 1px solid #e0e0e0;\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n      }\n      \n      .btn {\n        padding: 10px 20px;\n        border: none;\n        border-radius: ${this.config.borderRadius};\n        cursor: pointer;\n        font-size: 14px;\n        font-weight: 500;\n      }\n      \n      .btn-primary {\n        background: ${this.config.primaryColor};\n        color: white;\n      }\n      \n      .btn-primary:hover {\n        opacity: 0.9;\n      }\n      \n      .btn-primary:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n      \n      .btn-secondary {\n        background: #6c757d;\n        color: white;\n      }\n      \n      .btn-secondary:hover {\n        opacity: 0.9;\n      }\n      \n      .error {\n        color: ${this.config.dangerColor};\n        font-size: 12px;\n        margin-top: 4px;\n      }\n    `}injectStyles(){const t=document.createElement("style");return t.textContent=this.generateStyles(),document.head.appendChild(t),t}removeStyles(t){t&&t.parentNode&&t.parentNode.removeChild(t)}updateConfig(t){this.config={...this.config,...t}}getConfig(){return{...this.config}}}class Vr{constructor(t={}){this.config={title:t.title||"Report a Bug",titlePlaceholder:t.titlePlaceholder||"Brief description of the issue",descriptionPlaceholder:t.descriptionPlaceholder||"Detailed description of what happened...",submitButtonText:t.submitButtonText||"Submit Bug Report",cancelButtonText:t.cancelButtonText||"Cancel",showScreenshot:!1!==t.showScreenshot}}generateModalHTML(t){return`\n      <div class="overlay">\n        <div class="modal">\n          ${this.generateHeader()}\n          ${this.generateBody(t)}\n          ${this.generateFooter()}\n        </div>\n      </div>\n    `}generateHeader(){return`\n      <div class="header">\n        <h2>${this.escapeHtml(this.config.title)}</h2>\n        <button class="close" aria-label="Close">&times;</button>\n      </div>\n    `}generateBody(t){return`\n      <div class="body">\n        <form class="form">\n          ${this.generateTitleField()}\n          ${this.generateDescriptionField()}\n          ${this.config.showScreenshot&&t?this.generateScreenshotSection(t):""}\n          ${this.generatePIISection()}\n        </form>\n      </div>\n    `}generateTitleField(){return`\n      <div class="form-group">\n        <label class="label" for="title">Title *</label>\n        <input\n          type="text"\n          id="title"\n          class="input"\n          placeholder="${this.escapeHtml(this.config.titlePlaceholder)}"\n          required\n        />\n        <div class="error" id="title-error"></div>\n      </div>\n    `}generateDescriptionField(){return`\n      <div class="form-group">\n        <label class="label" for="description">Description *</label>\n        <textarea\n          id="description"\n          class="textarea"\n          placeholder="${this.escapeHtml(this.config.descriptionPlaceholder)}"\n          required\n        ></textarea>\n        <div class="error" id="description-error"></div>\n      </div>\n    `}generateScreenshotSection(t){return`\n      <div class="form-group">\n        <label class="label">Screenshot</label>\n        <div class="screenshot-container">\n          <img \n            src="${t}" \n            alt="Bug screenshot" \n            class="screenshot"\n            id="screenshot"\n          />\n          <canvas \n            class="redaction-canvas" \n            id="redaction-canvas"\n            style="display: none;"\n          ></canvas>\n        </div>\n        <div class="redaction-controls">\n          <button \n            type="button" \n            class="btn-redact" \n            id="btn-redact"\n          >\n             Redact Area\n          </button>\n          <button \n            type="button" \n            class="btn-clear" \n            id="btn-clear"\n          >\n             Clear Redactions\n          </button>\n        </div>\n      </div>\n    `}generatePIISection(){return'\n      <div class="pii-section" id="pii-section" style="display: none;">\n        <h3 class="pii-title"> Potential PII Detected</h3>\n        <div id="pii-content"></div>\n        <div class="checkbox-group">\n          <input \n            type="checkbox" \n            id="pii-confirm" \n            class="checkbox"\n          />\n          <label for="pii-confirm" class="checkbox-label">\n            I have reviewed and redacted sensitive information\n          </label>\n        </div>\n      </div>\n    '}generateFooter(){return`\n      <div class="footer">\n        <button type="button" class="btn btn-secondary" id="btn-cancel">\n          ${this.escapeHtml(this.config.cancelButtonText)}\n        </button>\n        <button type="submit" class="btn btn-primary submit" id="btn-submit">\n          ${this.escapeHtml(this.config.submitButtonText)}\n        </button>\n      </div>\n    `}generatePIIBadge(t,e){return`<span class="bugspotter-pii-badge">${this.escapeHtml(t)}: ${e}</span>`}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}updateConfig(t){this.config={...this.config,...t}}getConfig(){return{...this.config}}}class Hr{constructor(){this.elements=null,this.container=null}initialize(t){this.container=t;const e=this.getRequiredElement(".overlay",t),n=this.getRequiredElement(".modal",e),r=this.getRequiredElement(".form",n);return this.elements={overlay:e,modal:n,closeButton:this.getRequiredElement(".close",n),form:r,titleInput:this.getRequiredElement("#title",r),titleError:this.getRequiredElement("#title-error",r),descriptionTextarea:this.getRequiredElement("#description",r),descriptionError:this.getRequiredElement("#description-error",r),screenshotImg:this.getOptionalElement("#screenshot",n),redactionCanvas:this.getOptionalElement("#redaction-canvas",n),redactButton:this.getOptionalElement("#btn-redact",n),clearButton:this.getOptionalElement("#btn-clear",n),piiSection:this.getRequiredElement("#pii-section",n),piiContent:this.getRequiredElement("#pii-content",n),piiConfirmCheckbox:this.getRequiredElement("#pii-confirm",n),cancelButton:this.getRequiredElement("#btn-cancel",n),submitButton:this.getRequiredElement("#btn-submit",n)},this.elements}get(){if(!this.elements)throw new Error("DOMElementCache not initialized. Call initialize() first.");return this.elements}isInitialized(){return null!==this.elements}clear(){this.elements=null,this.container=null}getRequiredElement(t,e){const n=(e||this.container||document).querySelector(t);if(!n)throw new Error(`Required element not found: ${t}`);return n}getOptionalElement(t,e){return(e||this.container||document).querySelector(t)||void 0}refreshElement(t,e){if(!this.elements||!this.container)throw new Error("DOMElementCache not initialized");const n=this.container.querySelector(e);n&&(this.elements[t]=n)}getContainer(){return this.container}}class Kr{constructor(t={}){this.minTitleLength=t.minTitleLength||3,this.maxTitleLength=t.maxTitleLength||200,this.minDescriptionLength=t.minDescriptionLength||10,this.maxDescriptionLength=t.maxDescriptionLength||5e3}validate(t){const e={},n=this.validateTitle(t.title);n&&(e.title=n);const r=this.validateDescription(t.description);return r&&(e.description=r),t.piiDetected&&!t.piiConfirmed&&(e.piiConfirmation="Please confirm you have reviewed sensitive information"),{isValid:0===Object.keys(e).length,errors:e}}validateTitle(t){const e=t.trim();return e?e.length<this.minTitleLength?`Title must be at least ${this.minTitleLength} characters`:e.length>this.maxTitleLength?`Title must not exceed ${this.maxTitleLength} characters`:null:"Title is required"}validateDescription(t){const e=t.trim();return e?e.length<this.minDescriptionLength?`Description must be at least ${this.minDescriptionLength} characters`:e.length>this.maxDescriptionLength?`Description must not exceed ${this.maxDescriptionLength} characters`:null:"Description is required"}validateField(t,e,n){switch(t){case"title":return this.validateTitle(e);case"description":return this.validateDescription(e);case"piiConfirmed":return n?.piiDetected&&!e?"Please confirm you have reviewed sensitive information":null;default:return null}}isEmpty(t){return!t||0===t.trim().length}sanitizeInput(t){return t.trim()}getConfig(){return{minTitleLength:this.minTitleLength,maxTitleLength:this.maxTitleLength,minDescriptionLength:this.minDescriptionLength,maxDescriptionLength:this.maxDescriptionLength}}}class jr{constructor(t={}){this.config={showExamples:!1!==t.showExamples,groupByType:!1!==t.groupByType,maxExamplesPerType:t.maxExamplesPerType||3}}render(t,e){t&&0!==t.length?this.config.groupByType?e.innerHTML=this.renderGroupedPII(t):e.innerHTML=this.renderListPII(t):e.innerHTML=""}renderGroupedPII(t){const e=this.groupByType(t),n=[];for(const[t,r]of Object.entries(e)){const e=r.reduce((t,e)=>t+e.count,0);n.push(this.createBadge(t,e))}let r=`<div class="bugspotter-pii-badges">${n.join("")}</div>`;if(this.config.showExamples){r+='<div class="bugspotter-pii-details">',r+='<p style="margin: 10px 0 5px 0; font-size: 13px; color: #856404;">Detected types:</p>',r+='<ul class="bugspotter-pii-list">';for(const[t,n]of Object.entries(e)){const e=n.reduce((t,e)=>t+e.count,0);r+=`<li><strong>${this.escapeHtml(t)}:</strong> ${e} occurrence${1!==e?"s":""}</li>`}r+="</ul></div>"}return r}renderListPII(t){let e='<ul class="bugspotter-pii-list">';for(const n of t)e+=`<li>${this.escapeHtml(n.type)}: ${n.count} occurrence${1!==n.count?"s":""}</li>`;return e+="</ul>",e}createBadge(t,e){return`<span class="bugspotter-pii-badge">${this.escapeHtml(t)}: ${e}</span>`}groupByType(t){const e={};for(const n of t)e[n.type]||(e[n.type]=[]),e[n.type].push(n);return e}getSummary(t){const e=new Set;for(const n of t)e.add(n.type);return{totalCount:t.length,typeCount:e.size,types:Array.from(e)}}hasType(t,e){return t.some(t=>t.type===e)}filterByType(t,e){return t.filter(t=>t.type===e)}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}updateConfig(t){this.config={...this.config,...t}}getConfig(){return{...this.config}}}class Yr{constructor(t,e={}){this.isDrawing=!1,this.isRedactionMode=!1,this.startX=0,this.startY=0,this.redactionRects=[],this.canvas=t;const n=t.getContext("2d");if(!n)throw new Error("Failed to get 2D context from canvas");this.ctx=n,this.config={redactionColor:e.redactionColor||"#000000",cursorStyle:e.cursorStyle||"crosshair"},this.handleMouseDown=this.onMouseDown.bind(this),this.handleMouseMove=this.onMouseMove.bind(this),this.handleMouseUp=this.onMouseUp.bind(this)}initializeCanvas(t){const e=()=>{const e=t.getBoundingClientRect(),n=e.width||t.width,r=e.height||t.height;this.canvas.width=t.naturalWidth||t.width,this.canvas.height=t.naturalHeight||t.height,this.canvas.style.width=`${n}px`,this.canvas.style.height=`${r}px`};t.complete&&t.naturalWidth>0?e():t.addEventListener("load",e,{once:!0})}enableRedactionMode(){this.isRedactionMode||(this.isRedactionMode=!0,this.canvas.style.display="block",this.canvas.style.cursor=this.config.cursorStyle,this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseup",this.handleMouseUp),this.redraw())}disableRedactionMode(){this.isRedactionMode&&(this.isRedactionMode=!1,this.isDrawing=!1,this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mouseup",this.handleMouseUp),this.canvas.style.cursor="default")}toggleRedactionMode(){return this.isRedactionMode?this.disableRedactionMode():this.enableRedactionMode(),this.isRedactionMode}clearRedactions(){this.redactionRects=[],this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}getRedactions(){return[...this.redactionRects]}setRedactions(t){this.redactionRects=[...t],this.redraw()}isActive(){return this.isRedactionMode}getCanvas(){return this.canvas}toDataURL(t="image/png",e){return this.canvas.toDataURL(t,e)}hide(){this.canvas.style.display="none"}show(){this.canvas.style.display="block"}destroy(){this.disableRedactionMode(),this.clearRedactions()}onMouseDown(t){if(!this.isRedactionMode)return;const e=this.canvas.getBoundingClientRect(),n=this.canvas.width/e.width,r=this.canvas.height/e.height;this.startX=(t.clientX-e.left)*n,this.startY=(t.clientY-e.top)*r,this.isDrawing=!0}onMouseMove(t){if(!this.isDrawing||!this.isRedactionMode)return;const e=this.canvas.getBoundingClientRect(),n=this.canvas.width/e.width,r=this.canvas.height/e.height,i=(t.clientX-e.left)*n,s=(t.clientY-e.top)*r;this.redraw(),this.drawRect(this.startX,this.startY,i-this.startX,s-this.startY)}onMouseUp(t){if(!this.isDrawing||!this.isRedactionMode)return;const e=this.canvas.getBoundingClientRect(),n=this.canvas.width/e.width,r=this.canvas.height/e.height,i=(t.clientX-e.left)*n,s=(t.clientY-e.top)*r,o=i-this.startX,a=s-this.startY;Math.abs(o)>5&&Math.abs(a)>5&&this.redactionRects.push({x:this.startX,y:this.startY,width:o,height:a}),this.isDrawing=!1,this.redraw()}redraw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(const t of this.redactionRects)this.drawRect(t.x,t.y,t.width,t.height)}drawRect(t,e,n,r){this.ctx.fillStyle=this.config.redactionColor,this.ctx.fillRect(t,e,n,r)}updateConfig(t){this.config={...this.config,...t},this.isRedactionMode&&(this.canvas.style.cursor=this.config.cursorStyle)}getConfig(){return{...this.config}}}class qr{async mergeRedactions(t,e){return new Promise((n,r)=>{const i=new Image;i.onload=()=>{try{const t=document.createElement("canvas");t.width=i.naturalWidth||i.width,t.height=i.naturalHeight||i.height;const s=t.getContext("2d");if(!s)return void r(new Error("Failed to get canvas context"));s.drawImage(i,0,0),s.drawImage(e,0,0),n(t.toDataURL())}catch(t){r(t)}},i.onerror=()=>{r(new Error("Failed to load screenshot image"))},i.src=t})}async applyRedactions(t,e,n="#000000"){return new Promise((r,i)=>{const s=new Image;s.onload=()=>{try{const t=document.createElement("canvas");t.width=s.naturalWidth||s.width,t.height=s.naturalHeight||s.height;const o=t.getContext("2d");if(!o)return void i(new Error("Failed to get canvas context"));o.drawImage(s,0,0),o.fillStyle=n;for(const t of e)o.fillRect(t.x,t.y,t.width,t.height);r(t.toDataURL())}catch(t){i(t)}},s.onerror=()=>{i(new Error("Failed to load image"))},s.src=t})}async resize(t,e,n){return new Promise((r,i)=>{const s=new Image;s.onload=()=>{try{let t=s.naturalWidth||s.width,o=s.naturalHeight||s.height;if(t>e||o>n){const r=t/o;t>o?(t=e,o=t/r):(o=n,t=o*r)}const a=document.createElement("canvas");a.width=t,a.height=o;const l=a.getContext("2d");if(!l)return void i(new Error("Failed to get canvas context"));l.drawImage(s,0,0,t,o),r(a.toDataURL())}catch(t){i(t)}},s.onerror=()=>{i(new Error("Failed to load image"))},s.src=t})}async convert(t,e,n=.92){return new Promise((r,i)=>{const s=new Image;s.onload=()=>{try{const t=document.createElement("canvas");t.width=s.naturalWidth||s.width,t.height=s.naturalHeight||s.height;const o=t.getContext("2d");if(!o)return void i(new Error("Failed to get canvas context"));o.drawImage(s,0,0),r(t.toDataURL(e,n))}catch(t){i(t)}},s.onerror=()=>{i(new Error("Failed to load image"))},s.src=t})}async getDimensions(t){return new Promise((e,n)=>{const r=new Image;r.onload=()=>{e({width:r.naturalWidth||r.width,height:r.naturalHeight||r.height})},r.onerror=()=>{n(new Error("Failed to load image"))},r.src=t})}isValidDataURL(t){return/^data:image\/(png|jpeg|jpg|webp|gif);base64,/.test(t)}getEstimatedSize(t){const e=t.split(",")[1]||"";return Math.ceil(3*e.length/4)}getFormat(t){const e=t.match(/^data:image\/([a-z]+);base64,/);return e?e[1]:null}}const $r={email:{name:"email",regex:/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g,description:"Email addresses",examples:["user@example.com","john.doe+tag@company.co.uk","test_user@sub.domain.com"],priority:1},creditcard:{name:"creditcard",regex:/\b(?:\d{4}[-\s]){3}\d{4}\b|\b\d{4}[-\s]\d{6}[-\s]\d{5}\b|\b\d{13,19}\b/g,description:"Credit card numbers (Visa, MC, Amex, Discover, etc.)",examples:["4532-1488-0343-6467","4532148803436467","5425 2334 3010 9903","3782 822463 10005"],priority:2},ssn:{name:"ssn",regex:/\b\d{3}-\d{2}-\d{4}\b|\b(?<!\d)\d{9}(?!\d)\b/g,description:"US Social Security Numbers",examples:["123-45-6789","987654321"],priority:3},iin:{name:"iin",regex:/\b[0-9]{2}(?:0[1-9]|1[0-2])(?:0[1-9]|[12][0-9]|3[01])\d{6}\b/g,description:"Kazakhstan IIN/BIN (12 digits with date validation)",examples:["950315300123","880612500456","021225123456"],priority:4},ip:{name:"ip",regex:/\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b|(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}\b/g,description:"IPv4 and IPv6 addresses",examples:["192.168.1.100","127.0.0.1","2001:0db8:85a3:0000:0000:8a2e:0370:7334"],priority:5},phone:{name:"phone",regex:/\+\d{1,3}[-.\s]\d{3}[-.\s]\d{4}\b|\+\d{1,3}[-.\s]\d{3}[-.\s]\d{3}[-.\s]\d{4}\b|\(\d{3}\)\s*\d{3}[-.\s]\d{4}\b|\b\d{3}[-.\s]\d{3}[-.\s]\d{4}\b/g,description:"International phone numbers",examples:["+1-555-1234","+1-555-123-4567","(555) 123-4567","555-123-4567","+7 777 123 4567"],priority:6},apikey:{name:"apikey",regex:/\b(?:sk|pk)_(?:live|test)_[a-zA-Z0-9]{24,}\b|AIza[a-zA-Z0-9_-]{35}|ya29\.[a-zA-Z0-9_-]+|AKIA[a-zA-Z0-9]{16}\b/g,description:"API keys (Stripe, Google, AWS, etc.)",examples:["sk_live_abc123def456ghi789jkl","pk_test_xyz789abc123def456","AIzaSyD1234567890abcdefghijklmnopqrst","AKIAIOSFODNN7EXAMPLE"],priority:7},token:{name:"token",regex:/\b(?:Bearer\s+)?[a-zA-Z0-9_-]{32,}\b|ghp_[a-zA-Z0-9]{36}|gho_[a-zA-Z0-9]{36}|github_pat_[a-zA-Z0-9_]{82}/g,description:"Authentication tokens (Bearer, GitHub, JWT-like)",examples:["Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9","ghp_abc123def456ghi789jkl012mno345pqr","gho_xyz789abc123def456ghi789jkl012mno"],priority:8},password:{name:"password",regex:/(?:password|passwd|pwd)[\s:=]+[^\s]{6,}|(?:password|passwd|pwd)["']?\s*[:=]\s*["']?[^\s"']{6,}/gi,description:"Password fields in text (password=..., pwd:...)",examples:["password: MySecret123!","passwd=SecurePass456",'pwd: "MyP@ssw0rd"'],priority:9}},Xr={financial:["creditcard","ssn"],contact:["email","phone"],identification:["ssn","iin"],network:["ip","email"],credentials:["apikey","token","password"],kazakhstan:["iin"]};function Jr(t){return $r[t]}function Qr(t){return Xr[t].map(t=>$r[t])}class ti{constructor(){this.pattern={}}name(t){return this.pattern.name=t,this}regex(t){if(t.global)this.pattern.regex=t;else{const e=t.flags.includes("g")?t.flags:t.flags+"g";this.pattern.regex=new RegExp(t.source,e)}return this}description(t){return this.pattern.description=t,this}examples(t){return this.pattern.examples=t,this}priority(t){return this.pattern.priority=t,this}build(){if(!this.pattern.name||!this.pattern.regex)throw new Error("Pattern must have at least name and regex");return{name:this.pattern.name,regex:this.pattern.regex,description:this.pattern.description||this.pattern.name,examples:this.pattern.examples||[],priority:this.pattern.priority??99}}}const ei={all:Object.keys($r),minimal:["email","creditcard","ssn"],financial:Xr.financial,contact:Xr.contact,identification:Xr.identification,credentials:Xr.credentials,kazakhstan:["email","phone","iin"],gdpr:["email","phone","ip"],pci:["creditcard"],security:["email","phone","creditcard","ssn","apikey","token","password"]};function ni(t){return("string"==typeof t?ei[t]:t).map(t=>$r[t])}function ri(t){const e=[];if(t.name||e.push("Pattern must have a name"),t.regex){t.regex.global||e.push("Pattern regex must have global flag");try{const n="a".repeat(1e3),r=Date.now();n.match(t.regex);const i=Date.now()-r;i>100&&e.push(`Pattern regex may cause performance issues (took ${i}ms on test)`)}catch(t){e.push(`Pattern regex error: ${t.message}`)}}else e.push("Pattern must have a regex");return t.priority<0&&e.push("Pattern priority must be non-negative"),{valid:0===e.length,errors:e}}class ii{constructor(t,e){this.patterns=new Map,this.initializePatterns(t,e)}initializePatterns(t,e){let n;var r;n="string"==typeof t?ei[t]:t.filter(t=>"custom"!==t),(r=n.map(t=>$r[t]),[...r].sort((t,e)=>t.priority-e.priority)).forEach(t=>{this.patterns.set(t.name,t.regex)}),e.forEach(t=>{this.patterns.set(t.name,t.regex)})}getPatterns(){return this.patterns}}class si{constructor(t){this.patterns=t}sanitize(t){if("string"!=typeof t)return t;let e=t;return this.patterns.forEach((t,n)=>{const r=n.toUpperCase();e=e.replace(t,`[REDACTED-${r}]`)}),e}}class oi{constructor(t){this.stringSanitizer=t}sanitize(t){return null==t?t:"string"==typeof t?this.stringSanitizer.sanitize(t):Array.isArray(t)?t.map(t=>this.sanitize(t)):"object"==typeof t?this.sanitizeObject(t):t}sanitizeObject(t){const e={};for(const[n,r]of Object.entries(t))e[this.stringSanitizer.sanitize(n)]=this.sanitize(r);return e}}class ai{constructor(t){this.excludeSelectors=t}shouldExclude(t){return!(!t||!this.excludeSelectors.length)&&this.excludeSelectors.some(e=>{try{return t.matches(e)}catch{return!1}})}}class li{constructor(t){if(this.enabled=t.enabled??!0,!this.enabled)return this.stringSanitizer=new si(new Map),this.valueSanitizer=new oi(this.stringSanitizer),void(this.elementMatcher=new ai([]));const e=t.patterns??"all",n=t.customPatterns??[],r=t.excludeSelectors??[],i=new ii(e,n);this.stringSanitizer=new si(i.getPatterns()),this.valueSanitizer=new oi(this.stringSanitizer),this.elementMatcher=new ai(r)}guardDisabled(t){return this.enabled?void 0:t}sanitize(t){const e=this.guardDisabled(t);return void 0!==e?e:this.valueSanitizer.sanitize(t)}sanitizeConsoleArgs(t){const e=this.guardDisabled(t);return void 0!==e?e:t.map(t=>this.sanitize(t))}sanitizeNetworkData(t){const e=this.guardDisabled(t);return void 0!==e?e:this.sanitize(t)}sanitizeError(t){const e=this.guardDisabled(t);return void 0!==e?e:this.sanitize(t)}shouldExclude(t){return!!this.enabled&&this.elementMatcher.shouldExclude(t)}sanitizeTextNode(t,e){const n=this.guardDisabled(t);return void 0!==n?n:this.elementMatcher.shouldExclude(e)?t:this.stringSanitizer.sanitize(t)}detectPII(t){const e=new Map;if(!this.enabled||!t)return e;for(const[n,r]of this.stringSanitizer.patterns){const i=t.match(new RegExp(r,"g"));i&&i.length>0&&e.set(n,i.length)}return e}}function ci(t){return new li(t)}const di=P();class hi{constructor(t){this.redactionCanvas=null,this.originalScreenshot="",this.styleElement=null,this.piiDetections=[],this.options=t,this.container=document.createElement("div"),this.shadow=this.container.attachShadow({mode:"open"}),this.styleManager=new Gr,this.templateManager=new Vr,this.domCache=new Hr,this.validator=new Kr,this.piiDisplay=new jr,this.screenshotProcessor=new qr,this.handleEscapeKey=this.onEscapeKey.bind(this)}show(t){t&&(this.originalScreenshot=t),this.shadow.innerHTML=`\n      <style>\n        ${this.styleManager.generateStyles()}\n      </style>\n      ${this.templateManager.generateModalHTML(this.originalScreenshot)}\n    `,this.domCache.initialize(this.shadow);const e=this.domCache.get();e.titleError.style.display="none",e.descriptionError.style.display="none",this.setupRedactionCanvas(),this.attachEventListeners(),document.body.appendChild(this.container),e.titleInput.focus()}close(){document.removeEventListener("keydown",this.handleEscapeKey),this.redactionCanvas&&(this.redactionCanvas.destroy(),this.redactionCanvas=null),this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.domCache.clear(),this.options.onClose&&this.options.onClose()}destroy(){this.close()}setupRedactionCanvas(){const t=this.domCache.get();if(t.redactionCanvas&&t.screenshotImg)try{this.redactionCanvas=new Yr(t.redactionCanvas),this.redactionCanvas.initializeCanvas(t.screenshotImg)}catch(t){P().warn("Canvas redaction not available:",t),this.redactionCanvas=null}}attachEventListeners(){const t=this.domCache.get();t.closeButton.addEventListener("click",()=>this.close()),document.addEventListener("keydown",this.handleEscapeKey),t.form.addEventListener("submit",t=>this.handleSubmit(t)),t.submitButton.addEventListener("click",()=>{const e=new Event("submit",{bubbles:!0,cancelable:!0});t.form.dispatchEvent(e)}),t.cancelButton.addEventListener("click",()=>this.close()),t.titleInput.addEventListener("input",()=>this.validateField("title")),t.descriptionTextarea.addEventListener("input",()=>{this.validateField("description"),this.checkForPII()}),t.redactButton&&this.redactionCanvas&&t.redactButton.addEventListener("click",()=>this.toggleRedactionMode()),t.clearButton&&this.redactionCanvas&&t.clearButton.addEventListener("click",()=>this.clearRedactions()),t.piiConfirmCheckbox.addEventListener("change",()=>this.updateSubmitButton())}validateField(t){const e=this.domCache.get(),n="title"===t?e.titleInput.value:e.descriptionTextarea.value,r=this.validator.validateField(t,n),i="title"===t?e.titleError:e.descriptionError;r?(i.textContent=r,i.style.display="block"):(i.textContent="",i.style.display="none")}checkForPII(){const t=this.domCache.get(),e=`${t.titleInput.value} ${t.descriptionTextarea.value}`,n=ci({enabled:!0}).detectPII(e);this.piiDetections=Array.from(n.entries()).map(([t,e])=>({type:t,count:e})),this.piiDetections.length>0?(t.piiSection.style.display="block",this.piiDisplay.render(this.piiDetections,t.piiContent)):(t.piiSection.style.display="none",t.piiConfirmCheckbox.checked=!1),this.updateSubmitButton()}updateSubmitButton(){const t=this.domCache.get(),e=this.piiDetections.length>0,n=t.piiConfirmCheckbox.checked;t.submitButton.disabled=e&&!n}toggleRedactionMode(){const t=this.domCache.get();this.redactionCanvas&&t.redactButton&&(this.redactionCanvas.toggleRedactionMode()?(t.redactButton.classList.add("active"),t.redactButton.textContent=" Redacting..."):(t.redactButton.classList.remove("active"),t.redactButton.textContent=" Redact Area"))}clearRedactions(){this.redactionCanvas&&this.redactionCanvas.clearRedactions()}async handleSubmit(t){t.preventDefault();const e=this.domCache.get(),n={title:e.titleInput.value,description:e.descriptionTextarea.value,piiDetected:this.piiDetections.length>0,piiConfirmed:e.piiConfirmCheckbox.checked},r=this.validator.validate(n);if(!r.isValid)return r.errors.title?(e.titleError.textContent=r.errors.title,e.titleError.style.display="block"):(e.titleError.textContent="",e.titleError.style.display="none"),r.errors.description?(e.descriptionError.textContent=r.errors.description,e.descriptionError.style.display="block"):(e.descriptionError.textContent="",e.descriptionError.style.display="none"),void(r.errors.piiConfirmation&&alert(r.errors.piiConfirmation));e.titleError.style.display="none",e.descriptionError.style.display="none";let i=this.originalScreenshot;if(this.redactionCanvas&&this.redactionCanvas.getRedactions().length>0)try{i=await this.screenshotProcessor.mergeRedactions(this.originalScreenshot,this.redactionCanvas.getCanvas())}catch(t){di.error("Failed to merge redactions:",t),i=this.originalScreenshot}this.originalScreenshot=i;const s={title:n.title.trim(),description:n.description.trim()};try{await this.options.onSubmit(s),this.close()}catch(t){P().error("Error submitting bug report:",t),alert("Failed to submit bug report. Please try again.")}}getScreenshot(){return this.originalScreenshot}onEscapeKey(t){"Escape"===t.key&&this.close()}}var ui;function pi(t){var e=null==t?void 0:t.host;return Boolean((null==e?void 0:e.shadowRoot)===t)}function gi(t){return"[object ShadowRoot]"===Object.prototype.toString.call(t)}function mi(t){try{var e=t.rules||t.cssRules;return e?((n=Array.from(e).map(fi).join("")).includes(" background-clip: text;")&&!n.includes(" -webkit-background-clip: text;")&&(n=n.replace(" background-clip: text;"," -webkit-background-clip: text; background-clip: text;")),n):null}catch(t){return null}var n}function fi(t){var e=t.cssText;if(function(t){return"styleSheet"in t}(t))try{e=mi(t.styleSheet)||e}catch(t){}return e}!function(t){t[t.Document=0]="Document",t[t.DocumentType=1]="DocumentType",t[t.Element=2]="Element",t[t.Text=3]="Text",t[t.CDATA=4]="CDATA",t[t.Comment=5]="Comment"}(ui||(ui={}));var yi=function(){function t(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}return t.prototype.getId=function(t){var e;if(!t)return-1;var n=null===(e=this.getMeta(t))||void 0===e?void 0:e.id;return null!=n?n:-1},t.prototype.getNode=function(t){return this.idNodeMap.get(t)||null},t.prototype.getIds=function(){return Array.from(this.idNodeMap.keys())},t.prototype.getMeta=function(t){return this.nodeMetaMap.get(t)||null},t.prototype.removeNodeFromMap=function(t){var e=this,n=this.getId(t);this.idNodeMap.delete(n),t.childNodes&&t.childNodes.forEach(function(t){return e.removeNodeFromMap(t)})},t.prototype.has=function(t){return this.idNodeMap.has(t)},t.prototype.hasNode=function(t){return this.nodeMetaMap.has(t)},t.prototype.add=function(t,e){var n=e.id;this.idNodeMap.set(n,t),this.nodeMetaMap.set(t,e)},t.prototype.replace=function(t,e){var n=this.getNode(t);if(n){var r=this.nodeMetaMap.get(n);r&&this.nodeMetaMap.set(e,r)}this.idNodeMap.set(t,e)},t.prototype.reset=function(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap},t}();function bi(t){var e=t.maskInputOptions,n=t.tagName,r=t.type,i=t.value,s=t.maskInputFn,o=i||"";return(e[n.toLowerCase()]||e[r])&&(o=s?s(o):"*".repeat(o.length)),o}var wi,vi,Ci="__rrweb_original__",Ii=1,_i=new RegExp("[^a-z0-9-_:]");function Si(){return Ii++}var ki=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,xi=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/|#).*/,Ai=/^(data:)([^,]*),(.*)/i;function Ei(t,e){return(t||"").replace(ki,function(t,n,r,i,s,o){var a,l=r||s||o,c=n||i||"";if(!l)return t;if(!xi.test(l))return"url(".concat(c).concat(l).concat(c,")");if(Ai.test(l))return"url(".concat(c).concat(l).concat(c,")");if("/"===l[0])return"url(".concat(c).concat((a=e,(a.indexOf("//")>-1?a.split("/").slice(0,3).join("/"):a.split("/")[0]).split("?")[0]+l)).concat(c,")");var d=e.split("/"),h=l.split("/");d.pop();for(var u=0,p=h;u<p.length;u++){var g=p[u];"."!==g&&(".."===g?d.pop():d.push(g))}return"url(".concat(c).concat(d.join("/")).concat(c,")")})}var Ri=/^[^ \t\n\r\u000c]+/,Mi=/^[, \t\n\r\u000c]+/;function Ti(t,e){if(!e||""===e.trim())return e;var n=t.createElement("a");return n.href=e,n.href}function zi(){var t=document.createElement("a");return t.href="",t.href}function Li(t,e,n,r){return"src"===n||"href"===n&&r&&("use"!==e||"#"!==r[0])||"xlink:href"===n&&r&&"#"!==r[0]?Ti(t,r):"background"!==n||!r||"table"!==e&&"td"!==e&&"th"!==e?"srcset"===n&&r?function(t,e){if(""===e.trim())return e;var n=0;function r(t){var r,i=t.exec(e.substring(n));return i?(r=i[0],n+=r.length,r):""}for(var i=[];r(Mi),!(n>=e.length);){var s=r(Ri);if(","===s.slice(-1))s=Ti(t,s.substring(0,s.length-1)),i.push(s);else{var o="";s=Ti(t,s);for(var a=!1;;){var l=e.charAt(n);if(""===l){i.push((s+o).trim());break}if(a)")"===l&&(a=!1);else{if(","===l){n+=1,i.push((s+o).trim());break}"("===l&&(a=!0)}o+=l,n+=1}}}return i.join(", ")}(t,r):"style"===n&&r?Ei(r,zi()):"object"===e&&"data"===n&&r?Ti(t,r):r:Ti(t,r)}function Di(t,e,n){if(!t)return!1;if(t.nodeType!==t.ELEMENT_NODE)return!!n&&Di(t.parentNode,e,n);for(var r=t.classList.length;r--;){var i=t.classList[r];if(e.test(i))return!0}return!!n&&Di(t.parentNode,e,n)}function Ni(t,e,n){var r=t.nodeType===t.ELEMENT_NODE?t:t.parentElement;if(null===r)return!1;if("string"==typeof e){if(r.classList.contains(e))return!0;if(r.closest(".".concat(e)))return!0}else if(Di(r,e,!0))return!0;if(n){if(r.matches(n))return!0;if(r.closest(n))return!0}return!1}function Oi(t){return void 0===t?"":t.toLowerCase()}function Fi(t,e){var n,r=e.doc,i=e.mirror,s=e.blockClass,o=e.blockSelector,a=e.maskTextClass,l=e.maskTextSelector,c=e.skipChild,d=void 0!==c&&c,h=e.inlineStylesheet,u=void 0===h||h,p=e.maskInputOptions,g=void 0===p?{}:p,m=e.maskTextFn,f=e.maskInputFn,y=e.slimDOMOptions,b=e.dataURLOptions,w=void 0===b?{}:b,v=e.inlineImages,C=void 0!==v&&v,I=e.recordCanvas,_=void 0!==I&&I,S=e.onSerialize,k=e.onIframeLoad,x=e.iframeLoadTimeout,A=void 0===x?5e3:x,E=e.onStylesheetLoad,R=e.stylesheetLoadTimeout,M=void 0===R?5e3:R,T=e.keepIframeSrcFn,z=void 0===T?function(){return!1}:T,L=e.newlyAddedElement,D=void 0!==L&&L,N=e.preserveWhiteSpace,O=void 0===N||N,F=function(t,e){var n=e.doc,r=e.mirror,i=e.blockClass,s=e.blockSelector,o=e.maskTextClass,a=e.maskTextSelector,l=e.inlineStylesheet,c=e.maskInputOptions,d=void 0===c?{}:c,h=e.maskTextFn,u=e.maskInputFn,p=e.dataURLOptions,g=void 0===p?{}:p,m=e.inlineImages,f=e.recordCanvas,y=e.keepIframeSrcFn,b=e.newlyAddedElement,w=void 0!==b&&b,v=function(t,e){if(e.hasNode(t)){var n=e.getId(t);return 1===n?void 0:n}}(n,r);switch(t.nodeType){case t.DOCUMENT_NODE:return"CSS1Compat"!==t.compatMode?{type:ui.Document,childNodes:[],compatMode:t.compatMode}:{type:ui.Document,childNodes:[]};case t.DOCUMENT_TYPE_NODE:return{type:ui.DocumentType,name:t.name,publicId:t.publicId,systemId:t.systemId,rootId:v};case t.ELEMENT_NODE:return function(t,e){for(var n=e.doc,r=e.inlineStylesheet,i=e.maskInputOptions,s=void 0===i?{}:i,o=e.maskInputFn,a=e.dataURLOptions,l=void 0===a?{}:a,c=e.inlineImages,d=e.recordCanvas,h=e.keepIframeSrcFn,u=e.newlyAddedElement,p=void 0!==u&&u,g=e.rootId,m=function(t,e,n){if("string"==typeof e){if(t.classList.contains(e))return!0}else for(var r=t.classList.length;r--;){var i=t.classList[r];if(e.test(i))return!0}return!!n&&t.matches(n)}(t,e.blockClass,e.blockSelector),f=function(t){if(t instanceof HTMLFormElement)return"form";var e=t.tagName.toLowerCase().trim();return _i.test(e)?"div":e}(t),y={},b=t.attributes.length,w=0;w<b;w++){var v=t.attributes[w];y[v.name]=Li(n,f,v.name,v.value)}if("link"===f&&r){var C=Array.from(n.styleSheets).find(function(e){return e.href===t.href}),I=null;C&&(I=mi(C)),I&&(delete y.rel,delete y.href,y._cssText=Ei(I,C.href))}if("style"===f&&t.sheet&&!(t.innerText||t.textContent||"").trim().length&&(I=mi(t.sheet))&&(y._cssText=Ei(I,zi())),"input"===f||"textarea"===f||"select"===f){var _=t.value,S=t.checked;"radio"!==y.type&&"checkbox"!==y.type&&"submit"!==y.type&&"button"!==y.type&&_?y.value=bi({type:y.type,tagName:f,value:_,maskInputOptions:s,maskInputFn:o}):S&&(y.checked=S)}if("option"===f&&(t.selected&&!s.select?y.selected=!0:delete y.selected),"canvas"===f&&d)if("2d"===t.__context)(function(t){var e=t.getContext("2d");if(!e)return!0;for(var n=0;n<t.width;n+=50)for(var r=0;r<t.height;r+=50){var i=e.getImageData,s=Ci in i?i[Ci]:i;if(new Uint32Array(s.call(e,n,r,Math.min(50,t.width-n),Math.min(50,t.height-r)).data.buffer).some(function(t){return 0!==t}))return!1}return!0})(t)||(y.rr_dataURL=t.toDataURL(l.type,l.quality));else if(!("__context"in t)){var k=t.toDataURL(l.type,l.quality),x=document.createElement("canvas");x.width=t.width,x.height=t.height,k!==x.toDataURL(l.type,l.quality)&&(y.rr_dataURL=k)}if("img"===f&&c){wi||(wi=n.createElement("canvas"),vi=wi.getContext("2d"));var A=t,E=A.crossOrigin;A.crossOrigin="anonymous";var R=function(){try{wi.width=A.naturalWidth,wi.height=A.naturalHeight,vi.drawImage(A,0,0),y.rr_dataURL=wi.toDataURL(l.type,l.quality)}catch(t){console.warn("Cannot inline img src=".concat(A.currentSrc,"! Error: ").concat(t))}E?y.crossOrigin=E:A.removeAttribute("crossorigin")};A.complete&&0!==A.naturalWidth?R():A.onload=R}if("audio"!==f&&"video"!==f||(y.rr_mediaState=t.paused?"paused":"played",y.rr_mediaCurrentTime=t.currentTime),p||(t.scrollLeft&&(y.rr_scrollLeft=t.scrollLeft),t.scrollTop&&(y.rr_scrollTop=t.scrollTop)),m){var M=t.getBoundingClientRect(),T=M.width,z=M.height;y={class:y.class,rr_width:"".concat(T,"px"),rr_height:"".concat(z,"px")}}return"iframe"!==f||h(y.src)||(t.contentDocument||(y.rr_src=y.src),delete y.src),{type:ui.Element,tagName:f,attributes:y,childNodes:[],isSVG:(L=t,Boolean("svg"===L.tagName||L.ownerSVGElement)||void 0),needBlock:m,rootId:g};var L}(t,{doc:n,blockClass:i,blockSelector:s,inlineStylesheet:l,maskInputOptions:d,maskInputFn:u,dataURLOptions:g,inlineImages:m,recordCanvas:f,keepIframeSrcFn:y,newlyAddedElement:w,rootId:v});case t.TEXT_NODE:return function(t,e){var n,r,i=e.maskTextClass,s=e.maskTextSelector,o=e.maskTextFn,a=e.rootId,l=t.parentNode&&t.parentNode.tagName,c=t.textContent,d="STYLE"===l||void 0,h="SCRIPT"===l||void 0;if(d&&c){try{t.nextSibling||t.previousSibling||(null===(n=t.parentNode.sheet)||void 0===n?void 0:n.cssRules)&&(c=(r=t.parentNode.sheet).cssRules?Array.from(r.cssRules).map(function(t){return t.cssText||""}).join(""):"")}catch(e){console.warn("Cannot get CSS styles from text's parentNode. Error: ".concat(e),t)}c=Ei(c,zi())}return h&&(c="SCRIPT_PLACEHOLDER"),!d&&!h&&c&&Ni(t,i,s)&&(c=o?o(c):c.replace(/[\S]/g,"*")),{type:ui.Text,textContent:c||"",isStyle:d,rootId:a}}(t,{maskTextClass:o,maskTextSelector:a,maskTextFn:h,rootId:v});case t.CDATA_SECTION_NODE:return{type:ui.CDATA,textContent:"",rootId:v};case t.COMMENT_NODE:return{type:ui.Comment,textContent:t.textContent||"",rootId:v};default:return!1}}(t,{doc:r,mirror:i,blockClass:s,blockSelector:o,maskTextClass:a,maskTextSelector:l,inlineStylesheet:u,maskInputOptions:g,maskTextFn:m,maskInputFn:f,dataURLOptions:w,inlineImages:C,recordCanvas:_,keepIframeSrcFn:z,newlyAddedElement:D});if(!F)return console.warn(t,"not serialized"),null;n=i.hasNode(t)?i.getId(t):!function(t,e){if(e.comment&&t.type===ui.Comment)return!0;if(t.type===ui.Element){if(e.script&&("script"===t.tagName||"link"===t.tagName&&"preload"===t.attributes.rel&&"script"===t.attributes.as||"link"===t.tagName&&"prefetch"===t.attributes.rel&&"string"==typeof t.attributes.href&&t.attributes.href.endsWith(".js")))return!0;if(e.headFavicon&&("link"===t.tagName&&"shortcut icon"===t.attributes.rel||"meta"===t.tagName&&(Oi(t.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===Oi(t.attributes.name)||"icon"===Oi(t.attributes.rel)||"apple-touch-icon"===Oi(t.attributes.rel)||"shortcut icon"===Oi(t.attributes.rel))))return!0;if("meta"===t.tagName){if(e.headMetaDescKeywords&&Oi(t.attributes.name).match(/^description|keywords$/))return!0;if(e.headMetaSocial&&(Oi(t.attributes.property).match(/^(og|twitter|fb):/)||Oi(t.attributes.name).match(/^(og|twitter):/)||"pinterest"===Oi(t.attributes.name)))return!0;if(e.headMetaRobots&&("robots"===Oi(t.attributes.name)||"googlebot"===Oi(t.attributes.name)||"bingbot"===Oi(t.attributes.name)))return!0;if(e.headMetaHttpEquiv&&void 0!==t.attributes["http-equiv"])return!0;if(e.headMetaAuthorship&&("author"===Oi(t.attributes.name)||"generator"===Oi(t.attributes.name)||"framework"===Oi(t.attributes.name)||"publisher"===Oi(t.attributes.name)||"progid"===Oi(t.attributes.name)||Oi(t.attributes.property).match(/^article:/)||Oi(t.attributes.property).match(/^product:/)))return!0;if(e.headMetaVerification&&("google-site-verification"===Oi(t.attributes.name)||"yandex-verification"===Oi(t.attributes.name)||"csrf-token"===Oi(t.attributes.name)||"p:domain_verify"===Oi(t.attributes.name)||"verify-v1"===Oi(t.attributes.name)||"verification"===Oi(t.attributes.name)||"shopify-checkout-api-token"===Oi(t.attributes.name)))return!0}}return!1}(F,y)&&(O||F.type!==ui.Text||F.isStyle||F.textContent.replace(/^\s+|\s+$/gm,"").length)?Si():-2;var B=Object.assign(F,{id:n});if(i.add(t,B),-2===n)return null;S&&S(t);var U=!d;if(B.type===ui.Element){U=U&&!B.needBlock,delete B.needBlock;var Z=t.shadowRoot;Z&&gi(Z)&&(B.isShadowHost=!0)}if((B.type===ui.Document||B.type===ui.Element)&&U){y.headWhitespace&&B.type===ui.Element&&"head"===B.tagName&&(O=!1);for(var P={doc:r,mirror:i,blockClass:s,blockSelector:o,maskTextClass:a,maskTextSelector:l,skipChild:d,inlineStylesheet:u,maskInputOptions:g,maskTextFn:m,maskInputFn:f,slimDOMOptions:y,dataURLOptions:w,inlineImages:C,recordCanvas:_,preserveWhiteSpace:O,onSerialize:S,onIframeLoad:k,iframeLoadTimeout:A,onStylesheetLoad:E,stylesheetLoadTimeout:M,keepIframeSrcFn:z},W=0,G=Array.from(t.childNodes);W<G.length;W++)(K=Fi(G[W],P))&&B.childNodes.push(K);if(function(t){return t.nodeType===t.ELEMENT_NODE}(t)&&t.shadowRoot)for(var V=0,H=Array.from(t.shadowRoot.childNodes);V<H.length;V++){var K;(K=Fi(H[V],P))&&(gi(t.shadowRoot)&&(K.isShadow=!0),B.childNodes.push(K))}}return t.parentNode&&pi(t.parentNode)&&gi(t.parentNode)&&(B.isShadow=!0),B.type===ui.Element&&"iframe"===B.tagName&&function(t,e,n){var r=t.contentWindow;if(r){var i,s=!1;try{i=r.document.readyState}catch(t){return}if("complete"===i){var o="about:blank";if(r.location.href!==o||t.src===o||""===t.src)return setTimeout(e,0),t.addEventListener("load",e);t.addEventListener("load",e)}else{var a=setTimeout(function(){s||(e(),s=!0)},n);t.addEventListener("load",function(){clearTimeout(a),s=!0,e()})}}}(t,function(){var e=t.contentDocument;if(e&&k){var n=Fi(e,{doc:e,mirror:i,blockClass:s,blockSelector:o,maskTextClass:a,maskTextSelector:l,skipChild:!1,inlineStylesheet:u,maskInputOptions:g,maskTextFn:m,maskInputFn:f,slimDOMOptions:y,dataURLOptions:w,inlineImages:C,recordCanvas:_,preserveWhiteSpace:O,onSerialize:S,onIframeLoad:k,iframeLoadTimeout:A,onStylesheetLoad:E,stylesheetLoadTimeout:M,keepIframeSrcFn:z});n&&k(t,n)}},A),B.type===ui.Element&&"link"===B.tagName&&"stylesheet"===B.attributes.rel&&function(t,e,n){var r,i=!1;try{r=t.sheet}catch(t){return}if(!r){var s=setTimeout(function(){i||(e(),i=!0)},n);t.addEventListener("load",function(){clearTimeout(s),i=!0,e()})}}(t,function(){if(E){var e=Fi(t,{doc:r,mirror:i,blockClass:s,blockSelector:o,maskTextClass:a,maskTextSelector:l,skipChild:!1,inlineStylesheet:u,maskInputOptions:g,maskTextFn:m,maskInputFn:f,slimDOMOptions:y,dataURLOptions:w,inlineImages:C,recordCanvas:_,preserveWhiteSpace:O,onSerialize:S,onIframeLoad:k,iframeLoadTimeout:A,onStylesheetLoad:E,stylesheetLoadTimeout:M,keepIframeSrcFn:z});e&&E(t,e)}},M),B}function Bi(t,e,n=document){const r={capture:!0,passive:!0};return n.addEventListener(t,e,r),()=>n.removeEventListener(t,e,r)}new RegExp(/([^\\]):hover/.source,"g");const Ui="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.";let Zi={map:{},getId:()=>(console.error(Ui),-1),getNode:()=>(console.error(Ui),null),removeNodeFromMap(){console.error(Ui)},has:()=>(console.error(Ui),!1),reset(){console.error(Ui)}};function Pi(t,e,n={}){let r=null,i=0;return function(...s){const o=Date.now();i||!1!==n.leading||(i=o);const a=e-(o-i),l=this;a<=0||a>e?(r&&(clearTimeout(r),r=null),i=o,t.apply(l,s)):r||!1===n.trailing||(r=setTimeout(()=>{i=!1===n.leading?0:Date.now(),r=null,t.apply(l,s)},a))}}function Wi(t,e,n,r,i=window){const s=i.Object.getOwnPropertyDescriptor(t,e);return i.Object.defineProperty(t,e,r?n:{set(t){setTimeout(()=>{n.set.call(this,t)},0),s&&s.set&&s.set.call(this,t)}}),()=>Wi(t,e,s||{},!0)}function Gi(t,e,n){try{if(!(e in t))return()=>{};const r=t[e],i=n(r);return"function"==typeof i&&(i.prototype=i.prototype||{},Object.defineProperties(i,{__rrweb_original__:{enumerable:!1,value:r}})),t[e]=i,()=>{t[e]=r}}catch(t){return()=>{}}}function Vi(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function Hi(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function Ki(t,e,n,r){if(!t)return!1;const i=t.nodeType===t.ELEMENT_NODE?t:t.parentElement;if(!i)return!1;if("string"==typeof e){if(i.classList.contains(e))return!0;if(r&&null!==i.closest("."+e))return!0}else if(Di(i,e,r))return!0;if(n){if(t.matches(n))return!0;if(r&&null!==i.closest(n))return!0}return!1}function ji(t,e){return-2===e.getId(t)}function Yi(t,e){if(pi(t))return!1;const n=e.getId(t);return!e.has(n)||(!t.parentNode||t.parentNode.nodeType!==t.DOCUMENT_NODE)&&(!t.parentNode||Yi(t.parentNode,e))}function qi(t){return Boolean(t.changedTouches)}function $i(t,e){return Boolean("IFRAME"===t.nodeName&&e.getMeta(t))}function Xi(t,e){return Boolean("LINK"===t.nodeName&&t.nodeType===t.ELEMENT_NODE&&t.getAttribute&&"stylesheet"===t.getAttribute("rel")&&e.getMeta(t))}function Ji(t){return Boolean(null==t?void 0:t.shadowRoot)}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(Zi=new Proxy(Zi,{get:(t,e,n)=>("map"===e&&console.error(Ui),Reflect.get(t,e,n))}));class Qi{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(t){var e;return null!==(e=this.styleIDMap.get(t))&&void 0!==e?e:-1}has(t){return this.styleIDMap.has(t)}add(t,e){if(this.has(t))return this.getId(t);let n;return n=void 0===e?this.id++:e,this.styleIDMap.set(t,n),this.idStyleMap.set(n,t),n}getStyle(t){return this.idStyleMap.get(t)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}}var ts=(t=>(t[t.DomContentLoaded=0]="DomContentLoaded",t[t.Load=1]="Load",t[t.FullSnapshot=2]="FullSnapshot",t[t.IncrementalSnapshot=3]="IncrementalSnapshot",t[t.Meta=4]="Meta",t[t.Custom=5]="Custom",t[t.Plugin=6]="Plugin",t))(ts||{}),es=(t=>(t[t.Mutation=0]="Mutation",t[t.MouseMove=1]="MouseMove",t[t.MouseInteraction=2]="MouseInteraction",t[t.Scroll=3]="Scroll",t[t.ViewportResize=4]="ViewportResize",t[t.Input=5]="Input",t[t.TouchMove=6]="TouchMove",t[t.MediaInteraction=7]="MediaInteraction",t[t.StyleSheetRule=8]="StyleSheetRule",t[t.CanvasMutation=9]="CanvasMutation",t[t.Font=10]="Font",t[t.Log=11]="Log",t[t.Drag=12]="Drag",t[t.StyleDeclaration=13]="StyleDeclaration",t[t.Selection=14]="Selection",t[t.AdoptedStyleSheet=15]="AdoptedStyleSheet",t))(es||{}),ns=(t=>(t[t.MouseUp=0]="MouseUp",t[t.MouseDown=1]="MouseDown",t[t.Click=2]="Click",t[t.ContextMenu=3]="ContextMenu",t[t.DblClick=4]="DblClick",t[t.Focus=5]="Focus",t[t.Blur=6]="Blur",t[t.TouchStart=7]="TouchStart",t[t.TouchMove_Departed=8]="TouchMove_Departed",t[t.TouchEnd=9]="TouchEnd",t[t.TouchCancel=10]="TouchCancel",t))(ns||{}),rs=(t=>(t[t["2D"]=0]="2D",t[t.WebGL=1]="WebGL",t[t.WebGL2=2]="WebGL2",t))(rs||{});function is(t){return"__ln"in t}class ss{constructor(){this.length=0,this.head=null}get(t){if(t>=this.length)throw new Error("Position outside of list range");let e=this.head;for(let n=0;n<t;n++)e=(null==e?void 0:e.next)||null;return e}addNode(t){const e={value:t,previous:null,next:null};if(t.__ln=e,t.previousSibling&&is(t.previousSibling)){const n=t.previousSibling.__ln.next;e.next=n,e.previous=t.previousSibling.__ln,t.previousSibling.__ln.next=e,n&&(n.previous=e)}else if(t.nextSibling&&is(t.nextSibling)&&t.nextSibling.__ln.previous){const n=t.nextSibling.__ln.previous;e.previous=n,e.next=t.nextSibling.__ln,t.nextSibling.__ln.previous=e,n&&(n.next=e)}else this.head&&(this.head.previous=e),e.next=this.head,this.head=e;this.length++}removeNode(t){const e=t.__ln;this.head&&(e.previous?(e.previous.next=e.next,e.next&&(e.next.previous=e.previous)):(this.head=e.next,this.head&&(this.head.previous=null)),t.__ln&&delete t.__ln,this.length--)}}const os=(t,e)=>`${t}@${e}`;class as{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=t=>{t.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;const t=[],e=new ss,n=t=>{let e=t,n=-2;for(;-2===n;)e=e&&e.nextSibling,n=e&&this.mirror.getId(e);return n},r=r=>{var i,s,o,a;let l=null;(null===(s=null===(i=r.getRootNode)||void 0===i?void 0:i.call(r))||void 0===s?void 0:s.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&r.getRootNode().host&&(l=r.getRootNode().host);let c=l;for(;(null===(a=null===(o=null==c?void 0:c.getRootNode)||void 0===o?void 0:o.call(c))||void 0===a?void 0:a.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&c.getRootNode().host;)c=c.getRootNode().host;const d=!(this.doc.contains(r)||c&&this.doc.contains(c));if(!r.parentNode||d)return;const h=pi(r.parentNode)?this.mirror.getId(l):this.mirror.getId(r.parentNode),u=n(r);if(-1===h||-1===u)return e.addNode(r);const p=Fi(r,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskTextClass:this.maskTextClass,maskTextSelector:this.maskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:t=>{$i(t,this.mirror)&&this.iframeManager.addIframe(t),Xi(t,this.mirror)&&this.stylesheetManager.trackLinkElement(t),Ji(r)&&this.shadowDomManager.addShadowRoot(r.shadowRoot,this.doc)},onIframeLoad:(t,e)=>{this.iframeManager.attachIframe(t,e),this.shadowDomManager.observeAttachShadow(t)},onStylesheetLoad:(t,e)=>{this.stylesheetManager.attachLinkElement(t,e)}});p&&t.push({parentId:h,nextId:u,node:p})};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const t of Array.from(this.movedSet.values()))cs(this.removes,t,this.mirror)&&!this.movedSet.has(t.parentNode)||r(t);for(const t of Array.from(this.addedSet.values()))hs(this.droppedSet,t)||cs(this.removes,t,this.mirror)?hs(this.movedSet,t)?r(t):this.droppedSet.add(t):r(t);let i=null;for(;e.length;){let t=null;if(i){const e=this.mirror.getId(i.value.parentNode),r=n(i.value);-1!==e&&-1!==r&&(t=i)}if(!t)for(let r=e.length-1;r>=0;r--){const i=e.get(r);if(i){const e=this.mirror.getId(i.value.parentNode);if(-1===n(i.value))continue;if(-1!==e){t=i;break}{const e=i.value;if(e.parentNode&&e.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const n=e.parentNode.host;if(-1!==this.mirror.getId(n)){t=i;break}}}}}if(!t){for(;e.head;)e.removeNode(e.head.value);break}i=t.previous,e.removeNode(t.value),r(t.value)}const s={texts:this.texts.map(t=>({id:this.mirror.getId(t.node),value:t.value})).filter(t=>this.mirror.has(t.id)),attributes:this.attributes.map(t=>({id:this.mirror.getId(t.node),attributes:t.attributes})).filter(t=>this.mirror.has(t.id)),removes:this.removes,adds:t};(s.texts.length||s.attributes.length||s.removes.length||s.adds.length)&&(this.texts=[],this.attributes=[],this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(s))},this.processMutation=t=>{if(!ji(t.target,this.mirror))switch(t.type){case"characterData":{const e=t.target.textContent;Ki(t.target,this.blockClass,this.blockSelector,!1)||e===t.oldValue||this.texts.push({value:Ni(t.target,this.maskTextClass,this.maskTextSelector)&&e?this.maskTextFn?this.maskTextFn(e):e.replace(/[\S]/g,"*"):e,node:t.target});break}case"attributes":{const e=t.target;let n=t.target.getAttribute(t.attributeName);if("value"===t.attributeName&&(n=bi({maskInputOptions:this.maskInputOptions,tagName:t.target.tagName,type:t.target.getAttribute("type"),value:n,maskInputFn:this.maskInputFn})),Ki(t.target,this.blockClass,this.blockSelector,!1)||n===t.oldValue)return;let r=this.attributes.find(e=>e.node===t.target);if("IFRAME"===e.tagName&&"src"===t.attributeName&&!this.keepIframeSrcFn(n)){if(e.contentDocument)return;t.attributeName="rr_src"}if(r||(r={node:t.target,attributes:{}},this.attributes.push(r)),"style"===t.attributeName){const n=this.doc.createElement("span");t.oldValue&&n.setAttribute("style",t.oldValue),void 0!==r.attributes.style&&null!==r.attributes.style||(r.attributes.style={});const i=r.attributes.style;for(const t of Array.from(e.style)){const r=e.style.getPropertyValue(t),s=e.style.getPropertyPriority(t);r===n.style.getPropertyValue(t)&&s===n.style.getPropertyPriority(t)||(i[t]=""===s?r:[r,s])}for(const t of Array.from(n.style))""===e.style.getPropertyValue(t)&&(i[t]=!1)}else r.attributes[t.attributeName]=Li(this.doc,e.tagName,t.attributeName,n);break}case"childList":if(Ki(t.target,this.blockClass,this.blockSelector,!0))return;t.addedNodes.forEach(e=>this.genAdds(e,t.target)),t.removedNodes.forEach(e=>{const n=this.mirror.getId(e),r=pi(t.target)?this.mirror.getId(t.target.host):this.mirror.getId(t.target);Ki(t.target,this.blockClass,this.blockSelector,!1)||ji(e,this.mirror)||!function(t,e){return-1!==e.getId(t)}(e,this.mirror)||(this.addedSet.has(e)?(ls(this.addedSet,e),this.droppedSet.add(e)):this.addedSet.has(t.target)&&-1===n||Yi(t.target,this.mirror)||(this.movedSet.has(e)&&this.movedMap[os(n,r)]?ls(this.movedSet,e):this.removes.push({parentId:r,id:n,isShadow:!(!pi(t.target)||!gi(t.target))||void 0})),this.mapRemoves.push(e))})}},this.genAdds=(t,e)=>{if(this.mirror.hasNode(t)){if(ji(t,this.mirror))return;this.movedSet.add(t);let n=null;e&&this.mirror.hasNode(e)&&(n=this.mirror.getId(e)),n&&-1!==n&&(this.movedMap[os(this.mirror.getId(t),n)]=!0)}else this.addedSet.add(t),this.droppedSet.delete(t);Ki(t,this.blockClass,this.blockSelector,!1)||t.childNodes.forEach(t=>this.genAdds(t))}}init(t){["mutationCb","blockClass","blockSelector","maskTextClass","maskTextSelector","inlineStylesheet","maskInputOptions","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager"].forEach(e=>{this[e]=t[e]})}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}}function ls(t,e){t.delete(e),e.childNodes.forEach(e=>ls(t,e))}function cs(t,e,n){return 0!==t.length&&ds(t,e,n)}function ds(t,e,n){const{parentNode:r}=e;if(!r)return!1;const i=n.getId(r);return!!t.some(t=>t.id===i)||ds(t,r,n)}function hs(t,e){return 0!==t.size&&us(t,e)}function us(t,e){const{parentNode:n}=e;return!!n&&(!!t.has(n)||us(t,n))}const ps=[],gs="undefined"!=typeof CSSGroupingRule,ms="undefined"!=typeof CSSMediaRule,fs="undefined"!=typeof CSSSupportsRule,ys="undefined"!=typeof CSSConditionRule;function bs(t){try{if("composedPath"in t){const e=t.composedPath();if(e.length)return e[0]}else if("path"in t&&t.path.length)return t.path[0];return t.target}catch(e){return t.target}}function ws(t,e){var n,r;const i=new as;ps.push(i),i.init(t);let s=window.MutationObserver||window.__rrMutationObserver;const o=null===(r=null===(n=null===window||void 0===window?void 0:window.Zone)||void 0===n?void 0:n.__symbol__)||void 0===r?void 0:r.call(n,"MutationObserver");o&&window[o]&&(s=window[o]);const a=new s(i.processMutations.bind(i));return a.observe(e,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),a}function vs({scrollCb:t,doc:e,mirror:n,blockClass:r,blockSelector:i,sampling:s}){return Bi("scroll",Pi(s=>{const o=bs(s);if(!o||Ki(o,r,i,!0))return;const a=n.getId(o);if(o===e){const n=e.scrollingElement||e.documentElement;t({id:a,x:n.scrollLeft,y:n.scrollTop})}else t({id:a,x:o.scrollLeft,y:o.scrollTop})},s.scroll||100),e)}function Cs(t,e){const n=Object.assign({},t);return e||delete n.userTriggered,n}const Is=["INPUT","TEXTAREA","SELECT"],_s=new WeakMap;function Ss(t){return function(t,e){if(gs&&t.parentRule instanceof CSSGroupingRule||ms&&t.parentRule instanceof CSSMediaRule||fs&&t.parentRule instanceof CSSSupportsRule||ys&&t.parentRule instanceof CSSConditionRule){const n=Array.from(t.parentRule.cssRules).indexOf(t);e.unshift(n)}else if(t.parentStyleSheet){const n=Array.from(t.parentStyleSheet.cssRules).indexOf(t);e.unshift(n)}return e}(t,[])}function ks(t,e,n){let r,i;return t?(t.ownerNode?r=e.getId(t.ownerNode):i=n.getId(t),{styleId:i,id:r}):{}}function xs({mirror:t,stylesheetManager:e},n){var r,i,s;let o=null;o="#document"===n.nodeName?t.getId(n):t.getId(n.host);const a="#document"===n.nodeName?null===(r=n.defaultView)||void 0===r?void 0:r.Document:null===(s=null===(i=n.ownerDocument)||void 0===i?void 0:i.defaultView)||void 0===s?void 0:s.ShadowRoot,l=Object.getOwnPropertyDescriptor(null==a?void 0:a.prototype,"adoptedStyleSheets");return null!==o&&-1!==o&&a&&l?(Object.defineProperty(n,"adoptedStyleSheets",{configurable:l.configurable,enumerable:l.enumerable,get(){var t;return null===(t=l.get)||void 0===t?void 0:t.call(this)},set(t){var n;const r=null===(n=l.set)||void 0===n?void 0:n.call(this,t);if(null!==o&&-1!==o)try{e.adoptStyleSheets(t,o)}catch(t){}return r}}),()=>{Object.defineProperty(n,"adoptedStyleSheets",{configurable:l.configurable,enumerable:l.enumerable,get:l.get,set:l.set})}):()=>{}}function As(t,e={}){const n=t.doc.defaultView;if(!n)return()=>{};!function(t,e){const{mutationCb:n,mousemoveCb:r,mouseInteractionCb:i,scrollCb:s,viewportResizeCb:o,inputCb:a,mediaInteractionCb:l,styleSheetRuleCb:c,styleDeclarationCb:d,canvasMutationCb:h,fontCb:u,selectionCb:p}=t;t.mutationCb=(...t)=>{e.mutation&&e.mutation(...t),n(...t)},t.mousemoveCb=(...t)=>{e.mousemove&&e.mousemove(...t),r(...t)},t.mouseInteractionCb=(...t)=>{e.mouseInteraction&&e.mouseInteraction(...t),i(...t)},t.scrollCb=(...t)=>{e.scroll&&e.scroll(...t),s(...t)},t.viewportResizeCb=(...t)=>{e.viewportResize&&e.viewportResize(...t),o(...t)},t.inputCb=(...t)=>{e.input&&e.input(...t),a(...t)},t.mediaInteractionCb=(...t)=>{e.mediaInteaction&&e.mediaInteaction(...t),l(...t)},t.styleSheetRuleCb=(...t)=>{e.styleSheetRule&&e.styleSheetRule(...t),c(...t)},t.styleDeclarationCb=(...t)=>{e.styleDeclaration&&e.styleDeclaration(...t),d(...t)},t.canvasMutationCb=(...t)=>{e.canvasMutation&&e.canvasMutation(...t),h(...t)},t.fontCb=(...t)=>{e.font&&e.font(...t),u(...t)},t.selectionCb=(...t)=>{e.selection&&e.selection(...t),p(...t)}}(t,e);const r=ws(t,t.doc),i=function({mousemoveCb:t,sampling:e,doc:n,mirror:r}){if(!1===e.mousemove)return()=>{};const i="number"==typeof e.mousemove?e.mousemove:50,s="number"==typeof e.mousemoveCallback?e.mousemoveCallback:500;let o,a=[];const l=Pi(e=>{const n=Date.now()-o;t(a.map(t=>(t.timeOffset-=n,t)),e),a=[],o=null},s),c=Pi(t=>{const e=bs(t),{clientX:n,clientY:i}=qi(t)?t.changedTouches[0]:t;o||(o=Date.now()),a.push({x:n,y:i,id:r.getId(e),timeOffset:Date.now()-o}),l("undefined"!=typeof DragEvent&&t instanceof DragEvent?es.Drag:t instanceof MouseEvent?es.MouseMove:es.TouchMove)},i,{trailing:!1}),d=[Bi("mousemove",c,n),Bi("touchmove",c,n),Bi("drag",c,n)];return()=>{d.forEach(t=>t())}}(t),s=function({mouseInteractionCb:t,doc:e,mirror:n,blockClass:r,blockSelector:i,sampling:s}){if(!1===s.mouseInteraction)return()=>{};const o=!0===s.mouseInteraction||void 0===s.mouseInteraction?{}:s.mouseInteraction,a=[];return Object.keys(ns).filter(t=>Number.isNaN(Number(t))&&!t.endsWith("_Departed")&&!1!==o[t]).forEach(s=>{const o=s.toLowerCase(),l=(e=>s=>{const o=bs(s);if(Ki(o,r,i,!0))return;const a=qi(s)?s.changedTouches[0]:s;if(!a)return;const l=n.getId(o),{clientX:c,clientY:d}=a;t({type:ns[e],id:l,x:c,y:d})})(s);a.push(Bi(o,l,e))}),()=>{a.forEach(t=>t())}}(t),o=vs(t),a=function({viewportResizeCb:t}){let e=-1,n=-1;return Bi("resize",Pi(()=>{const r=Vi(),i=Hi();e===r&&n===i||(t({width:Number(i),height:Number(r)}),e=r,n=i)},200),window)}(t),l=function({inputCb:t,doc:e,mirror:n,blockClass:r,blockSelector:i,ignoreClass:s,maskInputOptions:o,maskInputFn:a,sampling:l,userTriggeredOnInput:c}){function d(t){let n=bs(t);const l=t.isTrusted;if(n&&"OPTION"===n.tagName&&(n=n.parentElement),!n||!n.tagName||Is.indexOf(n.tagName)<0||Ki(n,r,i,!0))return;const d=n.type;if(n.classList.contains(s))return;let u=n.value,p=!1;"radio"===d||"checkbox"===d?p=n.checked:(o[n.tagName.toLowerCase()]||o[d])&&(u=bi({maskInputOptions:o,tagName:n.tagName,type:d,value:u,maskInputFn:a})),h(n,Cs({text:u,isChecked:p,userTriggered:l},c));const g=n.name;"radio"===d&&g&&p&&e.querySelectorAll(`input[type="radio"][name="${g}"]`).forEach(t=>{t!==n&&h(t,Cs({text:t.value,isChecked:!p,userTriggered:!1},c))})}function h(e,r){const i=_s.get(e);if(!i||i.text!==r.text||i.isChecked!==r.isChecked){_s.set(e,r);const i=n.getId(e);t(Object.assign(Object.assign({},r),{id:i}))}}const u=("last"===l.input?["change"]:["input","change"]).map(t=>Bi(t,d,e)),p=e.defaultView;if(!p)return()=>{u.forEach(t=>t())};const g=p.Object.getOwnPropertyDescriptor(p.HTMLInputElement.prototype,"value"),m=[[p.HTMLInputElement.prototype,"value"],[p.HTMLInputElement.prototype,"checked"],[p.HTMLSelectElement.prototype,"value"],[p.HTMLTextAreaElement.prototype,"value"],[p.HTMLSelectElement.prototype,"selectedIndex"],[p.HTMLOptionElement.prototype,"selected"]];return g&&g.set&&u.push(...m.map(t=>Wi(t[0],t[1],{set(){d({target:this})}},!1,p))),()=>{u.forEach(t=>t())}}(t),c=function({mediaInteractionCb:t,blockClass:e,blockSelector:n,mirror:r,sampling:i}){const s=s=>Pi(i=>{const o=bs(i);if(!o||Ki(o,e,n,!0))return;const{currentTime:a,volume:l,muted:c,playbackRate:d}=o;t({type:s,id:r.getId(o),currentTime:a,volume:l,muted:c,playbackRate:d})},i.media||500),o=[Bi("play",s(0)),Bi("pause",s(1)),Bi("seeked",s(2)),Bi("volumechange",s(3)),Bi("ratechange",s(4))];return()=>{o.forEach(t=>t())}}(t),d=function({styleSheetRuleCb:t,mirror:e,stylesheetManager:n},{win:r}){const i=r.CSSStyleSheet.prototype.insertRule;r.CSSStyleSheet.prototype.insertRule=function(r,s){const{id:o,styleId:a}=ks(this,e,n.styleMirror);return(o&&-1!==o||a&&-1!==a)&&t({id:o,styleId:a,adds:[{rule:r,index:s}]}),i.apply(this,[r,s])};const s=r.CSSStyleSheet.prototype.deleteRule;let o,a;r.CSSStyleSheet.prototype.deleteRule=function(r){const{id:i,styleId:o}=ks(this,e,n.styleMirror);return(i&&-1!==i||o&&-1!==o)&&t({id:i,styleId:o,removes:[{index:r}]}),s.apply(this,[r])},r.CSSStyleSheet.prototype.replace&&(o=r.CSSStyleSheet.prototype.replace,r.CSSStyleSheet.prototype.replace=function(r){const{id:i,styleId:s}=ks(this,e,n.styleMirror);return(i&&-1!==i||s&&-1!==s)&&t({id:i,styleId:s,replace:r}),o.apply(this,[r])}),r.CSSStyleSheet.prototype.replaceSync&&(a=r.CSSStyleSheet.prototype.replaceSync,r.CSSStyleSheet.prototype.replaceSync=function(r){const{id:i,styleId:s}=ks(this,e,n.styleMirror);return(i&&-1!==i||s&&-1!==s)&&t({id:i,styleId:s,replaceSync:r}),a.apply(this,[r])});const l={};gs?l.CSSGroupingRule=r.CSSGroupingRule:(ms&&(l.CSSMediaRule=r.CSSMediaRule),ys&&(l.CSSConditionRule=r.CSSConditionRule),fs&&(l.CSSSupportsRule=r.CSSSupportsRule));const c={};return Object.entries(l).forEach(([r,i])=>{c[r]={insertRule:i.prototype.insertRule,deleteRule:i.prototype.deleteRule},i.prototype.insertRule=function(i,s){const{id:o,styleId:a}=ks(this.parentStyleSheet,e,n.styleMirror);return(o&&-1!==o||a&&-1!==a)&&t({id:o,styleId:a,adds:[{rule:i,index:[...Ss(this),s||0]}]}),c[r].insertRule.apply(this,[i,s])},i.prototype.deleteRule=function(i){const{id:s,styleId:o}=ks(this.parentStyleSheet,e,n.styleMirror);return(s&&-1!==s||o&&-1!==o)&&t({id:s,styleId:o,removes:[{index:[...Ss(this),i]}]}),c[r].deleteRule.apply(this,[i])}}),()=>{r.CSSStyleSheet.prototype.insertRule=i,r.CSSStyleSheet.prototype.deleteRule=s,o&&(r.CSSStyleSheet.prototype.replace=o),a&&(r.CSSStyleSheet.prototype.replaceSync=a),Object.entries(l).forEach(([t,e])=>{e.prototype.insertRule=c[t].insertRule,e.prototype.deleteRule=c[t].deleteRule})}}(t,{win:n}),h=xs(t,t.doc),u=function({styleDeclarationCb:t,mirror:e,ignoreCSSAttributes:n,stylesheetManager:r},{win:i}){const s=i.CSSStyleDeclaration.prototype.setProperty;i.CSSStyleDeclaration.prototype.setProperty=function(i,o,a){var l;if(n.has(i))return s.apply(this,[i,o,a]);const{id:c,styleId:d}=ks(null===(l=this.parentRule)||void 0===l?void 0:l.parentStyleSheet,e,r.styleMirror);return(c&&-1!==c||d&&-1!==d)&&t({id:c,styleId:d,set:{property:i,value:o,priority:a},index:Ss(this.parentRule)}),s.apply(this,[i,o,a])};const o=i.CSSStyleDeclaration.prototype.removeProperty;return i.CSSStyleDeclaration.prototype.removeProperty=function(i){var s;if(n.has(i))return o.apply(this,[i]);const{id:a,styleId:l}=ks(null===(s=this.parentRule)||void 0===s?void 0:s.parentStyleSheet,e,r.styleMirror);return(a&&-1!==a||l&&-1!==l)&&t({id:a,styleId:l,remove:{property:i},index:Ss(this.parentRule)}),o.apply(this,[i])},()=>{i.CSSStyleDeclaration.prototype.setProperty=s,i.CSSStyleDeclaration.prototype.removeProperty=o}}(t,{win:n}),p=t.collectFonts?function({fontCb:t,doc:e}){const n=e.defaultView;if(!n)return()=>{};const r=[],i=new WeakMap,s=n.FontFace;n.FontFace=function(t,e,n){const r=new s(t,e,n);return i.set(r,{family:t,buffer:"string"!=typeof e,descriptors:n,fontSource:"string"==typeof e?e:JSON.stringify(Array.from(new Uint8Array(e)))}),r};const o=Gi(e.fonts,"add",function(e){return function(n){return setTimeout(()=>{const e=i.get(n);e&&(t(e),i.delete(n))},0),e.apply(this,[n])}});return r.push(()=>{n.FontFace=s}),r.push(o),()=>{r.forEach(t=>t())}}(t):()=>{},g=function(t){const{doc:e,mirror:n,blockClass:r,blockSelector:i,selectionCb:s}=t;let o=!0;const a=()=>{const t=e.getSelection();if(!t||o&&(null==t?void 0:t.isCollapsed))return;o=t.isCollapsed||!1;const a=[],l=t.rangeCount||0;for(let e=0;e<l;e++){const s=t.getRangeAt(e),{startContainer:o,startOffset:l,endContainer:c,endOffset:d}=s;Ki(o,r,i,!0)||Ki(c,r,i,!0)||a.push({start:n.getId(o),startOffset:l,end:n.getId(c),endOffset:d})}s({ranges:a})};return a(),Bi("selectionchange",a)}(t),m=[];for(const e of t.plugins)m.push(e.observer(e.callback,n,e.options));return()=>{ps.forEach(t=>t.reset()),r.disconnect(),i(),s(),o(),a(),l(),c(),d(),h(),u(),p(),g(),m.forEach(t=>t())}}class Es{constructor(t){this.generateIdFn=t,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(t,e,n,r){const i=n||this.getIdToRemoteIdMap(t),s=r||this.getRemoteIdToIdMap(t);let o=i.get(e);return o||(o=this.generateIdFn(),i.set(e,o),s.set(o,e)),o}getIds(t,e){const n=this.getIdToRemoteIdMap(t),r=this.getRemoteIdToIdMap(t);return e.map(e=>this.getId(t,e,n,r))}getRemoteId(t,e,n){const r=n||this.getRemoteIdToIdMap(t);if("number"!=typeof e)return e;return r.get(e)||-1}getRemoteIds(t,e){const n=this.getRemoteIdToIdMap(t);return e.map(e=>this.getRemoteId(t,e,n))}reset(t){if(!t)return this.iframeIdToRemoteIdMap=new WeakMap,void(this.iframeRemoteIdToIdMap=new WeakMap);this.iframeIdToRemoteIdMap.delete(t),this.iframeRemoteIdToIdMap.delete(t)}getIdToRemoteIdMap(t){let e=this.iframeIdToRemoteIdMap.get(t);return e||(e=new Map,this.iframeIdToRemoteIdMap.set(t,e)),e}getRemoteIdToIdMap(t){let e=this.iframeRemoteIdToIdMap.get(t);return e||(e=new Map,this.iframeRemoteIdToIdMap.set(t,e)),e}}class Rs{constructor(t){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new Es(Si),this.mutationCb=t.mutationCb,this.wrappedEmit=t.wrappedEmit,this.stylesheetManager=t.stylesheetManager,this.recordCrossOriginIframes=t.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new Es(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=t.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(t){this.iframes.set(t,!0),t.contentWindow&&this.crossOriginIframeMap.set(t.contentWindow,t)}addLoadListener(t){this.loadListener=t}attachIframe(t,e){var n;this.mutationCb({adds:[{parentId:this.mirror.getId(t),nextId:null,node:e}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),null===(n=this.loadListener)||void 0===n||n.call(this,t),t.contentDocument&&t.contentDocument.adoptedStyleSheets&&t.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(t.contentDocument.adoptedStyleSheets,this.mirror.getId(t.contentDocument))}handleMessage(t){if("rrweb"===t.data.type){if(!t.source)return;const e=this.crossOriginIframeMap.get(t.source);if(!e)return;const n=this.transformCrossOriginEvent(e,t.data.event);n&&this.wrappedEmit(n,t.data.isCheckout)}}transformCrossOriginEvent(t,e){var n;switch(e.type){case ts.FullSnapshot:return this.crossOriginIframeMirror.reset(t),this.crossOriginIframeStyleMirror.reset(t),this.replaceIdOnNode(e.data.node,t),{timestamp:e.timestamp,type:ts.IncrementalSnapshot,data:{source:es.Mutation,adds:[{parentId:this.mirror.getId(t),nextId:null,node:e.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}};case ts.Meta:case ts.Load:case ts.DomContentLoaded:return!1;case ts.Plugin:return e;case ts.Custom:return this.replaceIds(e.data.payload,t,["id","parentId","previousId","nextId"]),e;case ts.IncrementalSnapshot:switch(e.data.source){case es.Mutation:return e.data.adds.forEach(e=>{this.replaceIds(e,t,["parentId","nextId","previousId"]),this.replaceIdOnNode(e.node,t)}),e.data.removes.forEach(e=>{this.replaceIds(e,t,["parentId","id"])}),e.data.attributes.forEach(e=>{this.replaceIds(e,t,["id"])}),e.data.texts.forEach(e=>{this.replaceIds(e,t,["id"])}),e;case es.Drag:case es.TouchMove:case es.MouseMove:return e.data.positions.forEach(e=>{this.replaceIds(e,t,["id"])}),e;case es.ViewportResize:return!1;case es.MediaInteraction:case es.MouseInteraction:case es.Scroll:case es.CanvasMutation:case es.Input:return this.replaceIds(e.data,t,["id"]),e;case es.StyleSheetRule:case es.StyleDeclaration:return this.replaceIds(e.data,t,["id"]),this.replaceStyleIds(e.data,t,["styleId"]),e;case es.Font:return e;case es.Selection:return e.data.ranges.forEach(e=>{this.replaceIds(e,t,["start","end"])}),e;case es.AdoptedStyleSheet:return this.replaceIds(e.data,t,["id"]),this.replaceStyleIds(e.data,t,["styleIds"]),null===(n=e.data.styles)||void 0===n||n.forEach(e=>{this.replaceStyleIds(e,t,["styleId"])}),e}}}replace(t,e,n,r){for(const i of r)(Array.isArray(e[i])||"number"==typeof e[i])&&(Array.isArray(e[i])?e[i]=t.getIds(n,e[i]):e[i]=t.getId(n,e[i]));return e}replaceIds(t,e,n){return this.replace(this.crossOriginIframeMirror,t,e,n)}replaceStyleIds(t,e,n){return this.replace(this.crossOriginIframeStyleMirror,t,e,n)}replaceIdOnNode(t,e){this.replaceIds(t,e,["id"]),"childNodes"in t&&t.childNodes.forEach(t=>{this.replaceIdOnNode(t,e)})}}class Ms{constructor(t){this.shadowDoms=new WeakSet,this.restorePatches=[],this.mutationCb=t.mutationCb,this.scrollCb=t.scrollCb,this.bypassOptions=t.bypassOptions,this.mirror=t.mirror;const e=this;this.restorePatches.push(Gi(Element.prototype,"attachShadow",function(t){return function(n){const r=t.call(this,n);return this.shadowRoot&&e.addShadowRoot(this.shadowRoot,this.ownerDocument),r}}))}addShadowRoot(t,e){gi(t)&&(this.shadowDoms.has(t)||(this.shadowDoms.add(t),ws(Object.assign(Object.assign({},this.bypassOptions),{doc:e,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),t),vs(Object.assign(Object.assign({},this.bypassOptions),{scrollCb:this.scrollCb,doc:t,mirror:this.mirror})),setTimeout(()=>{t.adoptedStyleSheets&&t.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(t.adoptedStyleSheets,this.mirror.getId(t.host)),xs({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},t)},0)))}observeAttachShadow(t){if(t.contentWindow){const e=this;this.restorePatches.push(Gi(t.contentWindow.HTMLElement.prototype,"attachShadow",function(n){return function(r){const i=n.call(this,r);return this.shadowRoot&&e.addShadowRoot(this.shadowRoot,t.contentDocument),i}}))}}reset(){this.restorePatches.forEach(t=>t()),this.shadowDoms=new WeakSet}}for(var Ts="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",zs="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Ls=0;Ls<64;Ls++)zs[Ts.charCodeAt(Ls)]=Ls;const Ds=new Map,Ns=(t,e,n)=>{if(!t||!Bs(t,e)&&"object"!=typeof t)return;const r=function(t,e){let n=Ds.get(t);return n||(n=new Map,Ds.set(t,n)),n.has(e)||n.set(e,[]),n.get(e)}(n,t.constructor.name);let i=r.indexOf(t);return-1===i&&(i=r.length,r.push(t)),i};function Os(t,e,n){if(t instanceof Array)return t.map(t=>Os(t,e,n));if(null===t)return t;if(t instanceof Float32Array||t instanceof Float64Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Int8Array||t instanceof Uint8ClampedArray)return{rr_type:t.constructor.name,args:[Object.values(t)]};if(t instanceof ArrayBuffer){const e=t.constructor.name,n=function(t){var e,n=new Uint8Array(t),r=n.length,i="";for(e=0;e<r;e+=3)i+=Ts[n[e]>>2],i+=Ts[(3&n[e])<<4|n[e+1]>>4],i+=Ts[(15&n[e+1])<<2|n[e+2]>>6],i+=Ts[63&n[e+2]];return r%3==2?i=i.substring(0,i.length-1)+"=":r%3==1&&(i=i.substring(0,i.length-2)+"=="),i}(t);return{rr_type:e,base64:n}}if(t instanceof DataView)return{rr_type:t.constructor.name,args:[Os(t.buffer,e,n),t.byteOffset,t.byteLength]};if(t instanceof HTMLImageElement){const e=t.constructor.name,{src:n}=t;return{rr_type:e,src:n}}return t instanceof HTMLCanvasElement?{rr_type:"HTMLImageElement",src:t.toDataURL()}:t instanceof ImageData?{rr_type:t.constructor.name,args:[Os(t.data,e,n),t.width,t.height]}:Bs(t,e)||"object"==typeof t?{rr_type:t.constructor.name,index:Ns(t,e,n)}:t}const Fs=(t,e,n)=>[...t].map(t=>Os(t,e,n)),Bs=(t,e)=>{const n=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter(t=>"function"==typeof e[t]);return Boolean(n.find(n=>t instanceof e[n]))};function Us(t,e,n){const r=[];try{const i=Gi(t.HTMLCanvasElement.prototype,"getContext",function(t){return function(r,...i){return Ki(this,e,n,!0)||"__context"in this||(this.__context=r),t.apply(this,[r,...i])}});r.push(i)}catch(t){console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return()=>{r.forEach(t=>t())}}function Zs(t,e,n,r,i,s,o){const a=[],l=Object.getOwnPropertyNames(t);for(const s of l)if(!["isContextLost","canvas","drawingBufferWidth","drawingBufferHeight"].includes(s))try{if("function"!=typeof t[s])continue;const l=Gi(t,s,function(t){return function(...a){const l=t.apply(this,a);if(Ns(l,o,this),!Ki(this.canvas,r,i,!0)){const t=Fs([...a],o,this),r={type:e,property:s,args:t};n(this.canvas,r)}return l}});a.push(l)}catch(r){const i=Wi(t,s,{set(t){n(this.canvas,{type:e,property:s,args:[t],setter:!0})}});a.push(i)}return a}var Ps=null;try{var Ws="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof require&&require("worker_threads")||"function"==typeof require&&require("worker_threads");Ps=Ws.Worker}catch(t){}var Gs,Vs,Hs=(Gs="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIC8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLg0KDQogICAgUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55DQogICAgcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLg0KDQogICAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgNCiAgICBSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkNCiAgICBBTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsDQogICAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NDQogICAgTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1INCiAgICBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SDQogICAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4NCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLw0KDQogICAgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgew0KICAgICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOw0KICAgICAgICB9KTsNCiAgICB9CgogICAgLyoKICAgICAqIGJhc2U2NC1hcnJheWJ1ZmZlciAxLjAuMSA8aHR0cHM6Ly9naXRodWIuY29tL25pa2xhc3ZoL2Jhc2U2NC1hcnJheWJ1ZmZlcj4KICAgICAqIENvcHlyaWdodCAoYykgMjAyMSBOaWtsYXMgdm9uIEhlcnR6ZW4gPGh0dHBzOi8vaGVydHplbi5jb20+CiAgICAgKiBSZWxlYXNlZCB1bmRlciBNSVQgTGljZW5zZQogICAgICovCiAgICB2YXIgY2hhcnMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyc7CiAgICAvLyBVc2UgYSBsb29rdXAgdGFibGUgdG8gZmluZCB0aGUgaW5kZXguCiAgICB2YXIgbG9va3VwID0gdHlwZW9mIFVpbnQ4QXJyYXkgPT09ICd1bmRlZmluZWQnID8gW10gOiBuZXcgVWludDhBcnJheSgyNTYpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFycy5sZW5ndGg7IGkrKykgewogICAgICAgIGxvb2t1cFtjaGFycy5jaGFyQ29kZUF0KGkpXSA9IGk7CiAgICB9CiAgICB2YXIgZW5jb2RlID0gZnVuY3Rpb24gKGFycmF5YnVmZmVyKSB7CiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlidWZmZXIpLCBpLCBsZW4gPSBieXRlcy5sZW5ndGgsIGJhc2U2NCA9ICcnOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gMykgewogICAgICAgICAgICBiYXNlNjQgKz0gY2hhcnNbYnl0ZXNbaV0gPj4gMl07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1soKGJ5dGVzW2ldICYgMykgPDwgNCkgfCAoYnl0ZXNbaSArIDFdID4+IDQpXTsKICAgICAgICAgICAgYmFzZTY0ICs9IGNoYXJzWygoYnl0ZXNbaSArIDFdICYgMTUpIDw8IDIpIHwgKGJ5dGVzW2kgKyAyXSA+PiA2KV07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1tieXRlc1tpICsgMl0gJiA2M107CiAgICAgICAgfQogICAgICAgIGlmIChsZW4gJSAzID09PSAyKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDEpICsgJz0nOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChsZW4gJSAzID09PSAxKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDIpICsgJz09JzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJhc2U2NDsKICAgIH07CgogICAgY29uc3QgbGFzdEJsb2JNYXAgPSBuZXcgTWFwKCk7DQogICAgY29uc3QgdHJhbnNwYXJlbnRCbG9iTWFwID0gbmV3IE1hcCgpOw0KICAgIGZ1bmN0aW9uIGdldFRyYW5zcGFyZW50QmxvYkZvcih3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucykgew0KICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgew0KICAgICAgICAgICAgY29uc3QgaWQgPSBgJHt3aWR0aH0tJHtoZWlnaHR9YDsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgaWYgKHRyYW5zcGFyZW50QmxvYk1hcC5oYXMoaWQpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNwYXJlbnRCbG9iTWFwLmdldChpZCk7DQogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsNCiAgICAgICAgICAgICAgICBvZmZzY3JlZW4uZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0geWllbGQgYmxvYi5hcnJheUJ1ZmZlcigpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGJhc2U2NCA9IGVuY29kZShhcnJheUJ1ZmZlcik7DQogICAgICAgICAgICAgICAgdHJhbnNwYXJlbnRCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZTY0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgY29uc3Qgd29ya2VyID0gc2VsZjsNCiAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgY29uc3QgeyBpZCwgYml0bWFwLCB3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucyB9ID0gZS5kYXRhOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zcGFyZW50QmFzZTY0ID0gZ2V0VHJhbnNwYXJlbnRCbG9iRm9yKHdpZHRoLCBoZWlnaHQsIGRhdGFVUkxPcHRpb25zKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IG9mZnNjcmVlbi5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwKTsNCiAgICAgICAgICAgICAgICBiaXRtYXAuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBibG9iLnR5cGU7DQogICAgICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSB5aWVsZCBibG9iLmFycmF5QnVmZmVyKCk7DQogICAgICAgICAgICAgICAgY29uc3QgYmFzZTY0ID0gZW5jb2RlKGFycmF5QnVmZmVyKTsNCiAgICAgICAgICAgICAgICBpZiAoIWxhc3RCbG9iTWFwLmhhcyhpZCkgJiYgKHlpZWxkIHRyYW5zcGFyZW50QmFzZTY0KSA9PT0gYmFzZTY0KSB7DQogICAgICAgICAgICAgICAgICAgIGxhc3RCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZSh7IGlkIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobGFzdEJsb2JNYXAuZ2V0KGlkKSA9PT0gYmFzZTY0KQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQgfSk7DQogICAgICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgICAgICAgICAgaWQsDQogICAgICAgICAgICAgICAgICAgIHR5cGUsDQogICAgICAgICAgICAgICAgICAgIGJhc2U2NCwNCiAgICAgICAgICAgICAgICAgICAgd2lkdGgsDQogICAgICAgICAgICAgICAgICAgIGhlaWdodCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBsYXN0QmxvYk1hcC5zZXQoaWQsIGJhc2U2NCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQ6IGUuZGF0YS5pZCB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfTsKCn0pKCk7Cgo=",Vs=!1,"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)?function(t,e,n){var r=void 0===e?null:e,i=function(t,e){return Buffer.from(t,"base64").toString(e?"utf16":"utf8")}(t,void 0!==n&&n),s=i.indexOf("\n",10)+1,o=i.substring(s)+(r?"//# sourceMappingURL="+r:"");return function(t){return new Ps(o,Object.assign({},t,{eval:!0}))}}(Gs,null,Vs):function(t){var e;return function(n){return e=e||function(t,e,n){var r=void 0===e?null:e,i=function(t,e){var n=atob(t);if(e){for(var r=new Uint8Array(n.length),i=0,s=n.length;i<s;++i)r[i]=n.charCodeAt(i);return String.fromCharCode.apply(null,new Uint16Array(r.buffer))}return n}(t,void 0!==n&&n),s=i.indexOf("\n",10)+1,o=i.substring(s)+(r?"//# sourceMappingURL="+r:""),a=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(a)}(t,null,false),new Worker(e,n)}}(Gs));class Ks{constructor(t){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.frozen=!1,this.locked=!1,this.processMutation=(t,e)=>{!(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId)&&this.rafStamps.invokeId||(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(t)||this.pendingCanvasMutations.set(t,[]),this.pendingCanvasMutations.get(t).push(e)};const{sampling:e="all",win:n,blockClass:r,blockSelector:i,recordCanvas:s,dataURLOptions:o}=t;this.mutationCb=t.mutationCb,this.mirror=t.mirror,s&&"all"===e&&this.initCanvasMutationObserver(n,r,i),s&&"number"==typeof e&&this.initCanvasFPSObserver(e,n,r,i,{dataURLOptions:o})}reset(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}initCanvasFPSObserver(t,e,n,r,i){const s=Us(e,n,r),o=new Map,a=new Hs;a.onmessage=t=>{const{id:e}=t.data;if(o.set(e,!1),!("base64"in t.data))return;const{base64:n,type:r,width:i,height:s}=t.data;this.mutationCb({id:e,type:rs["2D"],commands:[{property:"clearRect",args:[0,0,i,s]},{property:"drawImage",args:[{rr_type:"ImageBitmap",args:[{rr_type:"Blob",data:[{rr_type:"ArrayBuffer",base64:n}],type:r}]},0,0]}]})};const l=1e3/t;let c,d=0;const h=t=>{d&&t-d<l||(d=t,(()=>{const t=[];return e.document.querySelectorAll("canvas").forEach(e=>{Ki(e,n,r,!0)||t.push(e)}),t})().forEach(t=>{return e=this,n=void 0,s=function*(){var e;const n=this.mirror.getId(t);if(o.get(n))return;if(o.set(n,!0),["webgl","webgl2"].includes(t.__context)){const n=t.getContext(t.__context);!1===(null===(e=null==n?void 0:n.getContextAttributes())||void 0===e?void 0:e.preserveDrawingBuffer)&&(null==n||n.clear(n.COLOR_BUFFER_BIT))}const r=yield createImageBitmap(t);a.postMessage({id:n,bitmap:r,width:t.width,height:t.height,dataURLOptions:i.dataURLOptions},[r])},new((r=void 0)||(r=Promise))(function(t,i){function o(t){try{l(s.next(t))}catch(t){i(t)}}function a(t){try{l(s.throw(t))}catch(t){i(t)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r(function(t){t(n)})).then(o,a)}l((s=s.apply(e,n||[])).next())});var e,n,r,s})),c=requestAnimationFrame(h)};c=requestAnimationFrame(h),this.resetObservers=()=>{s(),cancelAnimationFrame(c)}}initCanvasMutationObserver(t,e,n){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();const r=Us(t,e,n),i=function(t,e,n,r){const i=[],s=Object.getOwnPropertyNames(e.CanvasRenderingContext2D.prototype);for(const o of s)try{if("function"!=typeof e.CanvasRenderingContext2D.prototype[o])continue;const s=Gi(e.CanvasRenderingContext2D.prototype,o,function(i){return function(...s){return Ki(this.canvas,n,r,!0)||setTimeout(()=>{const n=Fs([...s],e,this);t(this.canvas,{type:rs["2D"],property:o,args:n})},0),i.apply(this,s)}});i.push(s)}catch(n){const r=Wi(e.CanvasRenderingContext2D.prototype,o,{set(e){t(this.canvas,{type:rs["2D"],property:o,args:[e],setter:!0})}});i.push(r)}return()=>{i.forEach(t=>t())}}(this.processMutation.bind(this),t,e,n),s=function(t,e,n,r){const i=[];return i.push(...Zs(e.WebGLRenderingContext.prototype,rs.WebGL,t,n,r,0,e)),void 0!==e.WebGL2RenderingContext&&i.push(...Zs(e.WebGL2RenderingContext.prototype,rs.WebGL2,t,n,r,0,e)),()=>{i.forEach(t=>t())}}(this.processMutation.bind(this),t,e,n,this.mirror);this.resetObservers=()=>{r(),i(),s()}}startPendingCanvasMutationFlusher(){requestAnimationFrame(()=>this.flushPendingCanvasMutations())}startRAFTimestamping(){const t=e=>{this.rafStamps.latestId=e,requestAnimationFrame(t)};requestAnimationFrame(t)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach((t,e)=>{const n=this.mirror.getId(e);this.flushPendingCanvasMutationFor(e,n)}),requestAnimationFrame(()=>this.flushPendingCanvasMutations())}flushPendingCanvasMutationFor(t,e){if(this.frozen||this.locked)return;const n=this.pendingCanvasMutations.get(t);if(!n||-1===e)return;const r=n.map(t=>{const e=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}(t,["type"]);return e}),{type:i}=n[0];this.mutationCb({id:e,type:i,commands:r}),this.pendingCanvasMutations.delete(t)}}class js{constructor(t){this.trackedLinkElements=new WeakSet,this.styleMirror=new Qi,this.mutationCb=t.mutationCb,this.adoptedStyleSheetCb=t.adoptedStyleSheetCb}attachLinkElement(t,e){"_cssText"in e.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:e.id,attributes:e.attributes}]}),this.trackLinkElement(t)}trackLinkElement(t){this.trackedLinkElements.has(t)||(this.trackedLinkElements.add(t),this.trackStylesheetInLinkElement(t))}adoptStyleSheets(t,e){if(0===t.length)return;const n={id:e,styleIds:[]},r=[];for(const e of t){let t;if(this.styleMirror.has(e))t=this.styleMirror.getId(e);else{t=this.styleMirror.add(e);const n=Array.from(e.rules||CSSRule);r.push({styleId:t,rules:n.map((t,e)=>({rule:fi(t),index:e}))})}n.styleIds.push(t)}r.length>0&&(n.styles=r),this.adoptedStyleSheetCb(n)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(t){}}function Ys(t){return Object.assign(Object.assign({},t),{timestamp:Date.now()})}let qs,$s,Xs,Js=!1;const Qs=new yi;function to(t={}){const{emit:e,checkoutEveryNms:n,checkoutEveryNth:r,blockClass:i="rr-block",blockSelector:s=null,ignoreClass:o="rr-ignore",maskTextClass:a="rr-mask",maskTextSelector:l=null,inlineStylesheet:c=!0,maskAllInputs:d,maskInputOptions:h,slimDOMOptions:u,maskInputFn:p,maskTextFn:g,hooks:m,packFn:f,sampling:y={},dataURLOptions:b={},mousemoveWait:w,recordCanvas:v=!1,recordCrossOriginIframes:C=!1,userTriggeredOnInput:I=!1,collectFonts:_=!1,inlineImages:S=!1,plugins:k,keepIframeSrcFn:x=()=>!1,ignoreCSSAttributes:A=new Set([])}=t,E=!C||window.parent===window;let R=!1;if(!E)try{window.parent.document,R=!1}catch(t){R=!0}if(E&&!e)throw new Error("emit function is required");void 0!==w&&void 0===y.mousemove&&(y.mousemove=w),Qs.reset();const M=!0===d?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:void 0!==h?h:{password:!0},T=!0===u||"all"===u?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===u,headMetaDescKeywords:"all"===u}:u||{};let z;!function(t=window){"NodeList"in t&&!t.NodeList.prototype.forEach&&(t.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in t&&!t.DOMTokenList.prototype.forEach&&(t.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...t)=>{let e=t[0];if(!(0 in t))throw new TypeError("1 argument is required");do{if(this===e)return!0}while(e=e&&e.parentNode);return!1})}();let L=0;const D=t=>{for(const e of k||[])e.eventProcessor&&(t=e.eventProcessor(t));return f&&(t=f(t)),t};qs=(t,i)=>{var s;if(!(null===(s=ps[0])||void 0===s?void 0:s.isFrozen())||t.type===ts.FullSnapshot||t.type===ts.IncrementalSnapshot&&t.data.source===es.Mutation||ps.forEach(t=>t.unfreeze()),E)null==e||e(D(t),i);else if(R){const e={type:"rrweb",event:D(t),isCheckout:i};window.parent.postMessage(e,"*")}if(t.type===ts.FullSnapshot)z=t,L=0;else if(t.type===ts.IncrementalSnapshot){if(t.data.source===es.Mutation&&t.data.isAttachIframe)return;L++;const e=r&&L>=r,i=n&&t.timestamp-z.timestamp>n;(e||i)&&$s(!0)}};const N=t=>{qs(Ys({type:ts.IncrementalSnapshot,data:Object.assign({source:es.Mutation},t)}))},O=t=>qs(Ys({type:ts.IncrementalSnapshot,data:Object.assign({source:es.Scroll},t)})),F=t=>qs(Ys({type:ts.IncrementalSnapshot,data:Object.assign({source:es.CanvasMutation},t)})),B=new js({mutationCb:N,adoptedStyleSheetCb:t=>qs(Ys({type:ts.IncrementalSnapshot,data:Object.assign({source:es.AdoptedStyleSheet},t)}))}),U=new Rs({mirror:Qs,mutationCb:N,stylesheetManager:B,recordCrossOriginIframes:C,wrappedEmit:qs});for(const t of k||[])t.getMirror&&t.getMirror({nodeMirror:Qs,crossOriginIframeMirror:U.crossOriginIframeMirror,crossOriginIframeStyleMirror:U.crossOriginIframeStyleMirror});Xs=new Ks({recordCanvas:v,mutationCb:F,win:window,blockClass:i,blockSelector:s,mirror:Qs,sampling:y.canvas,dataURLOptions:b});const Z=new Ms({mutationCb:N,scrollCb:O,bypassOptions:{blockClass:i,blockSelector:s,maskTextClass:a,maskTextSelector:l,inlineStylesheet:c,maskInputOptions:M,dataURLOptions:b,maskTextFn:g,maskInputFn:p,recordCanvas:v,inlineImages:S,sampling:y,slimDOMOptions:T,iframeManager:U,stylesheetManager:B,canvasManager:Xs,keepIframeSrcFn:x},mirror:Qs});$s=(t=!1)=>{var e,n,r,o,d,h;qs(Ys({type:ts.Meta,data:{href:window.location.href,width:Hi(),height:Vi()}}),t),B.reset(),ps.forEach(t=>t.lock());const u=function(t,e){var n=e||{},r=n.mirror,i=void 0===r?new yi:r,s=n.blockClass,o=n.blockSelector,a=n.maskTextClass,l=n.maskTextSelector,c=n.inlineStylesheet,d=n.inlineImages,h=n.recordCanvas,u=n.maskAllInputs,p=void 0!==u&&u,g=n.slimDOM,m=void 0!==g&&g,f=n.keepIframeSrcFn;return Fi(t,{doc:t,mirror:i,blockClass:void 0===s?"rr-block":s,blockSelector:void 0===o?null:o,maskTextClass:void 0===a?"rr-mask":a,maskTextSelector:void 0===l?null:l,skipChild:!1,inlineStylesheet:void 0===c||c,maskInputOptions:!0===p?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:!1===p?{password:!0}:p,maskTextFn:n.maskTextFn,maskInputFn:n.maskInputFn,slimDOMOptions:!0===m||"all"===m?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===m,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===m?{}:m,dataURLOptions:n.dataURLOptions,inlineImages:void 0!==d&&d,recordCanvas:void 0!==h&&h,preserveWhiteSpace:n.preserveWhiteSpace,onSerialize:n.onSerialize,onIframeLoad:n.onIframeLoad,iframeLoadTimeout:n.iframeLoadTimeout,onStylesheetLoad:n.onStylesheetLoad,stylesheetLoadTimeout:n.stylesheetLoadTimeout,keepIframeSrcFn:void 0===f?function(){return!1}:f,newlyAddedElement:!1})}(document,{mirror:Qs,blockClass:i,blockSelector:s,maskTextClass:a,maskTextSelector:l,inlineStylesheet:c,maskAllInputs:M,maskTextFn:g,slimDOM:T,dataURLOptions:b,recordCanvas:v,inlineImages:S,onSerialize:t=>{$i(t,Qs)&&U.addIframe(t),Xi(t,Qs)&&B.trackLinkElement(t),Ji(t)&&Z.addShadowRoot(t.shadowRoot,document)},onIframeLoad:(t,e)=>{U.attachIframe(t,e),Z.observeAttachShadow(t)},onStylesheetLoad:(t,e)=>{B.attachLinkElement(t,e)},keepIframeSrcFn:x});if(!u)return console.warn("Failed to snapshot the document");qs(Ys({type:ts.FullSnapshot,data:{node:u,initialOffset:{left:void 0!==window.pageXOffset?window.pageXOffset:(null===document||void 0===document?void 0:document.documentElement.scrollLeft)||(null===(n=null===(e=null===document||void 0===document?void 0:document.body)||void 0===e?void 0:e.parentElement)||void 0===n?void 0:n.scrollLeft)||(null===(r=null===document||void 0===document?void 0:document.body)||void 0===r?void 0:r.scrollLeft)||0,top:void 0!==window.pageYOffset?window.pageYOffset:(null===document||void 0===document?void 0:document.documentElement.scrollTop)||(null===(d=null===(o=null===document||void 0===document?void 0:document.body)||void 0===o?void 0:o.parentElement)||void 0===d?void 0:d.scrollTop)||(null===(h=null===document||void 0===document?void 0:document.body)||void 0===h?void 0:h.scrollTop)||0}}})),ps.forEach(t=>t.unlock()),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&B.adoptStyleSheets(document.adoptedStyleSheets,Qs.getId(document))};try{const t=[];t.push(Bi("DOMContentLoaded",()=>{qs(Ys({type:ts.DomContentLoaded,data:{}}))}));const e=t=>{var e;return As({mutationCb:N,mousemoveCb:(t,e)=>qs(Ys({type:ts.IncrementalSnapshot,data:{source:e,positions:t}})),mouseInteractionCb:t=>qs(Ys({type:ts.IncrementalSnapshot,data:Object.assign({source:es.MouseInteraction},t)})),scrollCb:O,viewportResizeCb:t=>qs(Ys({type:ts.IncrementalSnapshot,data:Object.assign({source:es.ViewportResize},t)})),inputCb:t=>qs(Ys({type:ts.IncrementalSnapshot,data:Object.assign({source:es.Input},t)})),mediaInteractionCb:t=>qs(Ys({type:ts.IncrementalSnapshot,data:Object.assign({source:es.MediaInteraction},t)})),styleSheetRuleCb:t=>qs(Ys({type:ts.IncrementalSnapshot,data:Object.assign({source:es.StyleSheetRule},t)})),styleDeclarationCb:t=>qs(Ys({type:ts.IncrementalSnapshot,data:Object.assign({source:es.StyleDeclaration},t)})),canvasMutationCb:F,fontCb:t=>qs(Ys({type:ts.IncrementalSnapshot,data:Object.assign({source:es.Font},t)})),selectionCb:t=>{qs(Ys({type:ts.IncrementalSnapshot,data:Object.assign({source:es.Selection},t)}))},blockClass:i,ignoreClass:o,maskTextClass:a,maskTextSelector:l,maskInputOptions:M,inlineStylesheet:c,sampling:y,recordCanvas:v,inlineImages:S,userTriggeredOnInput:I,collectFonts:_,doc:t,maskInputFn:p,maskTextFn:g,keepIframeSrcFn:x,blockSelector:s,slimDOMOptions:T,dataURLOptions:b,mirror:Qs,iframeManager:U,stylesheetManager:B,shadowDomManager:Z,canvasManager:Xs,ignoreCSSAttributes:A,plugins:(null===(e=null==k?void 0:k.filter(t=>t.observer))||void 0===e?void 0:e.map(t=>({observer:t.observer,options:t.options,callback:e=>qs(Ys({type:ts.Plugin,data:{plugin:t.name,payload:e}}))})))||[]},m)};U.addLoadListener(n=>{t.push(e(n.contentDocument))});const n=()=>{$s(),t.push(e(document)),Js=!0};return"interactive"===document.readyState||"complete"===document.readyState?n():t.push(Bi("load",()=>{qs(Ys({type:ts.Load,data:{}})),n()},window)),()=>{t.forEach(t=>t()),Js=!1}}catch(t){console.warn(t)}}to.addCustomEvent=(t,e)=>{if(!Js)throw new Error("please add custom event after start recording");qs(Ys({type:ts.Custom,data:{tag:t,payload:e}}))},to.freezePage=()=>{ps.forEach(t=>t.freeze())},to.takeFullSnapshot=t=>{if(!Js)throw new Error("please take full snapshot after start recording");$s(t)},to.mirror=Qs;class eo{constructor(t){this.events=[],this.duration=1e3*t.duration}add(t){this.events.push(t),this.prune()}addBatch(t){this.events.push(...t),this.prune()}prune(){if(0===this.events.length)return;const t=Date.now()-this.duration;let e=0;for(let n=0;n<this.events.length;n++)if(this.events[n].timestamp>=t){e=n;break}e>0&&(this.events=this.events.slice(e))}getEvents(){return this.prune(),[...this.events]}getCompressedEvents(){return this.getEvents()}clear(){this.events=[]}size(){return this.events.length}setDuration(t){this.duration=1e3*t,this.prune()}getDuration(){return this.duration/1e3}}const no=P();class ro{constructor(t={}){this.isRecording=!1,this.sanitizer=t.sanitizer,this.config={duration:t.duration??15,sampling:{mousemove:t.sampling?.mousemove??50,scroll:t.sampling?.scroll??100},recordCanvas:t.recordCanvas??!1,recordCrossOriginIframes:t.recordCrossOriginIframes??!1,sanitizer:t.sanitizer},this.buffer=new eo({duration:this.config.duration})}startRecording(){if(this.isRecording)P().warn("DOMCollector: Recording already in progress");else try{const t={emit:t=>{this.buffer.add(t)},sampling:{mousemove:this.config.sampling?.mousemove??50,scroll:this.config.sampling?.scroll??100,mouseInteraction:{MouseUp:!1,MouseDown:!1,Click:!1,ContextMenu:!1,DblClick:!1,Focus:!1,Blur:!1,TouchStart:!1,TouchEnd:!1}},recordCanvas:this.config.recordCanvas,recordCrossOriginIframes:this.config.recordCrossOriginIframes,maskTextFn:this.sanitizer?(t,e)=>this.sanitizer.sanitizeTextNode(t,e):void 0,slimDOMOptions:{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0},inlineImages:!1,collectFonts:!1};this.stopRecordingFn=to(t),this.isRecording=!0,P().debug("DOMCollector: Started recording")}catch(t){P().error("DOMCollector: Failed to start recording",t),this.isRecording=!1}}stopRecording(){if(this.isRecording&&this.stopRecordingFn)try{this.stopRecordingFn(),this.isRecording=!1,this.stopRecordingFn=void 0,no.debug("DOMCollector: Stopped recording")}catch(t){no.error("DOMCollector: Failed to stop recording",t)}else no.warn("DOMCollector: No recording in progress")}getEvents(){return this.buffer.getEvents()}getCompressedEvents(){return this.buffer.getCompressedEvents()}clearBuffer(){this.buffer.clear()}isCurrentlyRecording(){return this.isRecording}getBufferSize(){return this.buffer.size()}setDuration(t){this.config.duration=t,this.buffer.setDuration(t)}getDuration(){return this.config.duration}destroy(){this.stopRecording(),this.clearBuffer()}}const io=P();class so{constructor(t){this.config=t,!1!==t.sanitize?.enabled&&(this.sanitizer=ci({enabled:t.sanitize?.enabled??!0,patterns:t.sanitize?.patterns,customPatterns:t.sanitize?.customPatterns,excludeSelectors:t.sanitize?.excludeSelectors})),this.screenshot=new xr,this.console=new Rr({sanitizer:this.sanitizer}),this.network=new Mr({sanitizer:this.sanitizer}),this.metadata=new Tr({sanitizer:this.sanitizer}),!1!==t.replay?.enabled&&(this.domCollector=new ro({duration:t.replay?.duration??15,sampling:t.replay?.sampling,sanitizer:this.sanitizer}),this.domCollector.startRecording()),!1!==t.showWidget&&(this.widget=new Wr(t.widgetOptions),this.widget.onClick(async()=>{await this.handleBugReport()}))}static init(t){return so.instance||(so.instance=new so(t)),so.instance}static getInstance(){return so.instance||null}async capture(){return{screenshot:await this.screenshot.capture(),console:this.console.getLogs(),network:this.network.getRequests(),metadata:this.metadata.capture(),replay:this.domCollector?.getEvents()??[]}}async handleBugReport(){const t=await this.capture();new hi({onSubmit:async e=>{if(io.log("Submitting bug:",{...e,report:t}),this.config.endpoint)try{await this.submitBugReport({...e,report:t}),io.log("Bug report submitted successfully")}catch(t){throw io.error("Failed to submit bug report:",t),t}}}).show(t.screenshot)}async submitBugReport(t){if(!this.config.endpoint)throw new Error("No endpoint configured for bug report submission");const e={"Content-Type":"application/json"};let n;io.warn(`Submitting bug report to ${this.config.endpoint}`);try{const r=kr(t),i=await vr(t),s=i.byteLength,o=Sr(r,s);io.log(`Payload compression: ${(r/1024).toFixed(1)}KB  ${(s/1024).toFixed(1)}KB (${o}% reduction)`),s<r?(n=new Blob([new Uint8Array(i)],{type:"application/gzip"}),e["Content-Encoding"]="gzip",e["Content-Type"]="application/gzip"):n=JSON.stringify(t)}catch(e){io.warn("Compression failed, sending uncompressed payload:",e),n=JSON.stringify(t)}const r=this.config.auth||this.config.apiKey,i=await Dr(this.config.endpoint,n,e,r);if(io.warn(`${JSON.stringify(i)}`),!i.ok){const t=await i.text().catch(()=>"Unknown error");throw new Error(`Failed to submit bug report: ${i.status} ${i.statusText}. ${t}`)}return i.json().catch(()=>{})}getConfig(){return{...this.config}}destroy(){this.console.destroy(),this.network.destroy(),this.domCollector?.destroy(),this.widget?.destroy(),so.instance=void 0}}function oo(t){return ci({enabled:!0,patterns:"all",customPatterns:[],excludeSelectors:[]}).sanitize(t)}return e})());