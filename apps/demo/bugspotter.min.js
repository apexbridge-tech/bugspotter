/*! For license information please see bugspotter.min.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.BugSpotter=e():t.BugSpotter=e()}(this,()=>(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{BugReportModal:()=>yt,BugSpotter:()=>dn,CircularBuffer:()=>cn,ConsoleCapture:()=>P,DEFAULT_PATTERNS:()=>it,DOMCollector:()=>ln,FloatingButton:()=>Y,MetadataCapture:()=>Z,NetworkCapture:()=>V,PATTERN_CATEGORIES:()=>rt,PATTERN_PRESETS:()=>ct,PatternBuilder:()=>at,Sanitizer:()=>mt,ScreenshotCapture:()=>W,createPatternConfig:()=>lt,createSanitizer:()=>ft,getPattern:()=>ot,getPatternsByCategory:()=>st,sanitize:()=>hn,validatePattern:()=>dt});const n=(()=>{let t=0;return()=>(t+=1,`u${`0000${(Math.random()*36**4|0).toString(36)}`.slice(-4)}${t}`)})();function i(t){const e=[];for(let n=0,i=t.length;n<i;n++)e.push(t[n]);return e}let r=null;function o(t={}){return r||(t.includeStyleProperties?(r=t.includeStyleProperties,r):(r=i(window.getComputedStyle(document.documentElement)),r))}function s(t,e){const n=(t.ownerDocument.defaultView||window).getComputedStyle(t).getPropertyValue(e);return n?parseFloat(n.replace("px","")):0}function a(t,e={}){return{width:e.width||function(t){const e=s(t,"border-left-width"),n=s(t,"border-right-width");return t.clientWidth+e+n}(t),height:e.height||function(t){const e=s(t,"border-top-width"),n=s(t,"border-bottom-width");return t.clientHeight+e+n}(t)}}const c=16384;function l(t){return new Promise((e,n)=>{const i=new Image;i.onload=()=>{i.decode().then(()=>{requestAnimationFrame(()=>e(i))})},i.onerror=n,i.crossOrigin="anonymous",i.decoding="async",i.src=t})}const d=(t,e)=>{if(t instanceof e)return!0;const n=Object.getPrototypeOf(t);return null!==n&&(n.constructor.name===e.name||d(n,e))};function h(t,e,i,r){const s=window.getComputedStyle(t,i),a=s.getPropertyValue("content");if(""===a||"none"===a)return;const c=n();try{e.className=`${e.className} ${c}`}catch(t){return}const l=document.createElement("style");l.appendChild(function(t,e,n,i){const r=`.${t}:${e}`,s=n.cssText?function(t){const e=t.getPropertyValue("content");return`${t.cssText} content: '${e.replace(/'|"/g,"")}';`}(n):function(t,e){return o(e).map(e=>`${e}: ${t.getPropertyValue(e)}${t.getPropertyPriority(e)?" !important":""};`).join(" ")}(n,i);return document.createTextNode(`${r}{${s}}`)}(c,i,s,r)),e.appendChild(l)}const u="application/font-woff",p="image/jpeg",g={woff:u,woff2:u,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:p,jpeg:p,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function m(t){const e=function(t){const e=/\.([^./]*?)$/g.exec(t);return e?e[1]:""}(t).toLowerCase();return g[e]||""}function f(t){return-1!==t.search(/^(data:)/)}function y(t,e){return`data:${e};base64,${t}`}async function C(t,e,n){const i=await fetch(t,e);if(404===i.status)throw new Error(`Resource "${i.url}" not found`);const r=await i.blob();return new Promise((t,e)=>{const o=new FileReader;o.onerror=e,o.onloadend=()=>{try{t(n({res:i,result:o.result}))}catch(t){e(t)}},o.readAsDataURL(r)})}const I={};async function b(t,e,n){const i=function(t,e,n){let i=t.replace(/\?.*/,"");return n&&(i=t),/ttf|otf|eot|woff2?/i.test(i)&&(i=i.replace(/.*\//,"")),e?`[${e}]${i}`:i}(t,e,n.includeQueryParams);if(null!=I[i])return I[i];let r;n.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime());try{const i=await C(t,n.fetchRequestInit,({res:t,result:n})=>(e||(e=t.headers.get("Content-Type")||""),function(t){return t.split(/,/)[1]}(n)));r=y(i,e)}catch(e){r=n.imagePlaceholder||"";let i=`Failed to fetch resource: ${t}`;e&&(i="string"==typeof e?e:e.message),i&&console.warn(i)}return I[i]=r,r}const v=t=>null!=t.tagName&&"SLOT"===t.tagName.toUpperCase(),S=t=>null!=t.tagName&&"SVG"===t.tagName.toUpperCase();async function w(t,e,n){return n||!e.filter||e.filter(t)?Promise.resolve(t).then(t=>async function(t,e){return d(t,HTMLCanvasElement)?async function(t){const e=t.toDataURL();return"data:,"===e?t.cloneNode(!1):l(e)}(t):d(t,HTMLVideoElement)?async function(t,e){if(t.currentSrc){const e=document.createElement("canvas"),n=e.getContext("2d");return e.width=t.clientWidth,e.height=t.clientHeight,null==n||n.drawImage(t,0,0,e.width,e.height),l(e.toDataURL())}const n=t.poster,i=m(n);return l(await b(n,i,e))}(t,e):d(t,HTMLIFrameElement)?async function(t,e){var n;try{if(null===(n=null==t?void 0:t.contentDocument)||void 0===n?void 0:n.body)return await w(t.contentDocument.body,e,!0)}catch(t){}return t.cloneNode(!1)}(t,e):t.cloneNode(S(t))}(t,e)).then(n=>async function(t,e,n){var r,o;if(S(e))return e;let s=[];return s=v(t)&&t.assignedNodes?i(t.assignedNodes()):d(t,HTMLIFrameElement)&&(null===(r=t.contentDocument)||void 0===r?void 0:r.body)?i(t.contentDocument.body.childNodes):i((null!==(o=t.shadowRoot)&&void 0!==o?o:t).childNodes),0===s.length||d(t,HTMLVideoElement)||await s.reduce((t,i)=>t.then(()=>w(i,n)).then(t=>{t&&e.appendChild(t)}),Promise.resolve()),e}(t,n,e)).then(n=>function(t,e,n){return d(e,Element)&&(function(t,e,n){const i=e.style;if(!i)return;const r=window.getComputedStyle(t);r.cssText?(i.cssText=r.cssText,i.transformOrigin=r.transformOrigin):o(n).forEach(n=>{let o=r.getPropertyValue(n);if("font-size"===n&&o.endsWith("px")){const t=Math.floor(parseFloat(o.substring(0,o.length-2)))-.1;o=`${t}px`}d(t,HTMLIFrameElement)&&"display"===n&&"inline"===o&&(o="block"),"d"===n&&e.getAttribute("d")&&(o=`path(${e.getAttribute("d")})`),i.setProperty(n,o,r.getPropertyPriority(n))})}(t,e,n),function(t,e,n){h(t,e,":before",n),h(t,e,":after",n)}(t,e,n),function(t,e){d(t,HTMLTextAreaElement)&&(e.innerHTML=t.value),d(t,HTMLInputElement)&&e.setAttribute("value",t.value)}(t,e),function(t,e){if(d(t,HTMLSelectElement)){const n=e,i=Array.from(n.children).find(e=>t.value===e.getAttribute("value"));i&&i.setAttribute("selected","")}}(t,e)),e}(t,n,e)).then(t=>async function(t,e){const n=t.querySelectorAll?t.querySelectorAll("use"):[];if(0===n.length)return t;const i={};for(let r=0;r<n.length;r++){const o=n[r].getAttribute("xlink:href");if(o){const n=t.querySelector(o),r=document.querySelector(o);n||!r||i[o]||(i[o]=await w(r,e,!0))}}const r=Object.values(i);if(r.length){const e="http://www.w3.org/1999/xhtml",n=document.createElementNS(e,"svg");n.setAttribute("xmlns",e),n.style.position="absolute",n.style.width="0",n.style.height="0",n.style.overflow="hidden",n.style.display="none";const i=document.createElementNS(e,"defs");n.appendChild(i);for(let t=0;t<r.length;t++)i.appendChild(r[t]);t.appendChild(n)}return t}(t,e)):null}const A=/url\((['"]?)([^'"]+?)\1\)/g,x=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,k=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function M(t){return-1!==t.search(A)}async function R(t,e,n){if(!M(t))return t;const i=function(t,{preferredFontFormat:e}){return e?t.replace(k,t=>{for(;;){const[n,,i]=x.exec(t)||[];if(!i)return"";if(i===e)return`src: ${n};`}}):t}(t,n),r=function(t){const e=[];return t.replace(A,(t,n,i)=>(e.push(i),t)),e.filter(t=>!f(t))}(i);return r.reduce((t,i)=>t.then(t=>async function(t,e,n,i,r){try{const o=n?function(t,e){if(t.match(/^[a-z]+:\/\//i))return t;if(t.match(/^\/\//))return window.location.protocol+t;if(t.match(/^[a-z]+:/i))return t;const n=document.implementation.createHTMLDocument(),i=n.createElement("base"),r=n.createElement("a");return n.head.appendChild(i),n.body.appendChild(r),e&&(i.href=e),r.href=t,r.href}(e,n):e,s=m(e);let a;return a=r?y(await r(o),s):await b(o,s,i),t.replace(function(t){const e=t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}(e),`$1${a}$3`)}catch(t){}return t}(t,i,e,n)),Promise.resolve(i))}async function E(t,e,n){var i;const r=null===(i=e.style)||void 0===i?void 0:i.getPropertyValue(t);if(r){const i=await R(r,null,n);return e.style.setProperty(t,i,e.style.getPropertyPriority(t)),!0}return!1}async function T(t,e){d(t,Element)&&(await async function(t,e){await E("background",t,e)||await E("background-image",t,e),await E("mask",t,e)||await E("-webkit-mask",t,e)||await E("mask-image",t,e)||await E("-webkit-mask-image",t,e)}(t,e),await async function(t,e){const n=d(t,HTMLImageElement);if((!n||f(t.src))&&(!d(t,SVGImageElement)||f(t.href.baseVal)))return;const i=n?t.src:t.href.baseVal,r=await b(i,m(i),e);await new Promise((i,o)=>{t.onload=i,t.onerror=e.onImageErrorHandler?(...t)=>{try{i(e.onImageErrorHandler(...t))}catch(t){o(t)}}:o;const s=t;s.decode&&(s.decode=i),"lazy"===s.loading&&(s.loading="eager"),n?(t.srcset="",t.src=r):t.href.baseVal=r})}(t,e),await async function(t,e){const n=i(t.childNodes).map(t=>T(t,e));await Promise.all(n).then(()=>t)}(t,e))}const N={};async function L(t){let e=N[t];if(null!=e)return e;const n=await fetch(t);return e={url:t,cssText:await n.text()},N[t]=e,e}async function D(t,e){let n=t.cssText;const i=/url\(["']?([^"')]+)["']?\)/g,r=(n.match(/url\([^)]+\)/g)||[]).map(async r=>{let o=r.replace(i,"$1");return o.startsWith("https://")||(o=new URL(o,t.url).href),C(o,e.fetchRequestInit,({result:t})=>(n=n.replace(r,`url(${t})`),[r,t]))});return Promise.all(r).then(()=>n)}function O(t){if(null==t)return[];const e=[];let n=t.replace(/(\/\*[\s\S]*?\*\/)/gi,"");const i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const t=i.exec(n);if(null===t)break;e.push(t[0])}n=n.replace(i,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let t=r.exec(n);if(null===t){if(t=o.exec(n),null===t)break;r.lastIndex=o.lastIndex}else o.lastIndex=r.lastIndex;e.push(t[0])}return e}function F(t){return t.trim().replace(/["']/g,"")}async function B(t,e){const n=await async function(t,e){if(null==t.ownerDocument)throw new Error("Provided element is not within a Document");const n=i(t.ownerDocument.styleSheets),r=await async function(t,e){const n=[],r=[];return t.forEach(n=>{if("cssRules"in n)try{i(n.cssRules||[]).forEach((t,i)=>{if(t.type===CSSRule.IMPORT_RULE){let o=i+1;const s=L(t.href).then(t=>D(t,e)).then(t=>O(t).forEach(t=>{try{n.insertRule(t,t.startsWith("@import")?o+=1:n.cssRules.length)}catch(e){console.error("Error inserting rule from remote css",{rule:t,error:e})}})).catch(t=>{console.error("Error loading remote css",t.toString())});r.push(s)}})}catch(i){const o=t.find(t=>null==t.href)||document.styleSheets[0];null!=n.href&&r.push(L(n.href).then(t=>D(t,e)).then(t=>O(t).forEach(t=>{o.insertRule(t,o.cssRules.length)})).catch(t=>{console.error("Error loading remote stylesheet",t)})),console.error("Error inlining remote css file",i)}}),Promise.all(r).then(()=>(t.forEach(t=>{if("cssRules"in t)try{i(t.cssRules||[]).forEach(t=>{n.push(t)})}catch(e){console.error(`Error while reading CSS rules from ${t.href}`,e)}}),n))}(n,e);return function(t){return t.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>M(t.style.getPropertyValue("src")))}(r)}(t,e),r=function(t){const e=new Set;return function t(n){(n.style.fontFamily||getComputedStyle(n).fontFamily).split(",").forEach(t=>{e.add(F(t))}),Array.from(n.children).forEach(e=>{e instanceof HTMLElement&&t(e)})}(t),e}(t);return(await Promise.all(n.filter(t=>r.has(F(t.style.fontFamily))).map(t=>{const n=t.parentStyleSheet?t.parentStyleSheet.href:null;return R(t.cssText,n,e)}))).join("\n")}async function z(t,e={}){const{width:n,height:i}=a(t,e),r=await w(t,e,!0);return await async function(t,e){const n=null!=e.fontEmbedCSS?e.fontEmbedCSS:e.skipFonts?null:await B(t,e);if(n){const e=document.createElement("style"),i=document.createTextNode(n);e.appendChild(i),t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}}(r,e),await T(r,e),function(t,e){const{style:n}=t;e.backgroundColor&&(n.backgroundColor=e.backgroundColor),e.width&&(n.width=`${e.width}px`),e.height&&(n.height=`${e.height}px`);const i=e.style;null!=i&&Object.keys(i).forEach(t=>{n[t]=i[t]})}(r,e),await async function(t,e,n){const i="http://www.w3.org/2000/svg",r=document.createElementNS(i,"svg"),o=document.createElementNS(i,"foreignObject");return r.setAttribute("width",`${e}`),r.setAttribute("height",`${n}`),r.setAttribute("viewBox",`0 0 ${e} ${n}`),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("externalResourcesRequired","true"),r.appendChild(o),o.appendChild(t),async function(t){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(t)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)}(r)}(r,n,i)}class W{constructor(t={}){this.options=t}shouldIncludeNode(t){if(!("hasAttribute"in t))return!0;const e=t,n=this.options.excludeAttribute||"data-bugspotter-exclude";return!e.hasAttribute(n)}buildCaptureOptions(){return{quality:this.options.quality??.8,cacheBust:this.options.cacheBust??true,pixelRatio:this.options.pixelRatio??window.devicePixelRatio,backgroundColor:this.options.backgroundColor??"#ffffff",...this.options.width&&{width:this.options.width},...this.options.height&&{height:this.options.height},filter:t=>this.shouldIncludeNode(t)}}async handleError(t){const e=t instanceof Error?t:new Error(String(t));return console.error("Screenshot capture failed:",e),this.options.errorPlaceholder??"SCREENSHOT_FAILED"}async capture(t){const e=t||this.options.targetElement||document.body;try{const t=this.buildCaptureOptions(),n=await async function(t,e={}){return(await async function(t,e={}){const{width:n,height:i}=a(t,e),r=await z(t,e),o=await l(r),s=document.createElement("canvas"),d=s.getContext("2d"),h=e.pixelRatio||function(){let t,e;try{e=process}catch(t){}const n=e&&e.env?e.env.devicePixelRatio:null;return n&&(t=parseInt(n,10),Number.isNaN(t)&&(t=1)),t||window.devicePixelRatio||1}(),u=e.canvasWidth||n,p=e.canvasHeight||i;return s.width=u*h,s.height=p*h,e.skipAutoScale||function(t){(t.width>c||t.height>c)&&(t.width>c&&t.height>c?t.width>t.height?(t.height*=c/t.width,t.width=c):(t.width*=c/t.height,t.height=c):t.width>c?(t.height*=c/t.width,t.width=c):(t.width*=c/t.height,t.height=c))}(s),s.style.width=`${u}`,s.style.height=`${p}`,e.backgroundColor&&(d.fillStyle=e.backgroundColor,d.fillRect(0,0,s.width,s.height)),d.drawImage(o,0,0,s.width,s.height),s}(t,e)).toDataURL()}(e,t);return n}catch(t){return this.handleError(t)}}}const U=["log","warn","error","info","debug"];class P{constructor(t={}){this.logs=[],this.logIndex=0,this.logCount=0,this.originalMethods=new Map,this.maxLogs=t.maxLogs??100,this.captureStackTrace=t.captureStackTrace??!0,this.sanitizer=t.sanitizer,this.interceptConsole(t.levels??U)}formatMessage(t){return t&&0!==t.length?(this.sanitizer?this.sanitizer.sanitizeConsoleArgs(t):t).map(t=>{if(null===t)return"null";if(void 0===t)return"undefined";if("object"==typeof t)try{return JSON.stringify(t)}catch(e){return`[${t.constructor?.name||"Object"}]`}return String(t)}).join(" "):""}createLogEntry(t,e){const n={level:t,message:this.formatMessage(e),timestamp:Date.now()};if(this.captureStackTrace&&"error"===t){const t=this.captureStack();n.stack=this.sanitizer&&t?this.sanitizer.sanitize(t):t}return n}captureStack(){const t=(new Error).stack;return t?.split("\n").slice(3).join("\n")}addLog(t){this.logCount<this.maxLogs?(this.logs.push(t),this.logCount++):this.logs[this.logIndex]=t,this.logIndex=(this.logIndex+1)%this.maxLogs}interceptConsole(t=U){t.forEach(t=>{const e=console[t];this.originalMethods.set(t,e),console[t]=(...n)=>{const i=this.createLogEntry(t,n);this.addLog(i),e.apply(console,n)}})}getLogs(){return this.logCount<this.maxLogs?[...this.logs]:[...this.logs.slice(this.logIndex),...this.logs.slice(0,this.logIndex)]}clear(){this.logs=[],this.logIndex=0,this.logCount=0}destroy(){this.originalMethods.forEach((t,e)=>{console[e]=t}),this.originalMethods.clear()}}class V{constructor(t={}){if(this.requests=[],this.maxRequests=50,this.requestIndex=0,this.requestCount=0,this.isIntercepting=!1,V.instance)return console.warn("NetworkCapture already exists, returning existing instance"),V.instance;V.instance=this,this.maxRequests=t.maxRequests??50,this.filterUrls=t.filterUrls,this.sanitizer=t.sanitizer,this.originalFetch=window.fetch,this.originalXHR={open:XMLHttpRequest.prototype.open,send:XMLHttpRequest.prototype.send},this.interceptFetch(),this.interceptXHR(),this.isIntercepting=!0}parseFetchArgs(t){const[e,n]=t;let i,r="GET";return"string"==typeof e?i=e:e instanceof Request?(i=e.url,r=e.method.toUpperCase()||"GET"):i=e.toString(),n?.method&&(r=n.method.toUpperCase()),{url:i,method:r}}createNetworkRequest(t,e,n,i,r){const o={url:t,method:e,status:n,duration:Date.now()-i,timestamp:i,...r&&{error:r}};if(this.sanitizer){const t=this.sanitizer.sanitizeNetworkData({url:o.url,method:o.method,status:o.status,...o.error&&{error:o.error}});return{...o,url:t.url||o.url,error:t.error}}return o}addRequest(t){this.filterUrls&&!this.filterUrls(t.url)||(this.requestCount<this.maxRequests?(this.requests.push(t),this.requestCount++):this.requests[this.requestIndex]=t,this.requestIndex=(this.requestIndex+1)%this.maxRequests)}interceptFetch(){const t=this.originalFetch;window.fetch=async(...e)=>{const n=Date.now(),{url:i,method:r}=this.parseFetchArgs(e);try{const o=await t(...e),s=this.createNetworkRequest(i,r,o.status,n);return this.addRequest(s),o}catch(t){const e=this.createNetworkRequest(i,r,0,n,t.message);throw this.addRequest(e),t}}}interceptXHR(){const t=this.originalXHR.open,e=this.originalXHR.send,n=this;XMLHttpRequest.prototype.open=function(e,n,...i){return this._method=e.toUpperCase(),this._url=n.toString(),this._startTime=Date.now(),t.apply(this,[e,n,...i])},XMLHttpRequest.prototype.send=function(...t){return this.addEventListener("load",()=>{const t=n.createNetworkRequest(this._url||"",this._method||"GET",this.status,this._startTime||Date.now());n.addRequest(t)}),this.addEventListener("error",()=>{const t=n.createNetworkRequest(this._url||"",this._method||"GET",0,this._startTime||Date.now(),"XMLHttpRequest failed");n.addRequest(t)}),e.apply(this,t)}}getRequests(){return this.requestCount<this.maxRequests?[...this.requests]:[...this.requests.slice(this.requestIndex),...this.requests.slice(0,this.requestIndex)]}clear(){this.requests=[],this.requestIndex=0,this.requestCount=0}destroy(){this.isIntercepting&&(window.fetch=this.originalFetch,XMLHttpRequest.prototype.open=this.originalXHR.open,XMLHttpRequest.prototype.send=this.originalXHR.send,V.instance=null,this.isIntercepting=!1)}}V.instance=null;class Z{constructor(t){this.browserPatterns=[{pattern:"Edg",name:"Edge"},{pattern:"Chrome",exclude:"Edge",name:"Chrome"},{pattern:"Firefox",name:"Firefox"},{pattern:"Safari",exclude:"Chrome",name:"Safari"}],this.osPatterns=[{patterns:["iPhone","iPad"],name:"iOS"},{patterns:["Android"],name:"Android"},{patterns:["Win"],name:"Windows"},{patterns:["Mac"],name:"macOS"},{patterns:["Linux"],name:"Linux"}],this.sanitizer=t}capture(){const t={userAgent:navigator.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight},browser:this.detectBrowser(),os:this.detectOS(),url:window.location.href,timestamp:Date.now()};return this.sanitizer&&(t.url=this.sanitizer.sanitize(t.url),t.userAgent=this.sanitizer.sanitize(t.userAgent)),t}detectBrowser(){const t=navigator.userAgent;for(const{pattern:e,exclude:n,name:i}of this.browserPatterns)if(t.includes(e)&&(!n||!t.includes(n)))return i;return"Unknown"}detectOS(){const t=navigator.userAgent;for(const{patterns:e,name:n}of this.osPatterns)if(e.some(e=>t.includes(e)))return n;return"Unknown"}}const G={position:"bottom-right",icon:"🐛",backgroundColor:"#ef4444",size:60,offset:{x:20,y:20},zIndex:999999},H="0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06)",q="0 10px 15px rgba(0, 0, 0, 0.2), 0 4px 6px rgba(0, 0, 0, 0.1)",K="scale(1)",_="scale(1.1)",j="scale(0.95)";class Y{constructor(t={}){this.eventHandlers=new Map,this.handleMouseEnter=()=>{this.button.style.transform=_,this.button.style.boxShadow=q},this.handleMouseLeave=()=>{this.button.style.transform=K,this.button.style.boxShadow=H},this.handleMouseDown=()=>{this.button.style.transform=j},this.handleMouseUp=()=>{this.button.style.transform=_},this.options={position:t.position??G.position,icon:t.icon??G.icon,backgroundColor:t.backgroundColor??G.backgroundColor,size:t.size??G.size,offset:t.offset??G.offset,zIndex:t.zIndex??G.zIndex},this.button=this.createButton(),document.body?document.body.appendChild(this.button):document.addEventListener("DOMContentLoaded",()=>{document.body.appendChild(this.button)})}createButton(){const t=document.createElement("button");return t.textContent=this.options.icon,t.setAttribute("aria-label","Report Bug"),t.setAttribute("data-bugspotter-exclude","true"),t.style.cssText=this.getButtonStyles(),this.addHoverEffects(t),t}getButtonStyles(){const{position:t,size:e,offset:n,backgroundColor:i,zIndex:r}=this.options;return`\n      position: fixed;\n      ${this.getPositionStyles(t,n)}\n      width: ${e}px;\n      height: ${e}px;\n      border-radius: 50%;\n      background: ${i};\n      color: white;\n      border: none;\n      cursor: pointer;\n      font-size: ${.5*e}px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      box-shadow: ${H};\n      transition: transform 0.2s ease, box-shadow 0.2s ease;\n      z-index: ${r};\n    `}getPositionStyles(t,e){switch(t){case"bottom-right":default:return`bottom: ${e.y}px; right: ${e.x}px;`;case"bottom-left":return`bottom: ${e.y}px; left: ${e.x}px;`;case"top-right":return`top: ${e.y}px; right: ${e.x}px;`;case"top-left":return`top: ${e.y}px; left: ${e.x}px;`}}addHoverEffects(t){const e={mouseenter:this.handleMouseEnter,mouseleave:this.handleMouseLeave,mousedown:this.handleMouseDown,mouseup:this.handleMouseUp};Object.entries(e).forEach(([e,n])=>{t.addEventListener(e,n),this.eventHandlers.set(e,n)})}onClick(t){this.button.addEventListener("click",t)}show(){this.button.style.display="flex"}hide(){this.button.style.display="none"}setIcon(t){this.button.textContent=t}setBackgroundColor(t){this.button.style.backgroundColor=t}destroy(){this.eventHandlers.forEach((t,e)=>{this.button.removeEventListener(e,t)}),this.eventHandlers.clear(),this.button.remove()}}class ${constructor(t={}){this.config={primaryColor:t.primaryColor||"#007bff",dangerColor:t.dangerColor||"#dc3545",borderRadius:t.borderRadius||"4px",fontFamily:t.fontFamily||'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',zIndex:t.zIndex||999999}}generateStyles(){return`\n      .overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.5);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: ${this.config.zIndex};\n        font-family: ${this.config.fontFamily};\n      }\n      \n      .modal {\n        background: white;\n        border-radius: 8px;\n        width: 90%;\n        max-width: 600px;\n        max-height: 90vh;\n        overflow-y: auto;\n        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n      }\n      \n      .header {\n        padding: 20px;\n        border-bottom: 1px solid #e0e0e0;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n      \n      .header h2 {\n        margin: 0;\n        font-size: 20px;\n        font-weight: 600;\n      }\n      \n      .close {\n        background: none;\n        border: none;\n        font-size: 24px;\n        cursor: pointer;\n        color: #666;\n        padding: 0;\n        width: 30px;\n        height: 30px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        border-radius: ${this.config.borderRadius};\n      }\n      \n      .close:hover {\n        background: #f0f0f0;\n      }\n      \n      .body {\n        padding: 20px;\n      }\n      \n      .form-group {\n        margin-bottom: 20px;\n      }\n      \n      .label {\n        display: block;\n        margin-bottom: 8px;\n        font-weight: 500;\n        font-size: 14px;\n      }\n      \n      .input,\n      .textarea {\n        width: 100%;\n        padding: 10px;\n        border: 1px solid #ddd;\n        border-radius: ${this.config.borderRadius};\n        font-size: 14px;\n        font-family: ${this.config.fontFamily};\n        box-sizing: border-box;\n      }\n      \n      .input:focus,\n      .textarea:focus {\n        outline: none;\n        border-color: ${this.config.primaryColor};\n      }\n      \n      .textarea {\n        min-height: 100px;\n        resize: vertical;\n      }\n      \n      .screenshot-container {\n        margin-top: 10px;\n        position: relative;\n      }\n      \n      .screenshot {\n        max-width: 100%;\n        border: 1px solid #ddd;\n        border-radius: ${this.config.borderRadius};\n      }\n      \n      .redaction-canvas {\n        position: absolute;\n        top: 0;\n        left: 0;\n        cursor: crosshair;\n        border: 2px solid ${this.config.primaryColor};\n        border-radius: ${this.config.borderRadius};\n      }\n      \n      .redaction-controls {\n        margin-top: 10px;\n        display: flex;\n        gap: 10px;\n      }\n      \n      .btn-redact,\n      .btn-clear {\n        padding: 8px 16px;\n        border: 1px solid #ddd;\n        border-radius: ${this.config.borderRadius};\n        background: white;\n        cursor: pointer;\n        font-size: 14px;\n      }\n      \n      .btn-redact:hover,\n      .btn-clear:hover {\n        background: #f5f5f5;\n      }\n      \n      .btn-redact.active {\n        background: ${this.config.primaryColor};\n        color: white;\n        border-color: ${this.config.primaryColor};\n      }\n      \n      .pii-section {\n        margin-top: 20px;\n        padding: 15px;\n        background: #fff3cd;\n        border: 1px solid #ffc107;\n        border-radius: ${this.config.borderRadius};\n      }\n      \n      .pii-title {\n        margin: 0 0 10px 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: #856404;\n      }\n      \n      .pii-list {\n        margin: 0;\n        padding-left: 20px;\n        font-size: 13px;\n        color: #856404;\n      }\n      \n      .pii-badge {\n        display: inline-block;\n        padding: 2px 8px;\n        margin: 2px;\n        background: #ffc107;\n        color: #856404;\n        border-radius: 12px;\n        font-size: 12px;\n        font-weight: 500;\n      }\n      \n      .checkbox-group {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        margin-top: 15px;\n      }\n      \n      .checkbox {\n        width: 18px;\n        height: 18px;\n        cursor: pointer;\n      }\n      \n      .checkbox-label {\n        margin: 0;\n        font-size: 14px;\n        cursor: pointer;\n        user-select: none;\n      }\n      \n      .footer {\n        padding: 20px;\n        border-top: 1px solid #e0e0e0;\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n      }\n      \n      .btn {\n        padding: 10px 20px;\n        border: none;\n        border-radius: ${this.config.borderRadius};\n        cursor: pointer;\n        font-size: 14px;\n        font-weight: 500;\n      }\n      \n      .btn-primary {\n        background: ${this.config.primaryColor};\n        color: white;\n      }\n      \n      .btn-primary:hover {\n        opacity: 0.9;\n      }\n      \n      .btn-primary:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n      \n      .btn-secondary {\n        background: #6c757d;\n        color: white;\n      }\n      \n      .btn-secondary:hover {\n        opacity: 0.9;\n      }\n      \n      .error {\n        color: ${this.config.dangerColor};\n        font-size: 12px;\n        margin-top: 4px;\n      }\n    `}injectStyles(){const t=document.createElement("style");return t.textContent=this.generateStyles(),document.head.appendChild(t),t}removeStyles(t){t&&t.parentNode&&t.parentNode.removeChild(t)}updateConfig(t){this.config={...this.config,...t}}getConfig(){return{...this.config}}}class X{constructor(t={}){this.config={title:t.title||"Report a Bug",titlePlaceholder:t.titlePlaceholder||"Brief description of the issue",descriptionPlaceholder:t.descriptionPlaceholder||"Detailed description of what happened...",submitButtonText:t.submitButtonText||"Submit Bug Report",cancelButtonText:t.cancelButtonText||"Cancel",showScreenshot:!1!==t.showScreenshot}}generateModalHTML(t){return`\n      <div class="overlay">\n        <div class="modal">\n          ${this.generateHeader()}\n          ${this.generateBody(t)}\n          ${this.generateFooter()}\n        </div>\n      </div>\n    `}generateHeader(){return`\n      <div class="header">\n        <h2>${this.escapeHtml(this.config.title)}</h2>\n        <button class="close" aria-label="Close">&times;</button>\n      </div>\n    `}generateBody(t){return`\n      <div class="body">\n        <form class="form">\n          ${this.generateTitleField()}\n          ${this.generateDescriptionField()}\n          ${this.config.showScreenshot&&t?this.generateScreenshotSection(t):""}\n          ${this.generatePIISection()}\n        </form>\n      </div>\n    `}generateTitleField(){return`\n      <div class="form-group">\n        <label class="label" for="title">Title *</label>\n        <input\n          type="text"\n          id="title"\n          class="input"\n          placeholder="${this.escapeHtml(this.config.titlePlaceholder)}"\n          required\n        />\n        <div class="error" id="title-error"></div>\n      </div>\n    `}generateDescriptionField(){return`\n      <div class="form-group">\n        <label class="label" for="description">Description *</label>\n        <textarea\n          id="description"\n          class="textarea"\n          placeholder="${this.escapeHtml(this.config.descriptionPlaceholder)}"\n          required\n        ></textarea>\n        <div class="error" id="description-error"></div>\n      </div>\n    `}generateScreenshotSection(t){return`\n      <div class="form-group">\n        <label class="label">Screenshot</label>\n        <div class="screenshot-container">\n          <img \n            src="${t}" \n            alt="Bug screenshot" \n            class="screenshot"\n            id="screenshot"\n          />\n          <canvas \n            class="redaction-canvas" \n            id="redaction-canvas"\n            style="display: none;"\n          ></canvas>\n        </div>\n        <div class="redaction-controls">\n          <button \n            type="button" \n            class="btn-redact" \n            id="btn-redact"\n          >\n            ✏️ Redact Area\n          </button>\n          <button \n            type="button" \n            class="btn-clear" \n            id="btn-clear"\n          >\n            🗑️ Clear Redactions\n          </button>\n        </div>\n      </div>\n    `}generatePIISection(){return'\n      <div class="pii-section" id="pii-section" style="display: none;">\n        <h3 class="pii-title">⚠️ Potential PII Detected</h3>\n        <div id="pii-content"></div>\n        <div class="checkbox-group">\n          <input \n            type="checkbox" \n            id="pii-confirm" \n            class="checkbox"\n          />\n          <label for="pii-confirm" class="checkbox-label">\n            I have reviewed and redacted sensitive information\n          </label>\n        </div>\n      </div>\n    '}generateFooter(){return`\n      <div class="footer">\n        <button type="button" class="btn btn-secondary" id="btn-cancel">\n          ${this.escapeHtml(this.config.cancelButtonText)}\n        </button>\n        <button type="submit" class="btn btn-primary submit" id="btn-submit">\n          ${this.escapeHtml(this.config.submitButtonText)}\n        </button>\n      </div>\n    `}generatePIIBadge(t,e){return`<span class="bugspotter-pii-badge">${this.escapeHtml(t)}: ${e}</span>`}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}updateConfig(t){this.config={...this.config,...t}}getConfig(){return{...this.config}}}class J{constructor(){this.elements=null,this.container=null}initialize(t){this.container=t;const e=this.getRequiredElement(".overlay",t),n=this.getRequiredElement(".modal",e),i=this.getRequiredElement(".form",n);return this.elements={overlay:e,modal:n,closeButton:this.getRequiredElement(".close",n),form:i,titleInput:this.getRequiredElement("#title",i),titleError:this.getRequiredElement("#title-error",i),descriptionTextarea:this.getRequiredElement("#description",i),descriptionError:this.getRequiredElement("#description-error",i),screenshotImg:this.getOptionalElement("#screenshot",n),redactionCanvas:this.getOptionalElement("#redaction-canvas",n),redactButton:this.getOptionalElement("#btn-redact",n),clearButton:this.getOptionalElement("#btn-clear",n),piiSection:this.getRequiredElement("#pii-section",n),piiContent:this.getRequiredElement("#pii-content",n),piiConfirmCheckbox:this.getRequiredElement("#pii-confirm",n),cancelButton:this.getRequiredElement("#btn-cancel",n),submitButton:this.getRequiredElement("#btn-submit",n)},this.elements}get(){if(!this.elements)throw new Error("DOMElementCache not initialized. Call initialize() first.");return this.elements}isInitialized(){return null!==this.elements}clear(){this.elements=null,this.container=null}getRequiredElement(t,e){const n=(e||this.container||document).querySelector(t);if(!n)throw new Error(`Required element not found: ${t}`);return n}getOptionalElement(t,e){return(e||this.container||document).querySelector(t)||void 0}refreshElement(t,e){if(!this.elements||!this.container)throw new Error("DOMElementCache not initialized");const n=this.container.querySelector(e);n&&(this.elements[t]=n)}getContainer(){return this.container}}class Q{constructor(t={}){this.minTitleLength=t.minTitleLength||3,this.maxTitleLength=t.maxTitleLength||200,this.minDescriptionLength=t.minDescriptionLength||10,this.maxDescriptionLength=t.maxDescriptionLength||5e3}validate(t){const e={},n=this.validateTitle(t.title);n&&(e.title=n);const i=this.validateDescription(t.description);return i&&(e.description=i),t.piiDetected&&!t.piiConfirmed&&(e.piiConfirmation="Please confirm you have reviewed sensitive information"),{isValid:0===Object.keys(e).length,errors:e}}validateTitle(t){const e=t.trim();return e?e.length<this.minTitleLength?`Title must be at least ${this.minTitleLength} characters`:e.length>this.maxTitleLength?`Title must not exceed ${this.maxTitleLength} characters`:null:"Title is required"}validateDescription(t){const e=t.trim();return e?e.length<this.minDescriptionLength?`Description must be at least ${this.minDescriptionLength} characters`:e.length>this.maxDescriptionLength?`Description must not exceed ${this.maxDescriptionLength} characters`:null:"Description is required"}validateField(t,e,n){switch(t){case"title":return this.validateTitle(e);case"description":return this.validateDescription(e);case"piiConfirmed":return n?.piiDetected&&!e?"Please confirm you have reviewed sensitive information":null;default:return null}}isEmpty(t){return!t||0===t.trim().length}sanitizeInput(t){return t.trim()}getConfig(){return{minTitleLength:this.minTitleLength,maxTitleLength:this.maxTitleLength,minDescriptionLength:this.minDescriptionLength,maxDescriptionLength:this.maxDescriptionLength}}}class tt{constructor(t={}){this.config={showExamples:!1!==t.showExamples,groupByType:!1!==t.groupByType,maxExamplesPerType:t.maxExamplesPerType||3}}render(t,e){t&&0!==t.length?this.config.groupByType?e.innerHTML=this.renderGroupedPII(t):e.innerHTML=this.renderListPII(t):e.innerHTML=""}renderGroupedPII(t){const e=this.groupByType(t),n=[];for(const[t,i]of Object.entries(e)){const e=i.reduce((t,e)=>t+e.count,0);n.push(this.createBadge(t,e))}let i=`<div class="bugspotter-pii-badges">${n.join("")}</div>`;if(this.config.showExamples){i+='<div class="bugspotter-pii-details">',i+='<p style="margin: 10px 0 5px 0; font-size: 13px; color: #856404;">Detected types:</p>',i+='<ul class="bugspotter-pii-list">';for(const[t,n]of Object.entries(e)){const e=n.reduce((t,e)=>t+e.count,0);i+=`<li><strong>${this.escapeHtml(t)}:</strong> ${e} occurrence${1!==e?"s":""}</li>`}i+="</ul></div>"}return i}renderListPII(t){let e='<ul class="bugspotter-pii-list">';for(const n of t)e+=`<li>${this.escapeHtml(n.type)}: ${n.count} occurrence${1!==n.count?"s":""}</li>`;return e+="</ul>",e}createBadge(t,e){return`<span class="bugspotter-pii-badge">${this.escapeHtml(t)}: ${e}</span>`}groupByType(t){const e={};for(const n of t)e[n.type]||(e[n.type]=[]),e[n.type].push(n);return e}getSummary(t){const e=new Set;for(const n of t)e.add(n.type);return{totalCount:t.length,typeCount:e.size,types:Array.from(e)}}hasType(t,e){return t.some(t=>t.type===e)}filterByType(t,e){return t.filter(t=>t.type===e)}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}updateConfig(t){this.config={...this.config,...t}}getConfig(){return{...this.config}}}class et{constructor(t,e={}){this.isDrawing=!1,this.isRedactionMode=!1,this.startX=0,this.startY=0,this.redactionRects=[],this.canvas=t;const n=t.getContext("2d");if(!n)throw new Error("Failed to get 2D context from canvas");this.ctx=n,this.config={redactionColor:e.redactionColor||"#000000",cursorStyle:e.cursorStyle||"crosshair"},this.handleMouseDown=this.onMouseDown.bind(this),this.handleMouseMove=this.onMouseMove.bind(this),this.handleMouseUp=this.onMouseUp.bind(this)}initializeCanvas(t){const e=()=>{const e=t.getBoundingClientRect(),n=e.width||t.width,i=e.height||t.height;this.canvas.width=t.naturalWidth||t.width,this.canvas.height=t.naturalHeight||t.height,this.canvas.style.width=`${n}px`,this.canvas.style.height=`${i}px`};t.complete&&t.naturalWidth>0?e():t.addEventListener("load",e,{once:!0})}enableRedactionMode(){this.isRedactionMode||(this.isRedactionMode=!0,this.canvas.style.display="block",this.canvas.style.cursor=this.config.cursorStyle,this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseup",this.handleMouseUp),this.redraw())}disableRedactionMode(){this.isRedactionMode&&(this.isRedactionMode=!1,this.isDrawing=!1,this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mouseup",this.handleMouseUp),this.canvas.style.cursor="default")}toggleRedactionMode(){return this.isRedactionMode?this.disableRedactionMode():this.enableRedactionMode(),this.isRedactionMode}clearRedactions(){this.redactionRects=[],this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}getRedactions(){return[...this.redactionRects]}setRedactions(t){this.redactionRects=[...t],this.redraw()}isActive(){return this.isRedactionMode}getCanvas(){return this.canvas}toDataURL(t="image/png",e){return this.canvas.toDataURL(t,e)}hide(){this.canvas.style.display="none"}show(){this.canvas.style.display="block"}destroy(){this.disableRedactionMode(),this.clearRedactions()}onMouseDown(t){if(!this.isRedactionMode)return;const e=this.canvas.getBoundingClientRect(),n=this.canvas.width/e.width,i=this.canvas.height/e.height;this.startX=(t.clientX-e.left)*n,this.startY=(t.clientY-e.top)*i,this.isDrawing=!0}onMouseMove(t){if(!this.isDrawing||!this.isRedactionMode)return;const e=this.canvas.getBoundingClientRect(),n=this.canvas.width/e.width,i=this.canvas.height/e.height,r=(t.clientX-e.left)*n,o=(t.clientY-e.top)*i;this.redraw(),this.drawRect(this.startX,this.startY,r-this.startX,o-this.startY)}onMouseUp(t){if(!this.isDrawing||!this.isRedactionMode)return;const e=this.canvas.getBoundingClientRect(),n=this.canvas.width/e.width,i=this.canvas.height/e.height,r=(t.clientX-e.left)*n,o=(t.clientY-e.top)*i,s=r-this.startX,a=o-this.startY;Math.abs(s)>5&&Math.abs(a)>5&&this.redactionRects.push({x:this.startX,y:this.startY,width:s,height:a}),this.isDrawing=!1,this.redraw()}redraw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(const t of this.redactionRects)this.drawRect(t.x,t.y,t.width,t.height)}drawRect(t,e,n,i){this.ctx.fillStyle=this.config.redactionColor,this.ctx.fillRect(t,e,n,i)}updateConfig(t){this.config={...this.config,...t},this.isRedactionMode&&(this.canvas.style.cursor=this.config.cursorStyle)}getConfig(){return{...this.config}}}class nt{async mergeRedactions(t,e){return new Promise((n,i)=>{const r=new Image;r.onload=()=>{try{const t=document.createElement("canvas");t.width=r.naturalWidth||r.width,t.height=r.naturalHeight||r.height;const o=t.getContext("2d");if(!o)return void i(new Error("Failed to get canvas context"));o.drawImage(r,0,0),o.drawImage(e,0,0),n(t.toDataURL())}catch(t){i(t)}},r.onerror=()=>{i(new Error("Failed to load screenshot image"))},r.src=t})}async applyRedactions(t,e,n="#000000"){return new Promise((i,r)=>{const o=new Image;o.onload=()=>{try{const t=document.createElement("canvas");t.width=o.naturalWidth||o.width,t.height=o.naturalHeight||o.height;const s=t.getContext("2d");if(!s)return void r(new Error("Failed to get canvas context"));s.drawImage(o,0,0),s.fillStyle=n;for(const t of e)s.fillRect(t.x,t.y,t.width,t.height);i(t.toDataURL())}catch(t){r(t)}},o.onerror=()=>{r(new Error("Failed to load image"))},o.src=t})}async resize(t,e,n){return new Promise((i,r)=>{const o=new Image;o.onload=()=>{try{let t=o.naturalWidth||o.width,s=o.naturalHeight||o.height;if(t>e||s>n){const i=t/s;t>s?(t=e,s=t/i):(s=n,t=s*i)}const a=document.createElement("canvas");a.width=t,a.height=s;const c=a.getContext("2d");if(!c)return void r(new Error("Failed to get canvas context"));c.drawImage(o,0,0,t,s),i(a.toDataURL())}catch(t){r(t)}},o.onerror=()=>{r(new Error("Failed to load image"))},o.src=t})}async convert(t,e,n=.92){return new Promise((i,r)=>{const o=new Image;o.onload=()=>{try{const t=document.createElement("canvas");t.width=o.naturalWidth||o.width,t.height=o.naturalHeight||o.height;const s=t.getContext("2d");if(!s)return void r(new Error("Failed to get canvas context"));s.drawImage(o,0,0),i(t.toDataURL(e,n))}catch(t){r(t)}},o.onerror=()=>{r(new Error("Failed to load image"))},o.src=t})}async getDimensions(t){return new Promise((e,n)=>{const i=new Image;i.onload=()=>{e({width:i.naturalWidth||i.width,height:i.naturalHeight||i.height})},i.onerror=()=>{n(new Error("Failed to load image"))},i.src=t})}isValidDataURL(t){return/^data:image\/(png|jpeg|jpg|webp|gif);base64,/.test(t)}getEstimatedSize(t){const e=t.split(",")[1]||"";return Math.ceil(3*e.length/4)}getFormat(t){const e=t.match(/^data:image\/([a-z]+);base64,/);return e?e[1]:null}}const it={email:{name:"email",regex:/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g,description:"Email addresses",examples:["user@example.com","john.doe+tag@company.co.uk","test_user@sub.domain.com"],priority:1},creditcard:{name:"creditcard",regex:/\b(?:\d{4}[-\s]){3}\d{4}\b|\b\d{4}[-\s]\d{6}[-\s]\d{5}\b|\b\d{13,19}\b/g,description:"Credit card numbers (Visa, MC, Amex, Discover, etc.)",examples:["4532-1488-0343-6467","4532148803436467","5425 2334 3010 9903","3782 822463 10005"],priority:2},ssn:{name:"ssn",regex:/\b\d{3}-\d{2}-\d{4}\b|\b(?<!\d)\d{9}(?!\d)\b/g,description:"US Social Security Numbers",examples:["123-45-6789","987654321"],priority:3},iin:{name:"iin",regex:/\b[0-9]{2}(?:0[1-9]|1[0-2])(?:0[1-9]|[12][0-9]|3[01])\d{6}\b/g,description:"Kazakhstan IIN/BIN (12 digits with date validation)",examples:["950315300123","880612500456","021225123456"],priority:4},ip:{name:"ip",regex:/\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b|(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}\b/g,description:"IPv4 and IPv6 addresses",examples:["192.168.1.100","127.0.0.1","2001:0db8:85a3:0000:0000:8a2e:0370:7334"],priority:5},phone:{name:"phone",regex:/\+\d{1,3}[-.\s]\d{3}[-.\s]\d{4}\b|\+\d{1,3}[-.\s]\d{3}[-.\s]\d{3}[-.\s]\d{4}\b|\(\d{3}\)\s*\d{3}[-.\s]\d{4}\b|\b\d{3}[-.\s]\d{3}[-.\s]\d{4}\b/g,description:"International phone numbers",examples:["+1-555-1234","+1-555-123-4567","(555) 123-4567","555-123-4567","+7 777 123 4567"],priority:6},apikey:{name:"apikey",regex:/\b(?:sk|pk)_(?:live|test)_[a-zA-Z0-9]{24,}\b|AIza[a-zA-Z0-9_-]{35}|ya29\.[a-zA-Z0-9_-]+|AKIA[a-zA-Z0-9]{16}\b/g,description:"API keys (Stripe, Google, AWS, etc.)",examples:["sk_live_abc123def456ghi789jkl","pk_test_xyz789abc123def456","AIzaSyD1234567890abcdefghijklmnopqrst","AKIAIOSFODNN7EXAMPLE"],priority:7},token:{name:"token",regex:/\b(?:Bearer\s+)?[a-zA-Z0-9_-]{32,}\b|ghp_[a-zA-Z0-9]{36}|gho_[a-zA-Z0-9]{36}|github_pat_[a-zA-Z0-9_]{82}/g,description:"Authentication tokens (Bearer, GitHub, JWT-like)",examples:["Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9","ghp_abc123def456ghi789jkl012mno345pqr","gho_xyz789abc123def456ghi789jkl012mno"],priority:8},password:{name:"password",regex:/(?:password|passwd|pwd)[\s:=]+[^\s]{6,}|(?:password|passwd|pwd)["']?\s*[:=]\s*["']?[^\s"']{6,}/gi,description:"Password fields in text (password=..., pwd:...)",examples:["password: MySecret123!","passwd=SecurePass456",'pwd: "MyP@ssw0rd"'],priority:9}},rt={financial:["creditcard","ssn"],contact:["email","phone"],identification:["ssn","iin"],network:["ip","email"],credentials:["apikey","token","password"],kazakhstan:["iin"]};function ot(t){return it[t]}function st(t){return rt[t].map(t=>it[t])}class at{constructor(){this.pattern={}}name(t){return this.pattern.name=t,this}regex(t){if(t.global)this.pattern.regex=t;else{const e=t.flags.includes("g")?t.flags:t.flags+"g";this.pattern.regex=new RegExp(t.source,e)}return this}description(t){return this.pattern.description=t,this}examples(t){return this.pattern.examples=t,this}priority(t){return this.pattern.priority=t,this}build(){if(!this.pattern.name||!this.pattern.regex)throw new Error("Pattern must have at least name and regex");return{name:this.pattern.name,regex:this.pattern.regex,description:this.pattern.description||this.pattern.name,examples:this.pattern.examples||[],priority:this.pattern.priority??99}}}const ct={all:Object.keys(it),minimal:["email","creditcard","ssn"],financial:rt.financial,contact:rt.contact,identification:rt.identification,credentials:rt.credentials,kazakhstan:["email","phone","iin"],gdpr:["email","phone","ip"],pci:["creditcard"],security:["email","phone","creditcard","ssn","apikey","token","password"]};function lt(t){return("string"==typeof t?ct[t]:t).map(t=>it[t])}function dt(t){const e=[];if(t.name||e.push("Pattern must have a name"),t.regex){t.regex.global||e.push("Pattern regex must have global flag");try{const n="a".repeat(1e3),i=Date.now();n.match(t.regex);const r=Date.now()-i;r>100&&e.push(`Pattern regex may cause performance issues (took ${r}ms on test)`)}catch(t){e.push(`Pattern regex error: ${t.message}`)}}else e.push("Pattern must have a regex");return t.priority<0&&e.push("Pattern priority must be non-negative"),{valid:0===e.length,errors:e}}class ht{constructor(t,e){this.patterns=new Map,this.initializePatterns(t,e)}initializePatterns(t,e){let n;var i;n="string"==typeof t?ct[t]:t.filter(t=>"custom"!==t),(i=n.map(t=>it[t]),[...i].sort((t,e)=>t.priority-e.priority)).forEach(t=>{this.patterns.set(t.name,t.regex)}),e.forEach(t=>{this.patterns.set(t.name,t.regex)})}getPatterns(){return this.patterns}}class ut{constructor(t){this.patterns=t}sanitize(t){if("string"!=typeof t)return t;let e=t;return this.patterns.forEach((t,n)=>{const i=n.toUpperCase();e=e.replace(t,`[REDACTED-${i}]`)}),e}}class pt{constructor(t){this.stringSanitizer=t}sanitize(t){return null==t?t:"string"==typeof t?this.stringSanitizer.sanitize(t):Array.isArray(t)?t.map(t=>this.sanitize(t)):"object"==typeof t?this.sanitizeObject(t):t}sanitizeObject(t){const e={};for(const[n,i]of Object.entries(t))e[this.stringSanitizer.sanitize(n)]=this.sanitize(i);return e}}class gt{constructor(t){this.excludeSelectors=t}shouldExclude(t){return!(!t||!this.excludeSelectors.length)&&this.excludeSelectors.some(e=>{try{return t.matches(e)}catch{return!1}})}}class mt{constructor(t){if(this.enabled=t.enabled??!0,!this.enabled)return this.stringSanitizer=new ut(new Map),this.valueSanitizer=new pt(this.stringSanitizer),void(this.elementMatcher=new gt([]));const e=t.patterns??"all",n=t.customPatterns??[],i=t.excludeSelectors??[],r=new ht(e,n);this.stringSanitizer=new ut(r.getPatterns()),this.valueSanitizer=new pt(this.stringSanitizer),this.elementMatcher=new gt(i)}guardDisabled(t){return this.enabled?void 0:t}sanitize(t){const e=this.guardDisabled(t);return void 0!==e?e:this.valueSanitizer.sanitize(t)}sanitizeConsoleArgs(t){const e=this.guardDisabled(t);return void 0!==e?e:t.map(t=>this.sanitize(t))}sanitizeNetworkData(t){const e=this.guardDisabled(t);return void 0!==e?e:this.sanitize(t)}sanitizeError(t){const e=this.guardDisabled(t);return void 0!==e?e:this.sanitize(t)}shouldExclude(t){return!!this.enabled&&this.elementMatcher.shouldExclude(t)}sanitizeTextNode(t,e){const n=this.guardDisabled(t);return void 0!==n?n:this.elementMatcher.shouldExclude(e)?t:this.stringSanitizer.sanitize(t)}detectPII(t){const e=new Map;if(!this.enabled||!t)return e;for(const[n,i]of this.stringSanitizer.patterns){const r=t.match(new RegExp(i,"g"));r&&r.length>0&&e.set(n,r.length)}return e}}function ft(t){return new mt(t)}class yt{constructor(t){this.redactionCanvas=null,this.originalScreenshot="",this.styleElement=null,this.piiDetections=[],this.options=t,this.container=document.createElement("div"),this.shadow=this.container.attachShadow({mode:"open"}),this.styleManager=new $,this.templateManager=new X,this.domCache=new J,this.validator=new Q,this.piiDisplay=new tt,this.screenshotProcessor=new nt,this.handleEscapeKey=this.onEscapeKey.bind(this)}show(t){t&&(this.originalScreenshot=t),this.shadow.innerHTML=`\n      <style>\n        ${this.styleManager.generateStyles()}\n      </style>\n      ${this.templateManager.generateModalHTML(this.originalScreenshot)}\n    `,this.domCache.initialize(this.shadow);const e=this.domCache.get();e.titleError.style.display="none",e.descriptionError.style.display="none",this.setupRedactionCanvas(),this.attachEventListeners(),document.body.appendChild(this.container),e.titleInput.focus()}close(){document.removeEventListener("keydown",this.handleEscapeKey),this.redactionCanvas&&(this.redactionCanvas.destroy(),this.redactionCanvas=null),this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.domCache.clear(),this.options.onClose&&this.options.onClose()}destroy(){this.close()}setupRedactionCanvas(){const t=this.domCache.get();if(t.redactionCanvas&&t.screenshotImg)try{this.redactionCanvas=new et(t.redactionCanvas),this.redactionCanvas.initializeCanvas(t.screenshotImg)}catch(t){console.warn("Canvas redaction not available:",t),this.redactionCanvas=null}}attachEventListeners(){const t=this.domCache.get();t.closeButton.addEventListener("click",()=>this.close()),document.addEventListener("keydown",this.handleEscapeKey),t.form.addEventListener("submit",t=>this.handleSubmit(t)),t.submitButton.addEventListener("click",()=>{const e=new Event("submit",{bubbles:!0,cancelable:!0});t.form.dispatchEvent(e)}),t.cancelButton.addEventListener("click",()=>this.close()),t.titleInput.addEventListener("input",()=>this.validateField("title")),t.descriptionTextarea.addEventListener("input",()=>{this.validateField("description"),this.checkForPII()}),t.redactButton&&this.redactionCanvas&&t.redactButton.addEventListener("click",()=>this.toggleRedactionMode()),t.clearButton&&this.redactionCanvas&&t.clearButton.addEventListener("click",()=>this.clearRedactions()),t.piiConfirmCheckbox.addEventListener("change",()=>this.updateSubmitButton())}validateField(t){const e=this.domCache.get(),n="title"===t?e.titleInput.value:e.descriptionTextarea.value,i=this.validator.validateField(t,n),r="title"===t?e.titleError:e.descriptionError;i?(r.textContent=i,r.style.display="block"):(r.textContent="",r.style.display="none")}checkForPII(){const t=this.domCache.get(),e=`${t.titleInput.value} ${t.descriptionTextarea.value}`,n=ft({enabled:!0}).detectPII(e);this.piiDetections=Array.from(n.entries()).map(([t,e])=>({type:t,count:e})),this.piiDetections.length>0?(t.piiSection.style.display="block",this.piiDisplay.render(this.piiDetections,t.piiContent)):(t.piiSection.style.display="none",t.piiConfirmCheckbox.checked=!1),this.updateSubmitButton()}updateSubmitButton(){const t=this.domCache.get(),e=this.piiDetections.length>0,n=t.piiConfirmCheckbox.checked;t.submitButton.disabled=e&&!n}toggleRedactionMode(){const t=this.domCache.get();this.redactionCanvas&&t.redactButton&&(this.redactionCanvas.toggleRedactionMode()?(t.redactButton.classList.add("active"),t.redactButton.textContent="✓ Redacting..."):(t.redactButton.classList.remove("active"),t.redactButton.textContent="✏️ Redact Area"))}clearRedactions(){this.redactionCanvas&&this.redactionCanvas.clearRedactions()}async handleSubmit(t){t.preventDefault();const e=this.domCache.get(),n={title:e.titleInput.value,description:e.descriptionTextarea.value,piiDetected:this.piiDetections.length>0,piiConfirmed:e.piiConfirmCheckbox.checked},i=this.validator.validate(n);if(!i.isValid)return i.errors.title?(e.titleError.textContent=i.errors.title,e.titleError.style.display="block"):(e.titleError.textContent="",e.titleError.style.display="none"),i.errors.description?(e.descriptionError.textContent=i.errors.description,e.descriptionError.style.display="block"):(e.descriptionError.textContent="",e.descriptionError.style.display="none"),void(i.errors.piiConfirmation&&alert(i.errors.piiConfirmation));e.titleError.style.display="none",e.descriptionError.style.display="none";let r=this.originalScreenshot;if(this.redactionCanvas&&this.redactionCanvas.getRedactions().length>0)try{r=await this.screenshotProcessor.mergeRedactions(this.originalScreenshot,this.redactionCanvas.getCanvas())}catch(t){console.error("Failed to merge redactions:",t)}this.originalScreenshot=r;const o={title:n.title.trim(),description:n.description.trim()};try{await this.options.onSubmit(o),this.close()}catch(t){console.error("Error submitting bug report:",t),alert("Failed to submit bug report. Please try again.")}}getScreenshot(){return this.originalScreenshot}onEscapeKey(t){"Escape"===t.key&&this.close()}}var Ct;function It(t){var e=null==t?void 0:t.host;return Boolean((null==e?void 0:e.shadowRoot)===t)}function bt(t){return"[object ShadowRoot]"===Object.prototype.toString.call(t)}function vt(t){try{var e=t.rules||t.cssRules;return e?((n=Array.from(e).map(St).join("")).includes(" background-clip: text;")&&!n.includes(" -webkit-background-clip: text;")&&(n=n.replace(" background-clip: text;"," -webkit-background-clip: text; background-clip: text;")),n):null}catch(t){return null}var n}function St(t){var e=t.cssText;if(function(t){return"styleSheet"in t}(t))try{e=vt(t.styleSheet)||e}catch(t){}return e}!function(t){t[t.Document=0]="Document",t[t.DocumentType=1]="DocumentType",t[t.Element=2]="Element",t[t.Text=3]="Text",t[t.CDATA=4]="CDATA",t[t.Comment=5]="Comment"}(Ct||(Ct={}));var wt=function(){function t(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}return t.prototype.getId=function(t){var e;if(!t)return-1;var n=null===(e=this.getMeta(t))||void 0===e?void 0:e.id;return null!=n?n:-1},t.prototype.getNode=function(t){return this.idNodeMap.get(t)||null},t.prototype.getIds=function(){return Array.from(this.idNodeMap.keys())},t.prototype.getMeta=function(t){return this.nodeMetaMap.get(t)||null},t.prototype.removeNodeFromMap=function(t){var e=this,n=this.getId(t);this.idNodeMap.delete(n),t.childNodes&&t.childNodes.forEach(function(t){return e.removeNodeFromMap(t)})},t.prototype.has=function(t){return this.idNodeMap.has(t)},t.prototype.hasNode=function(t){return this.nodeMetaMap.has(t)},t.prototype.add=function(t,e){var n=e.id;this.idNodeMap.set(n,t),this.nodeMetaMap.set(t,e)},t.prototype.replace=function(t,e){var n=this.getNode(t);if(n){var i=this.nodeMetaMap.get(n);i&&this.nodeMetaMap.set(e,i)}this.idNodeMap.set(t,e)},t.prototype.reset=function(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap},t}();function At(t){var e=t.maskInputOptions,n=t.tagName,i=t.type,r=t.value,o=t.maskInputFn,s=r||"";return(e[n.toLowerCase()]||e[i])&&(s=o?o(s):"*".repeat(s.length)),s}var xt,kt,Mt="__rrweb_original__",Rt=1,Et=new RegExp("[^a-z0-9-_:]");function Tt(){return Rt++}var Nt=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,Lt=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/|#).*/,Dt=/^(data:)([^,]*),(.*)/i;function Ot(t,e){return(t||"").replace(Nt,function(t,n,i,r,o,s){var a,c=i||o||s,l=n||r||"";if(!c)return t;if(!Lt.test(c))return"url(".concat(l).concat(c).concat(l,")");if(Dt.test(c))return"url(".concat(l).concat(c).concat(l,")");if("/"===c[0])return"url(".concat(l).concat((a=e,(a.indexOf("//")>-1?a.split("/").slice(0,3).join("/"):a.split("/")[0]).split("?")[0]+c)).concat(l,")");var d=e.split("/"),h=c.split("/");d.pop();for(var u=0,p=h;u<p.length;u++){var g=p[u];"."!==g&&(".."===g?d.pop():d.push(g))}return"url(".concat(l).concat(d.join("/")).concat(l,")")})}var Ft=/^[^ \t\n\r\u000c]+/,Bt=/^[, \t\n\r\u000c]+/;function zt(t,e){if(!e||""===e.trim())return e;var n=t.createElement("a");return n.href=e,n.href}function Wt(){var t=document.createElement("a");return t.href="",t.href}function Ut(t,e,n,i){return"src"===n||"href"===n&&i&&("use"!==e||"#"!==i[0])||"xlink:href"===n&&i&&"#"!==i[0]?zt(t,i):"background"!==n||!i||"table"!==e&&"td"!==e&&"th"!==e?"srcset"===n&&i?function(t,e){if(""===e.trim())return e;var n=0;function i(t){var i,r=t.exec(e.substring(n));return r?(i=r[0],n+=i.length,i):""}for(var r=[];i(Bt),!(n>=e.length);){var o=i(Ft);if(","===o.slice(-1))o=zt(t,o.substring(0,o.length-1)),r.push(o);else{var s="";o=zt(t,o);for(var a=!1;;){var c=e.charAt(n);if(""===c){r.push((o+s).trim());break}if(a)")"===c&&(a=!1);else{if(","===c){n+=1,r.push((o+s).trim());break}"("===c&&(a=!0)}s+=c,n+=1}}}return r.join(", ")}(t,i):"style"===n&&i?Ot(i,Wt()):"object"===e&&"data"===n&&i?zt(t,i):i:zt(t,i)}function Pt(t,e,n){if(!t)return!1;if(t.nodeType!==t.ELEMENT_NODE)return!!n&&Pt(t.parentNode,e,n);for(var i=t.classList.length;i--;){var r=t.classList[i];if(e.test(r))return!0}return!!n&&Pt(t.parentNode,e,n)}function Vt(t,e,n){var i=t.nodeType===t.ELEMENT_NODE?t:t.parentElement;if(null===i)return!1;if("string"==typeof e){if(i.classList.contains(e))return!0;if(i.closest(".".concat(e)))return!0}else if(Pt(i,e,!0))return!0;if(n){if(i.matches(n))return!0;if(i.closest(n))return!0}return!1}function Zt(t){return void 0===t?"":t.toLowerCase()}function Gt(t,e){var n,i=e.doc,r=e.mirror,o=e.blockClass,s=e.blockSelector,a=e.maskTextClass,c=e.maskTextSelector,l=e.skipChild,d=void 0!==l&&l,h=e.inlineStylesheet,u=void 0===h||h,p=e.maskInputOptions,g=void 0===p?{}:p,m=e.maskTextFn,f=e.maskInputFn,y=e.slimDOMOptions,C=e.dataURLOptions,I=void 0===C?{}:C,b=e.inlineImages,v=void 0!==b&&b,S=e.recordCanvas,w=void 0!==S&&S,A=e.onSerialize,x=e.onIframeLoad,k=e.iframeLoadTimeout,M=void 0===k?5e3:k,R=e.onStylesheetLoad,E=e.stylesheetLoadTimeout,T=void 0===E?5e3:E,N=e.keepIframeSrcFn,L=void 0===N?function(){return!1}:N,D=e.newlyAddedElement,O=void 0!==D&&D,F=e.preserveWhiteSpace,B=void 0===F||F,z=function(t,e){var n=e.doc,i=e.mirror,r=e.blockClass,o=e.blockSelector,s=e.maskTextClass,a=e.maskTextSelector,c=e.inlineStylesheet,l=e.maskInputOptions,d=void 0===l?{}:l,h=e.maskTextFn,u=e.maskInputFn,p=e.dataURLOptions,g=void 0===p?{}:p,m=e.inlineImages,f=e.recordCanvas,y=e.keepIframeSrcFn,C=e.newlyAddedElement,I=void 0!==C&&C,b=function(t,e){if(e.hasNode(t)){var n=e.getId(t);return 1===n?void 0:n}}(n,i);switch(t.nodeType){case t.DOCUMENT_NODE:return"CSS1Compat"!==t.compatMode?{type:Ct.Document,childNodes:[],compatMode:t.compatMode}:{type:Ct.Document,childNodes:[]};case t.DOCUMENT_TYPE_NODE:return{type:Ct.DocumentType,name:t.name,publicId:t.publicId,systemId:t.systemId,rootId:b};case t.ELEMENT_NODE:return function(t,e){for(var n=e.doc,i=e.inlineStylesheet,r=e.maskInputOptions,o=void 0===r?{}:r,s=e.maskInputFn,a=e.dataURLOptions,c=void 0===a?{}:a,l=e.inlineImages,d=e.recordCanvas,h=e.keepIframeSrcFn,u=e.newlyAddedElement,p=void 0!==u&&u,g=e.rootId,m=function(t,e,n){if("string"==typeof e){if(t.classList.contains(e))return!0}else for(var i=t.classList.length;i--;){var r=t.classList[i];if(e.test(r))return!0}return!!n&&t.matches(n)}(t,e.blockClass,e.blockSelector),f=function(t){if(t instanceof HTMLFormElement)return"form";var e=t.tagName.toLowerCase().trim();return Et.test(e)?"div":e}(t),y={},C=t.attributes.length,I=0;I<C;I++){var b=t.attributes[I];y[b.name]=Ut(n,f,b.name,b.value)}if("link"===f&&i){var v=Array.from(n.styleSheets).find(function(e){return e.href===t.href}),S=null;v&&(S=vt(v)),S&&(delete y.rel,delete y.href,y._cssText=Ot(S,v.href))}if("style"===f&&t.sheet&&!(t.innerText||t.textContent||"").trim().length&&(S=vt(t.sheet))&&(y._cssText=Ot(S,Wt())),"input"===f||"textarea"===f||"select"===f){var w=t.value,A=t.checked;"radio"!==y.type&&"checkbox"!==y.type&&"submit"!==y.type&&"button"!==y.type&&w?y.value=At({type:y.type,tagName:f,value:w,maskInputOptions:o,maskInputFn:s}):A&&(y.checked=A)}if("option"===f&&(t.selected&&!o.select?y.selected=!0:delete y.selected),"canvas"===f&&d)if("2d"===t.__context)(function(t){var e=t.getContext("2d");if(!e)return!0;for(var n=0;n<t.width;n+=50)for(var i=0;i<t.height;i+=50){var r=e.getImageData,o=Mt in r?r[Mt]:r;if(new Uint32Array(o.call(e,n,i,Math.min(50,t.width-n),Math.min(50,t.height-i)).data.buffer).some(function(t){return 0!==t}))return!1}return!0})(t)||(y.rr_dataURL=t.toDataURL(c.type,c.quality));else if(!("__context"in t)){var x=t.toDataURL(c.type,c.quality),k=document.createElement("canvas");k.width=t.width,k.height=t.height,x!==k.toDataURL(c.type,c.quality)&&(y.rr_dataURL=x)}if("img"===f&&l){xt||(xt=n.createElement("canvas"),kt=xt.getContext("2d"));var M=t,R=M.crossOrigin;M.crossOrigin="anonymous";var E=function(){try{xt.width=M.naturalWidth,xt.height=M.naturalHeight,kt.drawImage(M,0,0),y.rr_dataURL=xt.toDataURL(c.type,c.quality)}catch(t){console.warn("Cannot inline img src=".concat(M.currentSrc,"! Error: ").concat(t))}R?y.crossOrigin=R:M.removeAttribute("crossorigin")};M.complete&&0!==M.naturalWidth?E():M.onload=E}if("audio"!==f&&"video"!==f||(y.rr_mediaState=t.paused?"paused":"played",y.rr_mediaCurrentTime=t.currentTime),p||(t.scrollLeft&&(y.rr_scrollLeft=t.scrollLeft),t.scrollTop&&(y.rr_scrollTop=t.scrollTop)),m){var T=t.getBoundingClientRect(),N=T.width,L=T.height;y={class:y.class,rr_width:"".concat(N,"px"),rr_height:"".concat(L,"px")}}return"iframe"!==f||h(y.src)||(t.contentDocument||(y.rr_src=y.src),delete y.src),{type:Ct.Element,tagName:f,attributes:y,childNodes:[],isSVG:(D=t,Boolean("svg"===D.tagName||D.ownerSVGElement)||void 0),needBlock:m,rootId:g};var D}(t,{doc:n,blockClass:r,blockSelector:o,inlineStylesheet:c,maskInputOptions:d,maskInputFn:u,dataURLOptions:g,inlineImages:m,recordCanvas:f,keepIframeSrcFn:y,newlyAddedElement:I,rootId:b});case t.TEXT_NODE:return function(t,e){var n,i,r=e.maskTextClass,o=e.maskTextSelector,s=e.maskTextFn,a=e.rootId,c=t.parentNode&&t.parentNode.tagName,l=t.textContent,d="STYLE"===c||void 0,h="SCRIPT"===c||void 0;if(d&&l){try{t.nextSibling||t.previousSibling||(null===(n=t.parentNode.sheet)||void 0===n?void 0:n.cssRules)&&(l=(i=t.parentNode.sheet).cssRules?Array.from(i.cssRules).map(function(t){return t.cssText||""}).join(""):"")}catch(e){console.warn("Cannot get CSS styles from text's parentNode. Error: ".concat(e),t)}l=Ot(l,Wt())}return h&&(l="SCRIPT_PLACEHOLDER"),!d&&!h&&l&&Vt(t,r,o)&&(l=s?s(l):l.replace(/[\S]/g,"*")),{type:Ct.Text,textContent:l||"",isStyle:d,rootId:a}}(t,{maskTextClass:s,maskTextSelector:a,maskTextFn:h,rootId:b});case t.CDATA_SECTION_NODE:return{type:Ct.CDATA,textContent:"",rootId:b};case t.COMMENT_NODE:return{type:Ct.Comment,textContent:t.textContent||"",rootId:b};default:return!1}}(t,{doc:i,mirror:r,blockClass:o,blockSelector:s,maskTextClass:a,maskTextSelector:c,inlineStylesheet:u,maskInputOptions:g,maskTextFn:m,maskInputFn:f,dataURLOptions:I,inlineImages:v,recordCanvas:w,keepIframeSrcFn:L,newlyAddedElement:O});if(!z)return console.warn(t,"not serialized"),null;n=r.hasNode(t)?r.getId(t):!function(t,e){if(e.comment&&t.type===Ct.Comment)return!0;if(t.type===Ct.Element){if(e.script&&("script"===t.tagName||"link"===t.tagName&&"preload"===t.attributes.rel&&"script"===t.attributes.as||"link"===t.tagName&&"prefetch"===t.attributes.rel&&"string"==typeof t.attributes.href&&t.attributes.href.endsWith(".js")))return!0;if(e.headFavicon&&("link"===t.tagName&&"shortcut icon"===t.attributes.rel||"meta"===t.tagName&&(Zt(t.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===Zt(t.attributes.name)||"icon"===Zt(t.attributes.rel)||"apple-touch-icon"===Zt(t.attributes.rel)||"shortcut icon"===Zt(t.attributes.rel))))return!0;if("meta"===t.tagName){if(e.headMetaDescKeywords&&Zt(t.attributes.name).match(/^description|keywords$/))return!0;if(e.headMetaSocial&&(Zt(t.attributes.property).match(/^(og|twitter|fb):/)||Zt(t.attributes.name).match(/^(og|twitter):/)||"pinterest"===Zt(t.attributes.name)))return!0;if(e.headMetaRobots&&("robots"===Zt(t.attributes.name)||"googlebot"===Zt(t.attributes.name)||"bingbot"===Zt(t.attributes.name)))return!0;if(e.headMetaHttpEquiv&&void 0!==t.attributes["http-equiv"])return!0;if(e.headMetaAuthorship&&("author"===Zt(t.attributes.name)||"generator"===Zt(t.attributes.name)||"framework"===Zt(t.attributes.name)||"publisher"===Zt(t.attributes.name)||"progid"===Zt(t.attributes.name)||Zt(t.attributes.property).match(/^article:/)||Zt(t.attributes.property).match(/^product:/)))return!0;if(e.headMetaVerification&&("google-site-verification"===Zt(t.attributes.name)||"yandex-verification"===Zt(t.attributes.name)||"csrf-token"===Zt(t.attributes.name)||"p:domain_verify"===Zt(t.attributes.name)||"verify-v1"===Zt(t.attributes.name)||"verification"===Zt(t.attributes.name)||"shopify-checkout-api-token"===Zt(t.attributes.name)))return!0}}return!1}(z,y)&&(B||z.type!==Ct.Text||z.isStyle||z.textContent.replace(/^\s+|\s+$/gm,"").length)?Tt():-2;var W=Object.assign(z,{id:n});if(r.add(t,W),-2===n)return null;A&&A(t);var U=!d;if(W.type===Ct.Element){U=U&&!W.needBlock,delete W.needBlock;var P=t.shadowRoot;P&&bt(P)&&(W.isShadowHost=!0)}if((W.type===Ct.Document||W.type===Ct.Element)&&U){y.headWhitespace&&W.type===Ct.Element&&"head"===W.tagName&&(B=!1);for(var V={doc:i,mirror:r,blockClass:o,blockSelector:s,maskTextClass:a,maskTextSelector:c,skipChild:d,inlineStylesheet:u,maskInputOptions:g,maskTextFn:m,maskInputFn:f,slimDOMOptions:y,dataURLOptions:I,inlineImages:v,recordCanvas:w,preserveWhiteSpace:B,onSerialize:A,onIframeLoad:x,iframeLoadTimeout:M,onStylesheetLoad:R,stylesheetLoadTimeout:T,keepIframeSrcFn:L},Z=0,G=Array.from(t.childNodes);Z<G.length;Z++)(K=Gt(G[Z],V))&&W.childNodes.push(K);if(function(t){return t.nodeType===t.ELEMENT_NODE}(t)&&t.shadowRoot)for(var H=0,q=Array.from(t.shadowRoot.childNodes);H<q.length;H++){var K;(K=Gt(q[H],V))&&(bt(t.shadowRoot)&&(K.isShadow=!0),W.childNodes.push(K))}}return t.parentNode&&It(t.parentNode)&&bt(t.parentNode)&&(W.isShadow=!0),W.type===Ct.Element&&"iframe"===W.tagName&&function(t,e,n){var i=t.contentWindow;if(i){var r,o=!1;try{r=i.document.readyState}catch(t){return}if("complete"===r){var s="about:blank";if(i.location.href!==s||t.src===s||""===t.src)return setTimeout(e,0),t.addEventListener("load",e);t.addEventListener("load",e)}else{var a=setTimeout(function(){o||(e(),o=!0)},n);t.addEventListener("load",function(){clearTimeout(a),o=!0,e()})}}}(t,function(){var e=t.contentDocument;if(e&&x){var n=Gt(e,{doc:e,mirror:r,blockClass:o,blockSelector:s,maskTextClass:a,maskTextSelector:c,skipChild:!1,inlineStylesheet:u,maskInputOptions:g,maskTextFn:m,maskInputFn:f,slimDOMOptions:y,dataURLOptions:I,inlineImages:v,recordCanvas:w,preserveWhiteSpace:B,onSerialize:A,onIframeLoad:x,iframeLoadTimeout:M,onStylesheetLoad:R,stylesheetLoadTimeout:T,keepIframeSrcFn:L});n&&x(t,n)}},M),W.type===Ct.Element&&"link"===W.tagName&&"stylesheet"===W.attributes.rel&&function(t,e,n){var i,r=!1;try{i=t.sheet}catch(t){return}if(!i){var o=setTimeout(function(){r||(e(),r=!0)},n);t.addEventListener("load",function(){clearTimeout(o),r=!0,e()})}}(t,function(){if(R){var e=Gt(t,{doc:i,mirror:r,blockClass:o,blockSelector:s,maskTextClass:a,maskTextSelector:c,skipChild:!1,inlineStylesheet:u,maskInputOptions:g,maskTextFn:m,maskInputFn:f,slimDOMOptions:y,dataURLOptions:I,inlineImages:v,recordCanvas:w,preserveWhiteSpace:B,onSerialize:A,onIframeLoad:x,iframeLoadTimeout:M,onStylesheetLoad:R,stylesheetLoadTimeout:T,keepIframeSrcFn:L});e&&R(t,e)}},T),W}function Ht(t,e,n=document){const i={capture:!0,passive:!0};return n.addEventListener(t,e,i),()=>n.removeEventListener(t,e,i)}new RegExp(/([^\\]):hover/.source,"g");const qt="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.";let Kt={map:{},getId:()=>(console.error(qt),-1),getNode:()=>(console.error(qt),null),removeNodeFromMap(){console.error(qt)},has:()=>(console.error(qt),!1),reset(){console.error(qt)}};function _t(t,e,n={}){let i=null,r=0;return function(...o){const s=Date.now();r||!1!==n.leading||(r=s);const a=e-(s-r),c=this;a<=0||a>e?(i&&(clearTimeout(i),i=null),r=s,t.apply(c,o)):i||!1===n.trailing||(i=setTimeout(()=>{r=!1===n.leading?0:Date.now(),i=null,t.apply(c,o)},a))}}function jt(t,e,n,i,r=window){const o=r.Object.getOwnPropertyDescriptor(t,e);return r.Object.defineProperty(t,e,i?n:{set(t){setTimeout(()=>{n.set.call(this,t)},0),o&&o.set&&o.set.call(this,t)}}),()=>jt(t,e,o||{},!0)}function Yt(t,e,n){try{if(!(e in t))return()=>{};const i=t[e],r=n(i);return"function"==typeof r&&(r.prototype=r.prototype||{},Object.defineProperties(r,{__rrweb_original__:{enumerable:!1,value:i}})),t[e]=r,()=>{t[e]=i}}catch(t){return()=>{}}}function $t(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function Xt(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function Jt(t,e,n,i){if(!t)return!1;const r=t.nodeType===t.ELEMENT_NODE?t:t.parentElement;if(!r)return!1;if("string"==typeof e){if(r.classList.contains(e))return!0;if(i&&null!==r.closest("."+e))return!0}else if(Pt(r,e,i))return!0;if(n){if(t.matches(n))return!0;if(i&&null!==r.closest(n))return!0}return!1}function Qt(t,e){return-2===e.getId(t)}function te(t,e){if(It(t))return!1;const n=e.getId(t);return!e.has(n)||(!t.parentNode||t.parentNode.nodeType!==t.DOCUMENT_NODE)&&(!t.parentNode||te(t.parentNode,e))}function ee(t){return Boolean(t.changedTouches)}function ne(t,e){return Boolean("IFRAME"===t.nodeName&&e.getMeta(t))}function ie(t,e){return Boolean("LINK"===t.nodeName&&t.nodeType===t.ELEMENT_NODE&&t.getAttribute&&"stylesheet"===t.getAttribute("rel")&&e.getMeta(t))}function re(t){return Boolean(null==t?void 0:t.shadowRoot)}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(Kt=new Proxy(Kt,{get:(t,e,n)=>("map"===e&&console.error(qt),Reflect.get(t,e,n))}));class oe{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(t){var e;return null!==(e=this.styleIDMap.get(t))&&void 0!==e?e:-1}has(t){return this.styleIDMap.has(t)}add(t,e){if(this.has(t))return this.getId(t);let n;return n=void 0===e?this.id++:e,this.styleIDMap.set(t,n),this.idStyleMap.set(n,t),n}getStyle(t){return this.idStyleMap.get(t)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}}var se=(t=>(t[t.DomContentLoaded=0]="DomContentLoaded",t[t.Load=1]="Load",t[t.FullSnapshot=2]="FullSnapshot",t[t.IncrementalSnapshot=3]="IncrementalSnapshot",t[t.Meta=4]="Meta",t[t.Custom=5]="Custom",t[t.Plugin=6]="Plugin",t))(se||{}),ae=(t=>(t[t.Mutation=0]="Mutation",t[t.MouseMove=1]="MouseMove",t[t.MouseInteraction=2]="MouseInteraction",t[t.Scroll=3]="Scroll",t[t.ViewportResize=4]="ViewportResize",t[t.Input=5]="Input",t[t.TouchMove=6]="TouchMove",t[t.MediaInteraction=7]="MediaInteraction",t[t.StyleSheetRule=8]="StyleSheetRule",t[t.CanvasMutation=9]="CanvasMutation",t[t.Font=10]="Font",t[t.Log=11]="Log",t[t.Drag=12]="Drag",t[t.StyleDeclaration=13]="StyleDeclaration",t[t.Selection=14]="Selection",t[t.AdoptedStyleSheet=15]="AdoptedStyleSheet",t))(ae||{}),ce=(t=>(t[t.MouseUp=0]="MouseUp",t[t.MouseDown=1]="MouseDown",t[t.Click=2]="Click",t[t.ContextMenu=3]="ContextMenu",t[t.DblClick=4]="DblClick",t[t.Focus=5]="Focus",t[t.Blur=6]="Blur",t[t.TouchStart=7]="TouchStart",t[t.TouchMove_Departed=8]="TouchMove_Departed",t[t.TouchEnd=9]="TouchEnd",t[t.TouchCancel=10]="TouchCancel",t))(ce||{}),le=(t=>(t[t["2D"]=0]="2D",t[t.WebGL=1]="WebGL",t[t.WebGL2=2]="WebGL2",t))(le||{});function de(t){return"__ln"in t}class he{constructor(){this.length=0,this.head=null}get(t){if(t>=this.length)throw new Error("Position outside of list range");let e=this.head;for(let n=0;n<t;n++)e=(null==e?void 0:e.next)||null;return e}addNode(t){const e={value:t,previous:null,next:null};if(t.__ln=e,t.previousSibling&&de(t.previousSibling)){const n=t.previousSibling.__ln.next;e.next=n,e.previous=t.previousSibling.__ln,t.previousSibling.__ln.next=e,n&&(n.previous=e)}else if(t.nextSibling&&de(t.nextSibling)&&t.nextSibling.__ln.previous){const n=t.nextSibling.__ln.previous;e.previous=n,e.next=t.nextSibling.__ln,t.nextSibling.__ln.previous=e,n&&(n.next=e)}else this.head&&(this.head.previous=e),e.next=this.head,this.head=e;this.length++}removeNode(t){const e=t.__ln;this.head&&(e.previous?(e.previous.next=e.next,e.next&&(e.next.previous=e.previous)):(this.head=e.next,this.head&&(this.head.previous=null)),t.__ln&&delete t.__ln,this.length--)}}const ue=(t,e)=>`${t}@${e}`;class pe{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=t=>{t.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;const t=[],e=new he,n=t=>{let e=t,n=-2;for(;-2===n;)e=e&&e.nextSibling,n=e&&this.mirror.getId(e);return n},i=i=>{var r,o,s,a;let c=null;(null===(o=null===(r=i.getRootNode)||void 0===r?void 0:r.call(i))||void 0===o?void 0:o.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&i.getRootNode().host&&(c=i.getRootNode().host);let l=c;for(;(null===(a=null===(s=null==l?void 0:l.getRootNode)||void 0===s?void 0:s.call(l))||void 0===a?void 0:a.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&l.getRootNode().host;)l=l.getRootNode().host;const d=!(this.doc.contains(i)||l&&this.doc.contains(l));if(!i.parentNode||d)return;const h=It(i.parentNode)?this.mirror.getId(c):this.mirror.getId(i.parentNode),u=n(i);if(-1===h||-1===u)return e.addNode(i);const p=Gt(i,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskTextClass:this.maskTextClass,maskTextSelector:this.maskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:t=>{ne(t,this.mirror)&&this.iframeManager.addIframe(t),ie(t,this.mirror)&&this.stylesheetManager.trackLinkElement(t),re(i)&&this.shadowDomManager.addShadowRoot(i.shadowRoot,this.doc)},onIframeLoad:(t,e)=>{this.iframeManager.attachIframe(t,e),this.shadowDomManager.observeAttachShadow(t)},onStylesheetLoad:(t,e)=>{this.stylesheetManager.attachLinkElement(t,e)}});p&&t.push({parentId:h,nextId:u,node:p})};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const t of Array.from(this.movedSet.values()))me(this.removes,t,this.mirror)&&!this.movedSet.has(t.parentNode)||i(t);for(const t of Array.from(this.addedSet.values()))ye(this.droppedSet,t)||me(this.removes,t,this.mirror)?ye(this.movedSet,t)?i(t):this.droppedSet.add(t):i(t);let r=null;for(;e.length;){let t=null;if(r){const e=this.mirror.getId(r.value.parentNode),i=n(r.value);-1!==e&&-1!==i&&(t=r)}if(!t)for(let i=e.length-1;i>=0;i--){const r=e.get(i);if(r){const e=this.mirror.getId(r.value.parentNode);if(-1===n(r.value))continue;if(-1!==e){t=r;break}{const e=r.value;if(e.parentNode&&e.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const n=e.parentNode.host;if(-1!==this.mirror.getId(n)){t=r;break}}}}}if(!t){for(;e.head;)e.removeNode(e.head.value);break}r=t.previous,e.removeNode(t.value),i(t.value)}const o={texts:this.texts.map(t=>({id:this.mirror.getId(t.node),value:t.value})).filter(t=>this.mirror.has(t.id)),attributes:this.attributes.map(t=>({id:this.mirror.getId(t.node),attributes:t.attributes})).filter(t=>this.mirror.has(t.id)),removes:this.removes,adds:t};(o.texts.length||o.attributes.length||o.removes.length||o.adds.length)&&(this.texts=[],this.attributes=[],this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(o))},this.processMutation=t=>{if(!Qt(t.target,this.mirror))switch(t.type){case"characterData":{const e=t.target.textContent;Jt(t.target,this.blockClass,this.blockSelector,!1)||e===t.oldValue||this.texts.push({value:Vt(t.target,this.maskTextClass,this.maskTextSelector)&&e?this.maskTextFn?this.maskTextFn(e):e.replace(/[\S]/g,"*"):e,node:t.target});break}case"attributes":{const e=t.target;let n=t.target.getAttribute(t.attributeName);if("value"===t.attributeName&&(n=At({maskInputOptions:this.maskInputOptions,tagName:t.target.tagName,type:t.target.getAttribute("type"),value:n,maskInputFn:this.maskInputFn})),Jt(t.target,this.blockClass,this.blockSelector,!1)||n===t.oldValue)return;let i=this.attributes.find(e=>e.node===t.target);if("IFRAME"===e.tagName&&"src"===t.attributeName&&!this.keepIframeSrcFn(n)){if(e.contentDocument)return;t.attributeName="rr_src"}if(i||(i={node:t.target,attributes:{}},this.attributes.push(i)),"style"===t.attributeName){const n=this.doc.createElement("span");t.oldValue&&n.setAttribute("style",t.oldValue),void 0!==i.attributes.style&&null!==i.attributes.style||(i.attributes.style={});const r=i.attributes.style;for(const t of Array.from(e.style)){const i=e.style.getPropertyValue(t),o=e.style.getPropertyPriority(t);i===n.style.getPropertyValue(t)&&o===n.style.getPropertyPriority(t)||(r[t]=""===o?i:[i,o])}for(const t of Array.from(n.style))""===e.style.getPropertyValue(t)&&(r[t]=!1)}else i.attributes[t.attributeName]=Ut(this.doc,e.tagName,t.attributeName,n);break}case"childList":if(Jt(t.target,this.blockClass,this.blockSelector,!0))return;t.addedNodes.forEach(e=>this.genAdds(e,t.target)),t.removedNodes.forEach(e=>{const n=this.mirror.getId(e),i=It(t.target)?this.mirror.getId(t.target.host):this.mirror.getId(t.target);Jt(t.target,this.blockClass,this.blockSelector,!1)||Qt(e,this.mirror)||!function(t,e){return-1!==e.getId(t)}(e,this.mirror)||(this.addedSet.has(e)?(ge(this.addedSet,e),this.droppedSet.add(e)):this.addedSet.has(t.target)&&-1===n||te(t.target,this.mirror)||(this.movedSet.has(e)&&this.movedMap[ue(n,i)]?ge(this.movedSet,e):this.removes.push({parentId:i,id:n,isShadow:!(!It(t.target)||!bt(t.target))||void 0})),this.mapRemoves.push(e))})}},this.genAdds=(t,e)=>{if(this.mirror.hasNode(t)){if(Qt(t,this.mirror))return;this.movedSet.add(t);let n=null;e&&this.mirror.hasNode(e)&&(n=this.mirror.getId(e)),n&&-1!==n&&(this.movedMap[ue(this.mirror.getId(t),n)]=!0)}else this.addedSet.add(t),this.droppedSet.delete(t);Jt(t,this.blockClass,this.blockSelector,!1)||t.childNodes.forEach(t=>this.genAdds(t))}}init(t){["mutationCb","blockClass","blockSelector","maskTextClass","maskTextSelector","inlineStylesheet","maskInputOptions","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager"].forEach(e=>{this[e]=t[e]})}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}}function ge(t,e){t.delete(e),e.childNodes.forEach(e=>ge(t,e))}function me(t,e,n){return 0!==t.length&&fe(t,e,n)}function fe(t,e,n){const{parentNode:i}=e;if(!i)return!1;const r=n.getId(i);return!!t.some(t=>t.id===r)||fe(t,i,n)}function ye(t,e){return 0!==t.size&&Ce(t,e)}function Ce(t,e){const{parentNode:n}=e;return!!n&&(!!t.has(n)||Ce(t,n))}const Ie=[],be="undefined"!=typeof CSSGroupingRule,ve="undefined"!=typeof CSSMediaRule,Se="undefined"!=typeof CSSSupportsRule,we="undefined"!=typeof CSSConditionRule;function Ae(t){try{if("composedPath"in t){const e=t.composedPath();if(e.length)return e[0]}else if("path"in t&&t.path.length)return t.path[0];return t.target}catch(e){return t.target}}function xe(t,e){var n,i;const r=new pe;Ie.push(r),r.init(t);let o=window.MutationObserver||window.__rrMutationObserver;const s=null===(i=null===(n=null===window||void 0===window?void 0:window.Zone)||void 0===n?void 0:n.__symbol__)||void 0===i?void 0:i.call(n,"MutationObserver");s&&window[s]&&(o=window[s]);const a=new o(r.processMutations.bind(r));return a.observe(e,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),a}function ke({scrollCb:t,doc:e,mirror:n,blockClass:i,blockSelector:r,sampling:o}){return Ht("scroll",_t(o=>{const s=Ae(o);if(!s||Jt(s,i,r,!0))return;const a=n.getId(s);if(s===e){const n=e.scrollingElement||e.documentElement;t({id:a,x:n.scrollLeft,y:n.scrollTop})}else t({id:a,x:s.scrollLeft,y:s.scrollTop})},o.scroll||100),e)}function Me(t,e){const n=Object.assign({},t);return e||delete n.userTriggered,n}const Re=["INPUT","TEXTAREA","SELECT"],Ee=new WeakMap;function Te(t){return function(t,e){if(be&&t.parentRule instanceof CSSGroupingRule||ve&&t.parentRule instanceof CSSMediaRule||Se&&t.parentRule instanceof CSSSupportsRule||we&&t.parentRule instanceof CSSConditionRule){const n=Array.from(t.parentRule.cssRules).indexOf(t);e.unshift(n)}else if(t.parentStyleSheet){const n=Array.from(t.parentStyleSheet.cssRules).indexOf(t);e.unshift(n)}return e}(t,[])}function Ne(t,e,n){let i,r;return t?(t.ownerNode?i=e.getId(t.ownerNode):r=n.getId(t),{styleId:r,id:i}):{}}function Le({mirror:t,stylesheetManager:e},n){var i,r,o;let s=null;s="#document"===n.nodeName?t.getId(n):t.getId(n.host);const a="#document"===n.nodeName?null===(i=n.defaultView)||void 0===i?void 0:i.Document:null===(o=null===(r=n.ownerDocument)||void 0===r?void 0:r.defaultView)||void 0===o?void 0:o.ShadowRoot,c=Object.getOwnPropertyDescriptor(null==a?void 0:a.prototype,"adoptedStyleSheets");return null!==s&&-1!==s&&a&&c?(Object.defineProperty(n,"adoptedStyleSheets",{configurable:c.configurable,enumerable:c.enumerable,get(){var t;return null===(t=c.get)||void 0===t?void 0:t.call(this)},set(t){var n;const i=null===(n=c.set)||void 0===n?void 0:n.call(this,t);if(null!==s&&-1!==s)try{e.adoptStyleSheets(t,s)}catch(t){}return i}}),()=>{Object.defineProperty(n,"adoptedStyleSheets",{configurable:c.configurable,enumerable:c.enumerable,get:c.get,set:c.set})}):()=>{}}function De(t,e={}){const n=t.doc.defaultView;if(!n)return()=>{};!function(t,e){const{mutationCb:n,mousemoveCb:i,mouseInteractionCb:r,scrollCb:o,viewportResizeCb:s,inputCb:a,mediaInteractionCb:c,styleSheetRuleCb:l,styleDeclarationCb:d,canvasMutationCb:h,fontCb:u,selectionCb:p}=t;t.mutationCb=(...t)=>{e.mutation&&e.mutation(...t),n(...t)},t.mousemoveCb=(...t)=>{e.mousemove&&e.mousemove(...t),i(...t)},t.mouseInteractionCb=(...t)=>{e.mouseInteraction&&e.mouseInteraction(...t),r(...t)},t.scrollCb=(...t)=>{e.scroll&&e.scroll(...t),o(...t)},t.viewportResizeCb=(...t)=>{e.viewportResize&&e.viewportResize(...t),s(...t)},t.inputCb=(...t)=>{e.input&&e.input(...t),a(...t)},t.mediaInteractionCb=(...t)=>{e.mediaInteaction&&e.mediaInteaction(...t),c(...t)},t.styleSheetRuleCb=(...t)=>{e.styleSheetRule&&e.styleSheetRule(...t),l(...t)},t.styleDeclarationCb=(...t)=>{e.styleDeclaration&&e.styleDeclaration(...t),d(...t)},t.canvasMutationCb=(...t)=>{e.canvasMutation&&e.canvasMutation(...t),h(...t)},t.fontCb=(...t)=>{e.font&&e.font(...t),u(...t)},t.selectionCb=(...t)=>{e.selection&&e.selection(...t),p(...t)}}(t,e);const i=xe(t,t.doc),r=function({mousemoveCb:t,sampling:e,doc:n,mirror:i}){if(!1===e.mousemove)return()=>{};const r="number"==typeof e.mousemove?e.mousemove:50,o="number"==typeof e.mousemoveCallback?e.mousemoveCallback:500;let s,a=[];const c=_t(e=>{const n=Date.now()-s;t(a.map(t=>(t.timeOffset-=n,t)),e),a=[],s=null},o),l=_t(t=>{const e=Ae(t),{clientX:n,clientY:r}=ee(t)?t.changedTouches[0]:t;s||(s=Date.now()),a.push({x:n,y:r,id:i.getId(e),timeOffset:Date.now()-s}),c("undefined"!=typeof DragEvent&&t instanceof DragEvent?ae.Drag:t instanceof MouseEvent?ae.MouseMove:ae.TouchMove)},r,{trailing:!1}),d=[Ht("mousemove",l,n),Ht("touchmove",l,n),Ht("drag",l,n)];return()=>{d.forEach(t=>t())}}(t),o=function({mouseInteractionCb:t,doc:e,mirror:n,blockClass:i,blockSelector:r,sampling:o}){if(!1===o.mouseInteraction)return()=>{};const s=!0===o.mouseInteraction||void 0===o.mouseInteraction?{}:o.mouseInteraction,a=[];return Object.keys(ce).filter(t=>Number.isNaN(Number(t))&&!t.endsWith("_Departed")&&!1!==s[t]).forEach(o=>{const s=o.toLowerCase(),c=(e=>o=>{const s=Ae(o);if(Jt(s,i,r,!0))return;const a=ee(o)?o.changedTouches[0]:o;if(!a)return;const c=n.getId(s),{clientX:l,clientY:d}=a;t({type:ce[e],id:c,x:l,y:d})})(o);a.push(Ht(s,c,e))}),()=>{a.forEach(t=>t())}}(t),s=ke(t),a=function({viewportResizeCb:t}){let e=-1,n=-1;return Ht("resize",_t(()=>{const i=$t(),r=Xt();e===i&&n===r||(t({width:Number(r),height:Number(i)}),e=i,n=r)},200),window)}(t),c=function({inputCb:t,doc:e,mirror:n,blockClass:i,blockSelector:r,ignoreClass:o,maskInputOptions:s,maskInputFn:a,sampling:c,userTriggeredOnInput:l}){function d(t){let n=Ae(t);const c=t.isTrusted;if(n&&"OPTION"===n.tagName&&(n=n.parentElement),!n||!n.tagName||Re.indexOf(n.tagName)<0||Jt(n,i,r,!0))return;const d=n.type;if(n.classList.contains(o))return;let u=n.value,p=!1;"radio"===d||"checkbox"===d?p=n.checked:(s[n.tagName.toLowerCase()]||s[d])&&(u=At({maskInputOptions:s,tagName:n.tagName,type:d,value:u,maskInputFn:a})),h(n,Me({text:u,isChecked:p,userTriggered:c},l));const g=n.name;"radio"===d&&g&&p&&e.querySelectorAll(`input[type="radio"][name="${g}"]`).forEach(t=>{t!==n&&h(t,Me({text:t.value,isChecked:!p,userTriggered:!1},l))})}function h(e,i){const r=Ee.get(e);if(!r||r.text!==i.text||r.isChecked!==i.isChecked){Ee.set(e,i);const r=n.getId(e);t(Object.assign(Object.assign({},i),{id:r}))}}const u=("last"===c.input?["change"]:["input","change"]).map(t=>Ht(t,d,e)),p=e.defaultView;if(!p)return()=>{u.forEach(t=>t())};const g=p.Object.getOwnPropertyDescriptor(p.HTMLInputElement.prototype,"value"),m=[[p.HTMLInputElement.prototype,"value"],[p.HTMLInputElement.prototype,"checked"],[p.HTMLSelectElement.prototype,"value"],[p.HTMLTextAreaElement.prototype,"value"],[p.HTMLSelectElement.prototype,"selectedIndex"],[p.HTMLOptionElement.prototype,"selected"]];return g&&g.set&&u.push(...m.map(t=>jt(t[0],t[1],{set(){d({target:this})}},!1,p))),()=>{u.forEach(t=>t())}}(t),l=function({mediaInteractionCb:t,blockClass:e,blockSelector:n,mirror:i,sampling:r}){const o=o=>_t(r=>{const s=Ae(r);if(!s||Jt(s,e,n,!0))return;const{currentTime:a,volume:c,muted:l,playbackRate:d}=s;t({type:o,id:i.getId(s),currentTime:a,volume:c,muted:l,playbackRate:d})},r.media||500),s=[Ht("play",o(0)),Ht("pause",o(1)),Ht("seeked",o(2)),Ht("volumechange",o(3)),Ht("ratechange",o(4))];return()=>{s.forEach(t=>t())}}(t),d=function({styleSheetRuleCb:t,mirror:e,stylesheetManager:n},{win:i}){const r=i.CSSStyleSheet.prototype.insertRule;i.CSSStyleSheet.prototype.insertRule=function(i,o){const{id:s,styleId:a}=Ne(this,e,n.styleMirror);return(s&&-1!==s||a&&-1!==a)&&t({id:s,styleId:a,adds:[{rule:i,index:o}]}),r.apply(this,[i,o])};const o=i.CSSStyleSheet.prototype.deleteRule;let s,a;i.CSSStyleSheet.prototype.deleteRule=function(i){const{id:r,styleId:s}=Ne(this,e,n.styleMirror);return(r&&-1!==r||s&&-1!==s)&&t({id:r,styleId:s,removes:[{index:i}]}),o.apply(this,[i])},i.CSSStyleSheet.prototype.replace&&(s=i.CSSStyleSheet.prototype.replace,i.CSSStyleSheet.prototype.replace=function(i){const{id:r,styleId:o}=Ne(this,e,n.styleMirror);return(r&&-1!==r||o&&-1!==o)&&t({id:r,styleId:o,replace:i}),s.apply(this,[i])}),i.CSSStyleSheet.prototype.replaceSync&&(a=i.CSSStyleSheet.prototype.replaceSync,i.CSSStyleSheet.prototype.replaceSync=function(i){const{id:r,styleId:o}=Ne(this,e,n.styleMirror);return(r&&-1!==r||o&&-1!==o)&&t({id:r,styleId:o,replaceSync:i}),a.apply(this,[i])});const c={};be?c.CSSGroupingRule=i.CSSGroupingRule:(ve&&(c.CSSMediaRule=i.CSSMediaRule),we&&(c.CSSConditionRule=i.CSSConditionRule),Se&&(c.CSSSupportsRule=i.CSSSupportsRule));const l={};return Object.entries(c).forEach(([i,r])=>{l[i]={insertRule:r.prototype.insertRule,deleteRule:r.prototype.deleteRule},r.prototype.insertRule=function(r,o){const{id:s,styleId:a}=Ne(this.parentStyleSheet,e,n.styleMirror);return(s&&-1!==s||a&&-1!==a)&&t({id:s,styleId:a,adds:[{rule:r,index:[...Te(this),o||0]}]}),l[i].insertRule.apply(this,[r,o])},r.prototype.deleteRule=function(r){const{id:o,styleId:s}=Ne(this.parentStyleSheet,e,n.styleMirror);return(o&&-1!==o||s&&-1!==s)&&t({id:o,styleId:s,removes:[{index:[...Te(this),r]}]}),l[i].deleteRule.apply(this,[r])}}),()=>{i.CSSStyleSheet.prototype.insertRule=r,i.CSSStyleSheet.prototype.deleteRule=o,s&&(i.CSSStyleSheet.prototype.replace=s),a&&(i.CSSStyleSheet.prototype.replaceSync=a),Object.entries(c).forEach(([t,e])=>{e.prototype.insertRule=l[t].insertRule,e.prototype.deleteRule=l[t].deleteRule})}}(t,{win:n}),h=Le(t,t.doc),u=function({styleDeclarationCb:t,mirror:e,ignoreCSSAttributes:n,stylesheetManager:i},{win:r}){const o=r.CSSStyleDeclaration.prototype.setProperty;r.CSSStyleDeclaration.prototype.setProperty=function(r,s,a){var c;if(n.has(r))return o.apply(this,[r,s,a]);const{id:l,styleId:d}=Ne(null===(c=this.parentRule)||void 0===c?void 0:c.parentStyleSheet,e,i.styleMirror);return(l&&-1!==l||d&&-1!==d)&&t({id:l,styleId:d,set:{property:r,value:s,priority:a},index:Te(this.parentRule)}),o.apply(this,[r,s,a])};const s=r.CSSStyleDeclaration.prototype.removeProperty;return r.CSSStyleDeclaration.prototype.removeProperty=function(r){var o;if(n.has(r))return s.apply(this,[r]);const{id:a,styleId:c}=Ne(null===(o=this.parentRule)||void 0===o?void 0:o.parentStyleSheet,e,i.styleMirror);return(a&&-1!==a||c&&-1!==c)&&t({id:a,styleId:c,remove:{property:r},index:Te(this.parentRule)}),s.apply(this,[r])},()=>{r.CSSStyleDeclaration.prototype.setProperty=o,r.CSSStyleDeclaration.prototype.removeProperty=s}}(t,{win:n}),p=t.collectFonts?function({fontCb:t,doc:e}){const n=e.defaultView;if(!n)return()=>{};const i=[],r=new WeakMap,o=n.FontFace;n.FontFace=function(t,e,n){const i=new o(t,e,n);return r.set(i,{family:t,buffer:"string"!=typeof e,descriptors:n,fontSource:"string"==typeof e?e:JSON.stringify(Array.from(new Uint8Array(e)))}),i};const s=Yt(e.fonts,"add",function(e){return function(n){return setTimeout(()=>{const e=r.get(n);e&&(t(e),r.delete(n))},0),e.apply(this,[n])}});return i.push(()=>{n.FontFace=o}),i.push(s),()=>{i.forEach(t=>t())}}(t):()=>{},g=function(t){const{doc:e,mirror:n,blockClass:i,blockSelector:r,selectionCb:o}=t;let s=!0;const a=()=>{const t=e.getSelection();if(!t||s&&(null==t?void 0:t.isCollapsed))return;s=t.isCollapsed||!1;const a=[],c=t.rangeCount||0;for(let e=0;e<c;e++){const o=t.getRangeAt(e),{startContainer:s,startOffset:c,endContainer:l,endOffset:d}=o;Jt(s,i,r,!0)||Jt(l,i,r,!0)||a.push({start:n.getId(s),startOffset:c,end:n.getId(l),endOffset:d})}o({ranges:a})};return a(),Ht("selectionchange",a)}(t),m=[];for(const e of t.plugins)m.push(e.observer(e.callback,n,e.options));return()=>{Ie.forEach(t=>t.reset()),i.disconnect(),r(),o(),s(),a(),c(),l(),d(),h(),u(),p(),g(),m.forEach(t=>t())}}class Oe{constructor(t){this.generateIdFn=t,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(t,e,n,i){const r=n||this.getIdToRemoteIdMap(t),o=i||this.getRemoteIdToIdMap(t);let s=r.get(e);return s||(s=this.generateIdFn(),r.set(e,s),o.set(s,e)),s}getIds(t,e){const n=this.getIdToRemoteIdMap(t),i=this.getRemoteIdToIdMap(t);return e.map(e=>this.getId(t,e,n,i))}getRemoteId(t,e,n){const i=n||this.getRemoteIdToIdMap(t);if("number"!=typeof e)return e;return i.get(e)||-1}getRemoteIds(t,e){const n=this.getRemoteIdToIdMap(t);return e.map(e=>this.getRemoteId(t,e,n))}reset(t){if(!t)return this.iframeIdToRemoteIdMap=new WeakMap,void(this.iframeRemoteIdToIdMap=new WeakMap);this.iframeIdToRemoteIdMap.delete(t),this.iframeRemoteIdToIdMap.delete(t)}getIdToRemoteIdMap(t){let e=this.iframeIdToRemoteIdMap.get(t);return e||(e=new Map,this.iframeIdToRemoteIdMap.set(t,e)),e}getRemoteIdToIdMap(t){let e=this.iframeRemoteIdToIdMap.get(t);return e||(e=new Map,this.iframeRemoteIdToIdMap.set(t,e)),e}}class Fe{constructor(t){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new Oe(Tt),this.mutationCb=t.mutationCb,this.wrappedEmit=t.wrappedEmit,this.stylesheetManager=t.stylesheetManager,this.recordCrossOriginIframes=t.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new Oe(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=t.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(t){this.iframes.set(t,!0),t.contentWindow&&this.crossOriginIframeMap.set(t.contentWindow,t)}addLoadListener(t){this.loadListener=t}attachIframe(t,e){var n;this.mutationCb({adds:[{parentId:this.mirror.getId(t),nextId:null,node:e}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),null===(n=this.loadListener)||void 0===n||n.call(this,t),t.contentDocument&&t.contentDocument.adoptedStyleSheets&&t.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(t.contentDocument.adoptedStyleSheets,this.mirror.getId(t.contentDocument))}handleMessage(t){if("rrweb"===t.data.type){if(!t.source)return;const e=this.crossOriginIframeMap.get(t.source);if(!e)return;const n=this.transformCrossOriginEvent(e,t.data.event);n&&this.wrappedEmit(n,t.data.isCheckout)}}transformCrossOriginEvent(t,e){var n;switch(e.type){case se.FullSnapshot:return this.crossOriginIframeMirror.reset(t),this.crossOriginIframeStyleMirror.reset(t),this.replaceIdOnNode(e.data.node,t),{timestamp:e.timestamp,type:se.IncrementalSnapshot,data:{source:ae.Mutation,adds:[{parentId:this.mirror.getId(t),nextId:null,node:e.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}};case se.Meta:case se.Load:case se.DomContentLoaded:return!1;case se.Plugin:return e;case se.Custom:return this.replaceIds(e.data.payload,t,["id","parentId","previousId","nextId"]),e;case se.IncrementalSnapshot:switch(e.data.source){case ae.Mutation:return e.data.adds.forEach(e=>{this.replaceIds(e,t,["parentId","nextId","previousId"]),this.replaceIdOnNode(e.node,t)}),e.data.removes.forEach(e=>{this.replaceIds(e,t,["parentId","id"])}),e.data.attributes.forEach(e=>{this.replaceIds(e,t,["id"])}),e.data.texts.forEach(e=>{this.replaceIds(e,t,["id"])}),e;case ae.Drag:case ae.TouchMove:case ae.MouseMove:return e.data.positions.forEach(e=>{this.replaceIds(e,t,["id"])}),e;case ae.ViewportResize:return!1;case ae.MediaInteraction:case ae.MouseInteraction:case ae.Scroll:case ae.CanvasMutation:case ae.Input:return this.replaceIds(e.data,t,["id"]),e;case ae.StyleSheetRule:case ae.StyleDeclaration:return this.replaceIds(e.data,t,["id"]),this.replaceStyleIds(e.data,t,["styleId"]),e;case ae.Font:return e;case ae.Selection:return e.data.ranges.forEach(e=>{this.replaceIds(e,t,["start","end"])}),e;case ae.AdoptedStyleSheet:return this.replaceIds(e.data,t,["id"]),this.replaceStyleIds(e.data,t,["styleIds"]),null===(n=e.data.styles)||void 0===n||n.forEach(e=>{this.replaceStyleIds(e,t,["styleId"])}),e}}}replace(t,e,n,i){for(const r of i)(Array.isArray(e[r])||"number"==typeof e[r])&&(Array.isArray(e[r])?e[r]=t.getIds(n,e[r]):e[r]=t.getId(n,e[r]));return e}replaceIds(t,e,n){return this.replace(this.crossOriginIframeMirror,t,e,n)}replaceStyleIds(t,e,n){return this.replace(this.crossOriginIframeStyleMirror,t,e,n)}replaceIdOnNode(t,e){this.replaceIds(t,e,["id"]),"childNodes"in t&&t.childNodes.forEach(t=>{this.replaceIdOnNode(t,e)})}}class Be{constructor(t){this.shadowDoms=new WeakSet,this.restorePatches=[],this.mutationCb=t.mutationCb,this.scrollCb=t.scrollCb,this.bypassOptions=t.bypassOptions,this.mirror=t.mirror;const e=this;this.restorePatches.push(Yt(Element.prototype,"attachShadow",function(t){return function(n){const i=t.call(this,n);return this.shadowRoot&&e.addShadowRoot(this.shadowRoot,this.ownerDocument),i}}))}addShadowRoot(t,e){bt(t)&&(this.shadowDoms.has(t)||(this.shadowDoms.add(t),xe(Object.assign(Object.assign({},this.bypassOptions),{doc:e,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),t),ke(Object.assign(Object.assign({},this.bypassOptions),{scrollCb:this.scrollCb,doc:t,mirror:this.mirror})),setTimeout(()=>{t.adoptedStyleSheets&&t.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(t.adoptedStyleSheets,this.mirror.getId(t.host)),Le({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},t)},0)))}observeAttachShadow(t){if(t.contentWindow){const e=this;this.restorePatches.push(Yt(t.contentWindow.HTMLElement.prototype,"attachShadow",function(n){return function(i){const r=n.call(this,i);return this.shadowRoot&&e.addShadowRoot(this.shadowRoot,t.contentDocument),r}}))}}reset(){this.restorePatches.forEach(t=>t()),this.shadowDoms=new WeakSet}}for(var ze="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",We="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Ue=0;Ue<64;Ue++)We[ze.charCodeAt(Ue)]=Ue;const Pe=new Map,Ve=(t,e,n)=>{if(!t||!He(t,e)&&"object"!=typeof t)return;const i=function(t,e){let n=Pe.get(t);return n||(n=new Map,Pe.set(t,n)),n.has(e)||n.set(e,[]),n.get(e)}(n,t.constructor.name);let r=i.indexOf(t);return-1===r&&(r=i.length,i.push(t)),r};function Ze(t,e,n){if(t instanceof Array)return t.map(t=>Ze(t,e,n));if(null===t)return t;if(t instanceof Float32Array||t instanceof Float64Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Int8Array||t instanceof Uint8ClampedArray)return{rr_type:t.constructor.name,args:[Object.values(t)]};if(t instanceof ArrayBuffer){const e=t.constructor.name,n=function(t){var e,n=new Uint8Array(t),i=n.length,r="";for(e=0;e<i;e+=3)r+=ze[n[e]>>2],r+=ze[(3&n[e])<<4|n[e+1]>>4],r+=ze[(15&n[e+1])<<2|n[e+2]>>6],r+=ze[63&n[e+2]];return i%3==2?r=r.substring(0,r.length-1)+"=":i%3==1&&(r=r.substring(0,r.length-2)+"=="),r}(t);return{rr_type:e,base64:n}}if(t instanceof DataView)return{rr_type:t.constructor.name,args:[Ze(t.buffer,e,n),t.byteOffset,t.byteLength]};if(t instanceof HTMLImageElement){const e=t.constructor.name,{src:n}=t;return{rr_type:e,src:n}}return t instanceof HTMLCanvasElement?{rr_type:"HTMLImageElement",src:t.toDataURL()}:t instanceof ImageData?{rr_type:t.constructor.name,args:[Ze(t.data,e,n),t.width,t.height]}:He(t,e)||"object"==typeof t?{rr_type:t.constructor.name,index:Ve(t,e,n)}:t}const Ge=(t,e,n)=>[...t].map(t=>Ze(t,e,n)),He=(t,e)=>{const n=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter(t=>"function"==typeof e[t]);return Boolean(n.find(n=>t instanceof e[n]))};function qe(t,e,n){const i=[];try{const r=Yt(t.HTMLCanvasElement.prototype,"getContext",function(t){return function(i,...r){return Jt(this,e,n,!0)||"__context"in this||(this.__context=i),t.apply(this,[i,...r])}});i.push(r)}catch(t){console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return()=>{i.forEach(t=>t())}}function Ke(t,e,n,i,r,o,s){const a=[],c=Object.getOwnPropertyNames(t);for(const o of c)if(!["isContextLost","canvas","drawingBufferWidth","drawingBufferHeight"].includes(o))try{if("function"!=typeof t[o])continue;const c=Yt(t,o,function(t){return function(...a){const c=t.apply(this,a);if(Ve(c,s,this),!Jt(this.canvas,i,r,!0)){const t=Ge([...a],s,this),i={type:e,property:o,args:t};n(this.canvas,i)}return c}});a.push(c)}catch(i){const r=jt(t,o,{set(t){n(this.canvas,{type:e,property:o,args:[t],setter:!0})}});a.push(r)}return a}var _e=null;try{var je="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof require&&require("worker_threads")||"function"==typeof require&&require("worker_threads");_e=je.Worker}catch(t){}var Ye,$e,Xe=(Ye="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIC8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLg0KDQogICAgUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55DQogICAgcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLg0KDQogICAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgNCiAgICBSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkNCiAgICBBTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsDQogICAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NDQogICAgTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1INCiAgICBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SDQogICAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4NCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLw0KDQogICAgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgew0KICAgICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOw0KICAgICAgICB9KTsNCiAgICB9CgogICAgLyoKICAgICAqIGJhc2U2NC1hcnJheWJ1ZmZlciAxLjAuMSA8aHR0cHM6Ly9naXRodWIuY29tL25pa2xhc3ZoL2Jhc2U2NC1hcnJheWJ1ZmZlcj4KICAgICAqIENvcHlyaWdodCAoYykgMjAyMSBOaWtsYXMgdm9uIEhlcnR6ZW4gPGh0dHBzOi8vaGVydHplbi5jb20+CiAgICAgKiBSZWxlYXNlZCB1bmRlciBNSVQgTGljZW5zZQogICAgICovCiAgICB2YXIgY2hhcnMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyc7CiAgICAvLyBVc2UgYSBsb29rdXAgdGFibGUgdG8gZmluZCB0aGUgaW5kZXguCiAgICB2YXIgbG9va3VwID0gdHlwZW9mIFVpbnQ4QXJyYXkgPT09ICd1bmRlZmluZWQnID8gW10gOiBuZXcgVWludDhBcnJheSgyNTYpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFycy5sZW5ndGg7IGkrKykgewogICAgICAgIGxvb2t1cFtjaGFycy5jaGFyQ29kZUF0KGkpXSA9IGk7CiAgICB9CiAgICB2YXIgZW5jb2RlID0gZnVuY3Rpb24gKGFycmF5YnVmZmVyKSB7CiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlidWZmZXIpLCBpLCBsZW4gPSBieXRlcy5sZW5ndGgsIGJhc2U2NCA9ICcnOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gMykgewogICAgICAgICAgICBiYXNlNjQgKz0gY2hhcnNbYnl0ZXNbaV0gPj4gMl07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1soKGJ5dGVzW2ldICYgMykgPDwgNCkgfCAoYnl0ZXNbaSArIDFdID4+IDQpXTsKICAgICAgICAgICAgYmFzZTY0ICs9IGNoYXJzWygoYnl0ZXNbaSArIDFdICYgMTUpIDw8IDIpIHwgKGJ5dGVzW2kgKyAyXSA+PiA2KV07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1tieXRlc1tpICsgMl0gJiA2M107CiAgICAgICAgfQogICAgICAgIGlmIChsZW4gJSAzID09PSAyKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDEpICsgJz0nOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChsZW4gJSAzID09PSAxKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDIpICsgJz09JzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJhc2U2NDsKICAgIH07CgogICAgY29uc3QgbGFzdEJsb2JNYXAgPSBuZXcgTWFwKCk7DQogICAgY29uc3QgdHJhbnNwYXJlbnRCbG9iTWFwID0gbmV3IE1hcCgpOw0KICAgIGZ1bmN0aW9uIGdldFRyYW5zcGFyZW50QmxvYkZvcih3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucykgew0KICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgew0KICAgICAgICAgICAgY29uc3QgaWQgPSBgJHt3aWR0aH0tJHtoZWlnaHR9YDsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgaWYgKHRyYW5zcGFyZW50QmxvYk1hcC5oYXMoaWQpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNwYXJlbnRCbG9iTWFwLmdldChpZCk7DQogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsNCiAgICAgICAgICAgICAgICBvZmZzY3JlZW4uZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0geWllbGQgYmxvYi5hcnJheUJ1ZmZlcigpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGJhc2U2NCA9IGVuY29kZShhcnJheUJ1ZmZlcik7DQogICAgICAgICAgICAgICAgdHJhbnNwYXJlbnRCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZTY0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgY29uc3Qgd29ya2VyID0gc2VsZjsNCiAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgY29uc3QgeyBpZCwgYml0bWFwLCB3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucyB9ID0gZS5kYXRhOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zcGFyZW50QmFzZTY0ID0gZ2V0VHJhbnNwYXJlbnRCbG9iRm9yKHdpZHRoLCBoZWlnaHQsIGRhdGFVUkxPcHRpb25zKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IG9mZnNjcmVlbi5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwKTsNCiAgICAgICAgICAgICAgICBiaXRtYXAuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBibG9iLnR5cGU7DQogICAgICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSB5aWVsZCBibG9iLmFycmF5QnVmZmVyKCk7DQogICAgICAgICAgICAgICAgY29uc3QgYmFzZTY0ID0gZW5jb2RlKGFycmF5QnVmZmVyKTsNCiAgICAgICAgICAgICAgICBpZiAoIWxhc3RCbG9iTWFwLmhhcyhpZCkgJiYgKHlpZWxkIHRyYW5zcGFyZW50QmFzZTY0KSA9PT0gYmFzZTY0KSB7DQogICAgICAgICAgICAgICAgICAgIGxhc3RCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZSh7IGlkIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobGFzdEJsb2JNYXAuZ2V0KGlkKSA9PT0gYmFzZTY0KQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQgfSk7DQogICAgICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgICAgICAgICAgaWQsDQogICAgICAgICAgICAgICAgICAgIHR5cGUsDQogICAgICAgICAgICAgICAgICAgIGJhc2U2NCwNCiAgICAgICAgICAgICAgICAgICAgd2lkdGgsDQogICAgICAgICAgICAgICAgICAgIGhlaWdodCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBsYXN0QmxvYk1hcC5zZXQoaWQsIGJhc2U2NCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQ6IGUuZGF0YS5pZCB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfTsKCn0pKCk7Cgo=",$e=!1,"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)?function(t,e,n){var i=void 0===e?null:e,r=function(t,e){return Buffer.from(t,"base64").toString(e?"utf16":"utf8")}(t,void 0!==n&&n),o=r.indexOf("\n",10)+1,s=r.substring(o)+(i?"//# sourceMappingURL="+i:"");return function(t){return new _e(s,Object.assign({},t,{eval:!0}))}}(Ye,null,$e):function(t){var e;return function(n){return e=e||function(t,e,n){var i=void 0===e?null:e,r=function(t,e){var n=atob(t);if(e){for(var i=new Uint8Array(n.length),r=0,o=n.length;r<o;++r)i[r]=n.charCodeAt(r);return String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return n}(t,void 0!==n&&n),o=r.indexOf("\n",10)+1,s=r.substring(o)+(i?"//# sourceMappingURL="+i:""),a=new Blob([s],{type:"application/javascript"});return URL.createObjectURL(a)}(t,null,false),new Worker(e,n)}}(Ye));class Je{constructor(t){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.frozen=!1,this.locked=!1,this.processMutation=(t,e)=>{!(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId)&&this.rafStamps.invokeId||(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(t)||this.pendingCanvasMutations.set(t,[]),this.pendingCanvasMutations.get(t).push(e)};const{sampling:e="all",win:n,blockClass:i,blockSelector:r,recordCanvas:o,dataURLOptions:s}=t;this.mutationCb=t.mutationCb,this.mirror=t.mirror,o&&"all"===e&&this.initCanvasMutationObserver(n,i,r),o&&"number"==typeof e&&this.initCanvasFPSObserver(e,n,i,r,{dataURLOptions:s})}reset(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}initCanvasFPSObserver(t,e,n,i,r){const o=qe(e,n,i),s=new Map,a=new Xe;a.onmessage=t=>{const{id:e}=t.data;if(s.set(e,!1),!("base64"in t.data))return;const{base64:n,type:i,width:r,height:o}=t.data;this.mutationCb({id:e,type:le["2D"],commands:[{property:"clearRect",args:[0,0,r,o]},{property:"drawImage",args:[{rr_type:"ImageBitmap",args:[{rr_type:"Blob",data:[{rr_type:"ArrayBuffer",base64:n}],type:i}]},0,0]}]})};const c=1e3/t;let l,d=0;const h=t=>{d&&t-d<c||(d=t,(()=>{const t=[];return e.document.querySelectorAll("canvas").forEach(e=>{Jt(e,n,i,!0)||t.push(e)}),t})().forEach(t=>{return e=this,n=void 0,o=function*(){var e;const n=this.mirror.getId(t);if(s.get(n))return;if(s.set(n,!0),["webgl","webgl2"].includes(t.__context)){const n=t.getContext(t.__context);!1===(null===(e=null==n?void 0:n.getContextAttributes())||void 0===e?void 0:e.preserveDrawingBuffer)&&(null==n||n.clear(n.COLOR_BUFFER_BIT))}const i=yield createImageBitmap(t);a.postMessage({id:n,bitmap:i,width:t.width,height:t.height,dataURLOptions:r.dataURLOptions},[i])},new((i=void 0)||(i=Promise))(function(t,r){function s(t){try{c(o.next(t))}catch(t){r(t)}}function a(t){try{c(o.throw(t))}catch(t){r(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i(function(t){t(n)})).then(s,a)}c((o=o.apply(e,n||[])).next())});var e,n,i,o})),l=requestAnimationFrame(h)};l=requestAnimationFrame(h),this.resetObservers=()=>{o(),cancelAnimationFrame(l)}}initCanvasMutationObserver(t,e,n){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();const i=qe(t,e,n),r=function(t,e,n,i){const r=[],o=Object.getOwnPropertyNames(e.CanvasRenderingContext2D.prototype);for(const s of o)try{if("function"!=typeof e.CanvasRenderingContext2D.prototype[s])continue;const o=Yt(e.CanvasRenderingContext2D.prototype,s,function(r){return function(...o){return Jt(this.canvas,n,i,!0)||setTimeout(()=>{const n=Ge([...o],e,this);t(this.canvas,{type:le["2D"],property:s,args:n})},0),r.apply(this,o)}});r.push(o)}catch(n){const i=jt(e.CanvasRenderingContext2D.prototype,s,{set(e){t(this.canvas,{type:le["2D"],property:s,args:[e],setter:!0})}});r.push(i)}return()=>{r.forEach(t=>t())}}(this.processMutation.bind(this),t,e,n),o=function(t,e,n,i){const r=[];return r.push(...Ke(e.WebGLRenderingContext.prototype,le.WebGL,t,n,i,0,e)),void 0!==e.WebGL2RenderingContext&&r.push(...Ke(e.WebGL2RenderingContext.prototype,le.WebGL2,t,n,i,0,e)),()=>{r.forEach(t=>t())}}(this.processMutation.bind(this),t,e,n,this.mirror);this.resetObservers=()=>{i(),r(),o()}}startPendingCanvasMutationFlusher(){requestAnimationFrame(()=>this.flushPendingCanvasMutations())}startRAFTimestamping(){const t=e=>{this.rafStamps.latestId=e,requestAnimationFrame(t)};requestAnimationFrame(t)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach((t,e)=>{const n=this.mirror.getId(e);this.flushPendingCanvasMutationFor(e,n)}),requestAnimationFrame(()=>this.flushPendingCanvasMutations())}flushPendingCanvasMutationFor(t,e){if(this.frozen||this.locked)return;const n=this.pendingCanvasMutations.get(t);if(!n||-1===e)return;const i=n.map(t=>{const e=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}(t,["type"]);return e}),{type:r}=n[0];this.mutationCb({id:e,type:r,commands:i}),this.pendingCanvasMutations.delete(t)}}class Qe{constructor(t){this.trackedLinkElements=new WeakSet,this.styleMirror=new oe,this.mutationCb=t.mutationCb,this.adoptedStyleSheetCb=t.adoptedStyleSheetCb}attachLinkElement(t,e){"_cssText"in e.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:e.id,attributes:e.attributes}]}),this.trackLinkElement(t)}trackLinkElement(t){this.trackedLinkElements.has(t)||(this.trackedLinkElements.add(t),this.trackStylesheetInLinkElement(t))}adoptStyleSheets(t,e){if(0===t.length)return;const n={id:e,styleIds:[]},i=[];for(const e of t){let t;if(this.styleMirror.has(e))t=this.styleMirror.getId(e);else{t=this.styleMirror.add(e);const n=Array.from(e.rules||CSSRule);i.push({styleId:t,rules:n.map((t,e)=>({rule:St(t),index:e}))})}n.styleIds.push(t)}i.length>0&&(n.styles=i),this.adoptedStyleSheetCb(n)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(t){}}function tn(t){return Object.assign(Object.assign({},t),{timestamp:Date.now()})}let en,nn,rn,on=!1;const sn=new wt;function an(t={}){const{emit:e,checkoutEveryNms:n,checkoutEveryNth:i,blockClass:r="rr-block",blockSelector:o=null,ignoreClass:s="rr-ignore",maskTextClass:a="rr-mask",maskTextSelector:c=null,inlineStylesheet:l=!0,maskAllInputs:d,maskInputOptions:h,slimDOMOptions:u,maskInputFn:p,maskTextFn:g,hooks:m,packFn:f,sampling:y={},dataURLOptions:C={},mousemoveWait:I,recordCanvas:b=!1,recordCrossOriginIframes:v=!1,userTriggeredOnInput:S=!1,collectFonts:w=!1,inlineImages:A=!1,plugins:x,keepIframeSrcFn:k=()=>!1,ignoreCSSAttributes:M=new Set([])}=t,R=!v||window.parent===window;let E=!1;if(!R)try{window.parent.document,E=!1}catch(t){E=!0}if(R&&!e)throw new Error("emit function is required");void 0!==I&&void 0===y.mousemove&&(y.mousemove=I),sn.reset();const T=!0===d?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:void 0!==h?h:{password:!0},N=!0===u||"all"===u?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===u,headMetaDescKeywords:"all"===u}:u||{};let L;!function(t=window){"NodeList"in t&&!t.NodeList.prototype.forEach&&(t.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in t&&!t.DOMTokenList.prototype.forEach&&(t.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...t)=>{let e=t[0];if(!(0 in t))throw new TypeError("1 argument is required");do{if(this===e)return!0}while(e=e&&e.parentNode);return!1})}();let D=0;const O=t=>{for(const e of x||[])e.eventProcessor&&(t=e.eventProcessor(t));return f&&(t=f(t)),t};en=(t,r)=>{var o;if(!(null===(o=Ie[0])||void 0===o?void 0:o.isFrozen())||t.type===se.FullSnapshot||t.type===se.IncrementalSnapshot&&t.data.source===ae.Mutation||Ie.forEach(t=>t.unfreeze()),R)null==e||e(O(t),r);else if(E){const e={type:"rrweb",event:O(t),isCheckout:r};window.parent.postMessage(e,"*")}if(t.type===se.FullSnapshot)L=t,D=0;else if(t.type===se.IncrementalSnapshot){if(t.data.source===ae.Mutation&&t.data.isAttachIframe)return;D++;const e=i&&D>=i,r=n&&t.timestamp-L.timestamp>n;(e||r)&&nn(!0)}};const F=t=>{en(tn({type:se.IncrementalSnapshot,data:Object.assign({source:ae.Mutation},t)}))},B=t=>en(tn({type:se.IncrementalSnapshot,data:Object.assign({source:ae.Scroll},t)})),z=t=>en(tn({type:se.IncrementalSnapshot,data:Object.assign({source:ae.CanvasMutation},t)})),W=new Qe({mutationCb:F,adoptedStyleSheetCb:t=>en(tn({type:se.IncrementalSnapshot,data:Object.assign({source:ae.AdoptedStyleSheet},t)}))}),U=new Fe({mirror:sn,mutationCb:F,stylesheetManager:W,recordCrossOriginIframes:v,wrappedEmit:en});for(const t of x||[])t.getMirror&&t.getMirror({nodeMirror:sn,crossOriginIframeMirror:U.crossOriginIframeMirror,crossOriginIframeStyleMirror:U.crossOriginIframeStyleMirror});rn=new Je({recordCanvas:b,mutationCb:z,win:window,blockClass:r,blockSelector:o,mirror:sn,sampling:y.canvas,dataURLOptions:C});const P=new Be({mutationCb:F,scrollCb:B,bypassOptions:{blockClass:r,blockSelector:o,maskTextClass:a,maskTextSelector:c,inlineStylesheet:l,maskInputOptions:T,dataURLOptions:C,maskTextFn:g,maskInputFn:p,recordCanvas:b,inlineImages:A,sampling:y,slimDOMOptions:N,iframeManager:U,stylesheetManager:W,canvasManager:rn,keepIframeSrcFn:k},mirror:sn});nn=(t=!1)=>{var e,n,i,s,d,h;en(tn({type:se.Meta,data:{href:window.location.href,width:Xt(),height:$t()}}),t),W.reset(),Ie.forEach(t=>t.lock());const u=function(t,e){var n=e||{},i=n.mirror,r=void 0===i?new wt:i,o=n.blockClass,s=n.blockSelector,a=n.maskTextClass,c=n.maskTextSelector,l=n.inlineStylesheet,d=n.inlineImages,h=n.recordCanvas,u=n.maskAllInputs,p=void 0!==u&&u,g=n.slimDOM,m=void 0!==g&&g,f=n.keepIframeSrcFn;return Gt(t,{doc:t,mirror:r,blockClass:void 0===o?"rr-block":o,blockSelector:void 0===s?null:s,maskTextClass:void 0===a?"rr-mask":a,maskTextSelector:void 0===c?null:c,skipChild:!1,inlineStylesheet:void 0===l||l,maskInputOptions:!0===p?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:!1===p?{password:!0}:p,maskTextFn:n.maskTextFn,maskInputFn:n.maskInputFn,slimDOMOptions:!0===m||"all"===m?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===m,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===m?{}:m,dataURLOptions:n.dataURLOptions,inlineImages:void 0!==d&&d,recordCanvas:void 0!==h&&h,preserveWhiteSpace:n.preserveWhiteSpace,onSerialize:n.onSerialize,onIframeLoad:n.onIframeLoad,iframeLoadTimeout:n.iframeLoadTimeout,onStylesheetLoad:n.onStylesheetLoad,stylesheetLoadTimeout:n.stylesheetLoadTimeout,keepIframeSrcFn:void 0===f?function(){return!1}:f,newlyAddedElement:!1})}(document,{mirror:sn,blockClass:r,blockSelector:o,maskTextClass:a,maskTextSelector:c,inlineStylesheet:l,maskAllInputs:T,maskTextFn:g,slimDOM:N,dataURLOptions:C,recordCanvas:b,inlineImages:A,onSerialize:t=>{ne(t,sn)&&U.addIframe(t),ie(t,sn)&&W.trackLinkElement(t),re(t)&&P.addShadowRoot(t.shadowRoot,document)},onIframeLoad:(t,e)=>{U.attachIframe(t,e),P.observeAttachShadow(t)},onStylesheetLoad:(t,e)=>{W.attachLinkElement(t,e)},keepIframeSrcFn:k});if(!u)return console.warn("Failed to snapshot the document");en(tn({type:se.FullSnapshot,data:{node:u,initialOffset:{left:void 0!==window.pageXOffset?window.pageXOffset:(null===document||void 0===document?void 0:document.documentElement.scrollLeft)||(null===(n=null===(e=null===document||void 0===document?void 0:document.body)||void 0===e?void 0:e.parentElement)||void 0===n?void 0:n.scrollLeft)||(null===(i=null===document||void 0===document?void 0:document.body)||void 0===i?void 0:i.scrollLeft)||0,top:void 0!==window.pageYOffset?window.pageYOffset:(null===document||void 0===document?void 0:document.documentElement.scrollTop)||(null===(d=null===(s=null===document||void 0===document?void 0:document.body)||void 0===s?void 0:s.parentElement)||void 0===d?void 0:d.scrollTop)||(null===(h=null===document||void 0===document?void 0:document.body)||void 0===h?void 0:h.scrollTop)||0}}})),Ie.forEach(t=>t.unlock()),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&W.adoptStyleSheets(document.adoptedStyleSheets,sn.getId(document))};try{const t=[];t.push(Ht("DOMContentLoaded",()=>{en(tn({type:se.DomContentLoaded,data:{}}))}));const e=t=>{var e;return De({mutationCb:F,mousemoveCb:(t,e)=>en(tn({type:se.IncrementalSnapshot,data:{source:e,positions:t}})),mouseInteractionCb:t=>en(tn({type:se.IncrementalSnapshot,data:Object.assign({source:ae.MouseInteraction},t)})),scrollCb:B,viewportResizeCb:t=>en(tn({type:se.IncrementalSnapshot,data:Object.assign({source:ae.ViewportResize},t)})),inputCb:t=>en(tn({type:se.IncrementalSnapshot,data:Object.assign({source:ae.Input},t)})),mediaInteractionCb:t=>en(tn({type:se.IncrementalSnapshot,data:Object.assign({source:ae.MediaInteraction},t)})),styleSheetRuleCb:t=>en(tn({type:se.IncrementalSnapshot,data:Object.assign({source:ae.StyleSheetRule},t)})),styleDeclarationCb:t=>en(tn({type:se.IncrementalSnapshot,data:Object.assign({source:ae.StyleDeclaration},t)})),canvasMutationCb:z,fontCb:t=>en(tn({type:se.IncrementalSnapshot,data:Object.assign({source:ae.Font},t)})),selectionCb:t=>{en(tn({type:se.IncrementalSnapshot,data:Object.assign({source:ae.Selection},t)}))},blockClass:r,ignoreClass:s,maskTextClass:a,maskTextSelector:c,maskInputOptions:T,inlineStylesheet:l,sampling:y,recordCanvas:b,inlineImages:A,userTriggeredOnInput:S,collectFonts:w,doc:t,maskInputFn:p,maskTextFn:g,keepIframeSrcFn:k,blockSelector:o,slimDOMOptions:N,dataURLOptions:C,mirror:sn,iframeManager:U,stylesheetManager:W,shadowDomManager:P,canvasManager:rn,ignoreCSSAttributes:M,plugins:(null===(e=null==x?void 0:x.filter(t=>t.observer))||void 0===e?void 0:e.map(t=>({observer:t.observer,options:t.options,callback:e=>en(tn({type:se.Plugin,data:{plugin:t.name,payload:e}}))})))||[]},m)};U.addLoadListener(n=>{t.push(e(n.contentDocument))});const n=()=>{nn(),t.push(e(document)),on=!0};return"interactive"===document.readyState||"complete"===document.readyState?n():t.push(Ht("load",()=>{en(tn({type:se.Load,data:{}})),n()},window)),()=>{t.forEach(t=>t()),on=!1}}catch(t){console.warn(t)}}an.addCustomEvent=(t,e)=>{if(!on)throw new Error("please add custom event after start recording");en(tn({type:se.Custom,data:{tag:t,payload:e}}))},an.freezePage=()=>{Ie.forEach(t=>t.freeze())},an.takeFullSnapshot=t=>{if(!on)throw new Error("please take full snapshot after start recording");nn(t)},an.mirror=sn;class cn{constructor(t){this.events=[],this.duration=1e3*t.duration}add(t){this.events.push(t),this.prune()}addBatch(t){this.events.push(...t),this.prune()}prune(){if(0===this.events.length)return;const t=Date.now()-this.duration;let e=0;for(let n=0;n<this.events.length;n++)if(this.events[n].timestamp>=t){e=n;break}e>0&&(this.events=this.events.slice(e))}getEvents(){return this.prune(),[...this.events]}getCompressedEvents(){return this.getEvents()}clear(){this.events=[]}size(){return this.events.length}setDuration(t){this.duration=1e3*t,this.prune()}getDuration(){return this.duration/1e3}}class ln{constructor(t={}){this.isRecording=!1,this.sanitizer=t.sanitizer,this.config={duration:t.duration??15,sampling:{mousemove:t.sampling?.mousemove??50,scroll:t.sampling?.scroll??100},recordCanvas:t.recordCanvas??!1,recordCrossOriginIframes:t.recordCrossOriginIframes??!1,sanitizer:t.sanitizer},this.buffer=new cn({duration:this.config.duration})}startRecording(){if(this.isRecording)console.warn("DOMCollector: Recording already in progress");else try{const t={emit:t=>{this.buffer.add(t)},sampling:{mousemove:this.config.sampling?.mousemove??50,scroll:this.config.sampling?.scroll??100,mouseInteraction:{MouseUp:!1,MouseDown:!1,Click:!1,ContextMenu:!1,DblClick:!1,Focus:!1,Blur:!1,TouchStart:!1,TouchEnd:!1}},recordCanvas:this.config.recordCanvas,recordCrossOriginIframes:this.config.recordCrossOriginIframes,maskTextFn:this.sanitizer?(t,e)=>this.sanitizer.sanitizeTextNode(t,e):void 0,slimDOMOptions:{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0},inlineImages:!1,collectFonts:!1};this.stopRecordingFn=an(t),this.isRecording=!0,console.debug("DOMCollector: Started recording")}catch(t){console.error("DOMCollector: Failed to start recording",t),this.isRecording=!1}}stopRecording(){if(this.isRecording){if(this.stopRecordingFn)try{this.stopRecordingFn(),this.isRecording=!1,console.debug("DOMCollector: Stopped recording")}catch(t){console.error("DOMCollector: Failed to stop recording",t)}}else console.warn("DOMCollector: No recording in progress")}getEvents(){return this.buffer.getEvents()}getCompressedEvents(){return this.buffer.getCompressedEvents()}clearBuffer(){this.buffer.clear()}isCurrentlyRecording(){return this.isRecording}getBufferSize(){return this.buffer.size()}setDuration(t){this.config.duration=t,this.buffer.setDuration(t)}getDuration(){return this.config.duration}destroy(){this.stopRecording(),this.clearBuffer()}}class dn{constructor(t){this.config=t,!1!==t.sanitize?.enabled&&(this.sanitizer=ft({enabled:t.sanitize?.enabled??!0,patterns:t.sanitize?.patterns,customPatterns:t.sanitize?.customPatterns,excludeSelectors:t.sanitize?.excludeSelectors})),this.screenshot=new W,this.console=new P({sanitizer:this.sanitizer}),this.network=new V({sanitizer:this.sanitizer}),this.metadata=new Z(this.sanitizer),!1!==t.replay?.enabled&&(this.domCollector=new ln({duration:t.replay?.duration??15,sampling:t.replay?.sampling,sanitizer:this.sanitizer}),this.domCollector.startRecording()),!1!==t.showWidget&&(this.widget=new Y(t.widgetOptions),this.widget.onClick(async()=>{await this.handleBugReport()}))}static init(t){return dn.instance||(dn.instance=new dn(t)),dn.instance}static getInstance(){return dn.instance||null}async capture(){return{screenshot:await this.screenshot.capture(),console:this.console.getLogs(),network:this.network.getRequests(),metadata:this.metadata.capture(),replay:this.domCollector?.getEvents()??[]}}async handleBugReport(){const t=await this.capture();new yt({onSubmit:async e=>{if(console.log("Submitting bug:",{...e,report:t}),this.config.endpoint)try{await this.submitBugReport({...e,report:t}),console.log("Bug report submitted successfully")}catch(t){throw console.error("Failed to submit bug report:",t),t}}}).show(t.screenshot)}async submitBugReport(t){if(!this.config.endpoint)throw new Error("No endpoint configured for bug report submission");const e={"Content-Type":"application/json"};this.config.apiKey&&(e.Authorization=`Bearer ${this.config.apiKey}`),console.warn(`Submitting bug report to ${this.config.endpoint}`);const n=await fetch(this.config.endpoint,{method:"POST",headers:e,body:JSON.stringify(t)});if(console.warn(`${JSON.stringify(n)}`),!n.ok){const t=await n.text().catch(()=>"Unknown error");throw new Error(`Failed to submit bug report: ${n.status} ${n.statusText}. ${t}`)}return n.json().catch(()=>{})}getConfig(){return{...this.config}}destroy(){this.console.destroy(),this.network.destroy(),this.domCollector?.destroy(),this.widget?.destroy(),dn.instance=void 0}}function hn(t){return ft({enabled:!0,patterns:"all",customPatterns:[],excludeSelectors:[]}).sanitize(t)}return e})());